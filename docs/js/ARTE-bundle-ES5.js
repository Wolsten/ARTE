!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ARTE",[],t):"object"==typeof exports?exports.ARTE=t():e.ARTE=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Blocks:()=>r,Buffer:()=>a,Colours:()=>s,Comments:()=>d,Custom:()=>c,Editor:()=>Ee,Icons:()=>n,Links:()=>l,Mentions:()=>i,Modal:()=>ge,Settings:()=>u,Styles:()=>o});var n={};e.r(n),e.d(n,{b:()=>K,bq:()=>U,clear:()=>Y,colourBackground:()=>$,colourForeground:()=>_,comment:()=>ne,commentEdit:()=>ae,commentResolve:()=>oe,commentUnresolve:()=>ie,danger:()=>te,download:()=>se,fileOpen:()=>ce,h1:()=>M,h2:()=>P,h3:()=>R,i:()=>j,info:()=>Z,link:()=>Q,ol:()=>B,openLink:()=>X,options:()=>re,outline:()=>ue,p:()=>I,person:()=>W,plugin:()=>J,preview:()=>le,redo:()=>G,sidebarOpen:()=>de,u:()=>V,ul:()=>F,undo:()=>z,warning:()=>ee});var a={};e.r(a),e.d(a,{REDO:()=>Re,UNDO:()=>Pe});var r={};e.r(r),e.d(r,{BQ:()=>rt,H1:()=>et,H2:()=>tt,H3:()=>nt,OL:()=>ot,P:()=>at,UL:()=>it});var o={};e.r(o),e.d(o,{B:()=>kt,CLEAR:()=>Ct,I:()=>wt,U:()=>Nt,click:()=>gt});var i={};e.r(i),e.d(i,{BUTTON:()=>Bt,setup:()=>It});var l={};e.r(l),e.d(l,{BUTTON:()=>on});var s={};e.r(s),e.d(s,{BACKGROUND:()=>Nn,FOREGROUND:()=>wn});var c={};e.r(c),e.d(c,{BUTTON:()=>Kn});var d={};e.r(d),e.d(d,{BUTTON:()=>ra});var u={};e.r(u),e.d(u,{BUTTON:()=>fa});var f={block:["DIV","H1","H2","H3","P","LI","BLOCKQUOTE"],list:["LI"],custom:[]},p=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},h=function(e){return 1==e.nodeType&&"SPAN"===e.tagName},b=function(e){return 1==e.nodeType&&("OL"===e.tagName||"UL"===e.tagName)},v=function(e){return 1==e.nodeType&&f.block.includes(e.tagName)},m=function(e){return null!=e.tagName&&(null!=e.getAttribute("contenteditable")&&"false"==e.getAttribute("contenteditable"))};var g=function(e){var t=[],n=y(e.startContainer);if(!1===n)return[];var a=y(e.endContainer);if(!1===a)return[];for(var r=!1;!r;){var o=n.querySelector('[contenteditable="false"]');null!==o&&t.push(o),n===a&&(r=!0),n=n.nextElementSibling}return t},y=function(e){if(null==e)return!1;for(;0==v(e);){if(null==e.parentNode)return!1;e=e.parentNode}return e},k=function(e,t){for(var n=e;e!=t;){if(n=e,null==e)return!1;if(null==e.parentNode)return!1;e=e.parentNode}return n},w=function e(t,n){if(3!==t.nodeType)if(1===t.nodeType)if(!1!==v(t)||!1!==b(t)||!1!==h(t)||!1!==m(t))if("SPAN"!=t.tagName){if(n.length>0){var a=n.find((function(e){return e.tag.toUpperCase()===t.tagName}));if(a){var r=a.clean(t);t.parentNode,t.parentNode.replaceChild(r,t)}}m(t)||t.childNodes.forEach((function(t){e(t,n)}))}else!function(e){var t=e.getAttribute("style"),n="";if(t){t.split(";").forEach((function(e){e&&0==e.includes("var(--")&&(n+="".concat(e,";"))}))}if(n)e.setAttribute("style",n);else if(t){!function(e,t){t.parentNode.insertBefore(e,t)}(document.createTextNode(e.textContent.trim()),e),e.remove()}}(t);else t.remove();else t.remove();else t.textContent.includes("\n")&&(t.textContent=t.textContent.trim())};var N="§§",C="±±",E=null,S=0,L=null,T=0;function x(e){var t=y(e.commonAncestorContainer);if(!1===t)return!1;if(e.blockParent=t,e.rootNode=e.commonAncestorContainer,3===e.commonAncestorContainer.nodeType){if(null==e.commonAncestorContainer.parentNode)return!1;e.rootNode=e.commonAncestorContainer.parentNode}return e.custom=function(e){for(var t=e.startContainer;0==m(t)&&null!=t.parentNode&&t.parentNode&&"DIV"!=t.parentNode.tagName;)t=t.parentNode;return!!m(t)&&t}(e),e}var A=function(e,t){var n=document.createRange(),a=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),a.removeAllRanges(),a.addRange(n),n=x(n)};function O(e,t){for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];if(1===a.nodeType){if(O(a,t))return!0}else if(3===a.nodeType){var r=a.textContent.indexOf(t);if(-1!=r)return a.textContent=a.textContent.replace(t,""),t==N?(E=a,S=r):(L=a,T=r),!0}}return!1}var q=function(e){if(O(e,N)&&function(e){return O(e,C)}(e)){var t=document.createRange(),n=window.getSelection();return t.setStart(E,S),E==L&&S==T?t.collapse(!0):t.setEnd(L,T),n.removeAllRanges(),n.addRange(t),t}return!1},H=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)};var D=function(e,t){var n=function(e){var t="",n=[];return e.forEach((function(a,r){t+=function(e){var t=e.type,n=e.tag,a=e.label,r=e.icon;return'\n        <button id="'.concat(n,'" type="button" class="btn btn-light ').concat(t,'" title="').concat(a,'">\n            ').concat(r,"\n        </button>")}(a);var o=r==e.length-1?"":e[r+1].group;if(a.group!=o){var i="".concat(a.group," buttons");n.push(function(e,t){return'<div class="editor-toolbar-group block" role="group" title="'.concat(e,'">').concat(t,"</div>")}(i,t)),t=""}})),n.join('<span class="editor-toolbar-group-separator">|</span>')}(e),a="";return t.headingNumbers&&(a+="heading-numbers"),'\n        <div class="editor-container">\n            <div class="editor-toolbar">\n                '.concat(n,'\n            </div>\n            <div class="editor-main">\n                \x3c!-- Sidebar can go here --\x3e \n                <div class="editor-body ').concat(a,'" contenteditable="true"></div>\n            </div>\n        </div>')},M='<i class="bi bi-type-h1"></i>',P='<i class="bi bi-type-h2"></i>',R='<i class="bi bi-type-h3"></i>',I='<i class="bi bi-paragraph"></i>',U='<i class="bi bi-chat-left-quote"></i>',B='<i class="bi bi-list-ol"></i>',F='<i class="bi bi-list-ul"></i>',K='<i class="bi bi-type-bold"></i>',j='<i class="bi bi-type-italic"></i>',V='<i class="bi bi-type-underline"></i>',Y='<i class="bi bi-eraser"></i>',z='<i class="bi bi-reply"></i>',G='<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',W='<i class="bi bi-person"></i>',Q='<i class="bi bi-link"></i>',_='<i class="bi bi-type"></i>',$='<i class="bi bi-paint-bucket"></i>',J='<i class="bi bi-plug"></i>',X='<i class="bi bi-link-45deg"></i>',Z='<i class="info bi bi-info-circle-fill"></i>',ee='<i class="warning bi bi-cone-striped"></i>',te='<i class="danger bi bi-exclamation-circle-fill"></i>',ne='<i class="bi bi-chat-dots"></i>',ae='<i class="bi bi-chat-dots-fill"></i>',re='<i class="bi bi-gear"></i>',oe='<i class="bi bi-check-circle-fill"></i>',ie='<i class="bi bi-x-circle-fill"></i>',le='<i class="bi bi-eye"></i>',se='<i class="bi bi-cloud-download"></i>',ce='<i class="bi bi-folder2-open"></i>',de='<i class="bi bi-chevron-double-left"></i>',ue='<i class="bi bi-card-heading"></i>';function fe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var pe,he,be,ve=["cancel","delete","confirm"],me=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1,t)this[n]=t[n];e.self=this}var t,n,a;return t=e,n=[{key:"setPosition",value:function(e,t){var n;this.container=this.panel.querySelector(".modal-panel-container"),(n=3!==e.startContainer.nodeType?e.startContainer.childNodes.length>0?e.startContainer.childNodes[0].getBoundingClientRect():{x:t.offsetLeft,y:t.offsetTop}:e.getBoundingClientRect()).x+this.container.offsetWidth>window.innerWidth&&(n.x=window.innerWidth-this.container.offsetWidth-20),n.y+this.container.offsetHeight>window.innerHeight&&(n.y=window.innerHeight-this.container.offsetHeight-40),this.container.style.top="".concat(n.y,"px"),this.container.style.left="".concat(n.x,"px")}},{key:"template",value:function(){var e=this,t=[];null!=this.backgroundColour&&t.push("background-color:".concat(this.backgroundColour)),null!=this.borderRadius&&t.push("border-radius:".concat(this.borderRadius));var n=0==t.length?"":'style="'.concat(t.join(";"),'"'),a='<div class="modal-panel-container" '.concat(n,">"),r="";switch(this.severity){case"info":r=Z;break;case"warning":r=ee;break;case"danger":r=te}if(this.title||r){var o=this.title?"with-text":"";a+='\n                <header class="modal-panel-header">\n                    <h3 class="modal-panel-title '.concat(o,'">').concat(r).concat(this.title,"</h3>\n                </header>")}if(this.html&&(a+='<div class="modal-panel-body">'.concat(this.html,"</div>")),this.buttons){var i="",l=0;ve.forEach((function(t){e.buttons[t]&&(l++,i+='<button type="button" class="'.concat(t,'">').concat(e.buttons[t].label,"</button>"))})),a+='<div class="modal-panel-buttons '.concat(1==l?"centred":"",'">').concat(i,"</div>")}return a+="</div>"}},{key:"hide",value:function(){var e=this;null!=this.panel&&(this.panel.classList.remove("show"),document.body.removeEventListener("keydown",this.handleKeydown),setTimeout((function(){null!=e.panel&&(e.panel.remove(),e.panel=null)}),500))}},{key:"active",value:function(){return!!document.querySelector(".modal-panel")}},{key:"escapeOrHide",value:function(){this.escape instanceof Function?this.escape():this.hide()}},{key:"handleKeydown",value:function(t){"Escape"==t.key&&(t.stopPropagation(),e.self.escapeOrHide())}},{key:"addEventListeners",value:function(){var e=this;this.buttons&&ve.forEach((function(t){if(e.buttons[t]){var n=e.buttons[t],a=e.panel.querySelector("button.".concat(t));a&&a.addEventListener("click",(function(){n.callback?n.callback():e.hide()}))}})),this.escape&&(document.body.addEventListener("keydown",this.handleKeydown),this.panel.addEventListener("click",(function(t){t.target==e.panel&&(t.stopPropagation(),e.escapeOrHide())})))}},{key:"show",value:function(){var e=this;this.panel=document.createElement("DIV"),this.panel.id=H(),this.panel.classList.add("modal-panel"),this.panel.classList.add("modal-panel-".concat(this.type)),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout((function(){e.panel.classList.add("show"),e.panel.scrollIntoView()}),10)}}],n&&fe(t.prototype,n),a&&fe(t,a),e}();be=void 0,(he="self")in(pe=me)?Object.defineProperty(pe,he,{value:be,enumerable:!0,configurable:!0,writable:!0}):pe[he]=be;const ge=me;function ye(e){throw new TypeError('"'+e+'" is read-only')}function ke(e,t,n,a,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ce=function(){function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;if(we(this,e),this.options=this.initOptions(o),this.toolbar=this.initToolbarArray(r),t.innerHTML=D(this.toolbar,this.options),this.id=H(),this.toolbarNode=t.querySelector(".editor-toolbar"),this.mainNode=t.querySelector(".editor-main"),this.editorNode=t.querySelector(".editor-body"),this.sidebarNode=null,this.debugTarget=!1,this.options.debug){var i=document.createElement("div");i.classList.add("editor-debug"),this.debugTarget=p(i,this.mainNode)}this.listenForMouseUpEvents(),this.listenForPasteEvents(),this.listenForKeydownEvents(),this.listenForKeyupEvents(),this.preview=this.getCleanData,this.update=this.updateEditor,this.modal=new ge,setTimeout((function(){return n.initEditor(a)}),100)}var t,n,a,r,o;return t=e,n=[{key:"initOptions",value:function(e){return e?(e.headingNumbers=null==e.headingNumbers||e.headingNumbers,e.bufferSize=null==e.bufferSize?10:Math.max(parseInt(e.bufferSize),10),e.debug=null!=e.debug&&e.debug,e.defaultContent=null==e.defaultContent?"":e.defaultContent,e.explorer=null==e.explorer||e.explorer):e={headingNumbers:!0,bufferSize:10,debug:!1,defaultContent:"",explorer:!0},e}},{key:"initEditor",value:(r=regeneratorRuntime.mark((function e(){var t,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!=(t=a.length>0&&void 0!==a[0]?a[0]:"")||""==this.options.defaultContent){e.next=9;break}return e.next=4,fetch(this.options.defaultContent);case 4:if(200!=(n=e.sent).status){e.next=9;break}return e.next=8,n.text();case 8:t=e.sent;case 9:this.editorNode.innerHTML=t,this.range=!1,this.initialiseButtons(),this.options.explorer&&this.toolbar.find((function(e){return void 0!==e.sidebar}))&&this.showSidebar(),window.onhashchange=function(e){var t=document.getElementById(window.location.hash.substring(1));null!=t&&t.scrollIntoView({block:"center",behaviour:"smooth"})};case 14:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,a){var o=r.apply(e,t);function i(e){ke(o,n,a,i,l,"next",e)}function l(e){ke(o,n,a,i,l,"throw",e)}i(void 0)}))},function(){return o.apply(this,arguments)})},{key:"initToolbarArray",value:function(e){var t=[];return e.forEach((function(e,n){e.forEach((function(e){var a,r;e.group=n,a=e.type,r=e.tag,null!=f[a]&&0==f[a].includes(r)&&"CLEAR"!=r&&f[a].push(r),t.push(e)}))})),t}},{key:"setState",value:function(e){var t=!1;"detached"!==e.type&&(void 0===this.range||!1===this.range||this.range.custom)&&(t=!0,e.element.disabled=!0,e.element.classList.remove("active")),0==t&&"setState"in e&&e.setState(this,e)}},{key:"setStateForButtonType",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.toolbar.forEach((function(n){""!=t&&n.type!=t||e.setState(n)}))}},{key:"initialiseButtons",value:function(){var e=this;this.shortcuts=[],this.updateBuffer=!1,this.toolbar.forEach((function(t){t.element=e.toolbarNode.querySelector("#".concat(t.tag)),"UNDO"===t.tag&&e.options.bufferSize>0&&(e.updateBuffer=t.update,t.init(e,t)),"init"in t&&"UNDO"!==t.tag&&"REDO"!==t.tag&&t.init(e,t),e.setState(t),"shortcut"in t&&(t.shortcut[0],t.shortcut[1],e.shortcuts.push({shortcut:t.shortcut[0],trigger:t.shortcut[1],button:t})),e.buttonClicked=!1,t.element.addEventListener("click",(function(n){e.buttonClicked||(e.buttonClicked=!0,e.updateRange(),e.modal.active()||("detached"!==t.type&&!1===e.range||t.click(e,t),n.preventDefault(),e.buttonClicked=!1))}))}))}},{key:"showSidebar",value:function(){var e=this;if(null==this.mainNode.querySelector(".editor-sidebar")){var t=[];this.toolbar.forEach((function(n){n.sidebar&&t.push(n.sidebar(e))})),this.sidebarNode=document.createElement("DIV"),this.sidebarNode.classList.add("editor-sidebar"),this.sidebarNode.classList.add("dont-break-out"),this.sidebarNode.innerHTML=function(e){var t="",n="";return e.forEach((function(e,a){var r=0==a?"active":"",o=0==a?"show":"",i=e.content?e.content:"You have no ".concat(e.label," in your document.");t+='<li><a href="#" class="tab-menu '.concat(r,'" data-tab-target="tab-').concat(a,'" title="').concat(e.label,'">').concat(e.icon,"</a></li>"),n+='\n            <div class="tab-item '.concat(o,'" data-tab-id="tab-').concat(a,'">\n                ').concat(i,"\n            </div>")})),'\n            <div class="editor-sidebar-content">\n                <ul class="tab-menu">'.concat(t,'</ul>\n                <div class="tab-content">').concat(n,"</div>\n            </div>")}(t);var n=this.sidebarNode.querySelector(".tab-menu").querySelectorAll("a");n.forEach((function(t){return t.addEventListener("click",(function(t){return e.handleTabMenuClicks(t,n)}))})),this.mainNode.appendChild(this.sidebarNode)}else this.updateSidebar()}},{key:"hideSidebar",value:function(){this.sidebarNode.remove()}},{key:"updateSidebar",value:function(){var e=this;if(null!=this.mainNode.querySelector(".editor-sidebar")){var t=[];this.toolbar.forEach((function(n){n.sidebar&&t.push(n.sidebar(e))})),t.forEach((function(t,n){var a=e.sidebarNode.querySelector('[data-tab-id="tab-'.concat(n,'"]'));""==t.content&&(t.content="You have no ".concat(t.label," in your document.")),a.innerHTML=t.content}))}}},{key:"handleTabMenuClicks",value:function(e,t){e.preventDefault(),e.stopPropagation();for(var n=e.currentTarget,a=n.dataset.tabTarget;null==a;)n.parentNode,ye("tab"),n.dataset.tabTarget,ye("tabTarget");t.forEach((function(e){return e.classList.remove("active")})),this.sidebarNode.querySelectorAll(".tab-item").forEach((function(e){return e.classList.remove("show")})),n.classList.add("active"),this.sidebarNode.querySelector('[data-tab-id="'.concat(a,'"]')).classList.add("show")}},{key:"listenForMouseUpEvents",value:function(){var e=this;document.addEventListener("mouseup",(function(t){var n=document.activeElement;if(!e.modal.active())if(n==e.editorNode)e.handleMouseUp();else{if(e.nodeInToolbar(t.target))return;e.resetRange()}}))}},{key:"resetRange",value:function(){var e=this;this.range=!1,this.toolbar.forEach((function(t){e.setState(t)}))}},{key:"nodeInEditor",value:function(e){for(;3==e.nodeType||"BODY"!=e.tagName||0!=e.contentEditable;){if(e==this.editorNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}},{key:"nodeInToolbar",value:function(e){for(;3==e.nodeType||"BODY"!=e.tagName;){if(e==this.toolbarNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}},{key:"setToolbarStates",value:function(){var e=this;!1!==this.range?this.toolbar.forEach((function(t){e.setState(t)})):this.toolbar.forEach((function(e){e.element.classList.remove("active")}))}},{key:"handleMouseUp",value:function(){this.updateRange(),!1!==this.range&&(""==this.editorNode.innerText&&this.insertParagraph(),this.highlightCustomNode(this.range.custom)),this.setToolbarStates()}},{key:"insertParagraph",value:function(){var e=document.createElement("P");e.innerText="\n",e=this.editorNode.appendChild(e),A(e,0),this.updateRange(),this.setToolbarStates(),this.buffer()}},{key:"listenForKeydownEvents",value:function(){var e=this;this.lastKey="",this.editorNode.addEventListener("keydown",(function(t){var n,a=!1;e.modal.active()&&(t.preventDefault(),a=!0),a||"Enter"!=t.key||(e.handleEnter()&&t.preventDefault(),a=!0),!a&&("Backspace"==t.key||"Delete"==t.key||t.ctrlKey&&"d"==t.key)&&(e.handleDelete(t.key)&&t.preventDefault(),a=!0),a||e.shortcuts.forEach((function(n){e.lastKey===n.shortcut&&t.key===n.trigger&&(t.preventDefault(),t.stopPropagation(),n.button.click(e,n.button),a=!0)})),a||!1===e.bufferUpdate||(t.ctrlKey||t.metaKey)&&"z"==t.key&&(t.preventDefault(),n=t.shiftKey?e.toolbar.find((function(e){return"REDO"==e.tag})):e.toolbar.find((function(e){return"UNDO"==e.tag})),n.element.click(),a=!0),e.lastKey=t.key}))}},{key:"handleEnter",value:function(){var e=this;if(this.updateRange(),!1!==this.range){var t=this.range.endContainer.textContent.trim().length==this.range.endOffset,n=!1;if(this.range.custom||t){var a="<br>"==this.range.blockParent.innerHTML,r="LI"==this.range.blockParent.tagName,o=a||!r?"P":this.range.blockParent.tagName,i=document.createElement(o);i.innerText="\n",i=p(i,this.range.blockParent),A(i,0),n=!0,setTimeout((function(){e.updateRange(),e.setStateForButtonType("block")}),10)}var l=this.range.blockParent;return l.childNodes.forEach((function(e){"false"==e.contentEditable&&setTimeout((function(){l.appendChild(e)}),10)})),this.range.custom&&this.highlightCustomNode(!1),n}}},{key:"handleDelete",value:function(e){var t=this;if("d"==e&&(e="Delete"),this.range){var n=new ge({type:"overlay",severity:"info",title:"Information",html:"\n                    <p>You are attempting to delete one or more active elements, such as comments or links.</p>\n                    <p>To delete active elements you need to edit them individually and choose Delete.</p>\n                    ",escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if("Backspace"==e&&0==this.range.startOffset){var a=this.range.blockParent.previousElementSibling;a.childNodes.forEach((function(e){"false"==e.contentEditable&&setTimeout((function(){a.appendChild(e)}),1)}))}else if("Delete"==e&&this.range.endContainer.textContent.trim().length==this.range.endOffset){var r=this.range.endContainer.nextElementSibling;if(r&&"false"==r.getAttribute("contenteditable"))return n.show(),!0}}else if(g(this.range).length>0)return n.show(),!0}return setTimeout((function(){return t.updateRange()}),10),!1}},{key:"listenForKeyupEvents",value:function(){var e=this;this.handleKeyup=function(e,t){var n;return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];n&&clearTimeout(n),n=setTimeout((function(){e.apply(void 0,r)}),t)}}(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",(function(t){0==["Shift","Meta","Ctrl"].includes(t.key)&&0==e.modal.active()&&e.handleKeyup(t.key,e)}))}},{key:"handleKeyupDelayed",value:function(){var e=arguments.length<=0?void 0:arguments[0],t=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"],n=arguments.length<=1?void 0:arguments[1];n.updateRange(),t.includes(e)&&n.setToolbarStates(),n.buffer()}},{key:"updateEventHandlers",value:function(){var e=this;this.toolbar.forEach((function(t){"addEventHandlers"in t&&t.addEventHandlers(e)}))}},{key:"listenForPasteEvents",value:function(){var e=this;["cut","copy","paste"].forEach((function(t){return e.editorNode.addEventListener(t,(function(n){e.handleCutCopyPaste(t)?n.preventDefault():setTimeout((function(){return e.buffer()}),100)}))}))}},{key:"handleCutCopyPaste",value:function(e){return this.updateRange(),!(0==this.range||"paste"!=e&&this.range.collapsed)&&g(this.range).length>0&&(navigator.clipboard.writeText(""),new ge({type:"overlay",severity:"info",title:"Information",html:"<p>Cut, copy and paste (of or over) selections with active elements, such as comments or links, is not supported.</p>\n                        <p>Please modify your selection and try again.</p>",escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0)}},{key:"testModals",value:function(e){var t=this;"overlay"==e?new ge({type:"overlay",title:"Example feedback modal",html:'\n                    <p>This is an example of an overlay modal.</p>\n                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>\n                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>',severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show():"drawer"==e?new ge({type:"drawer",title:"Example of an edit modal",html:'\n                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>\n                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>\n                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>',buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:function(){return alert("delete")}},confirm:{label:"Confirm",callback:function(){return alert("confirm")}}}}).show():"positioned"==e&&this.editorNode.addEventListener("click",(function(){t.updateRange();var e=new ge({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:'\n                        <div style="width:400px;padding:1rem;">\n                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>\n                            <p>The contents can be added as required.</p>\n                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>\n                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>\n                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>\n                        </div>'});e.show(),e.setPosition(t.range,t.editorNode)}))}},{key:"download",value:function(){var e=this.getCleanData(),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","arte-download.arte"),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}},{key:"handleFileUpload",value:function(e){var t=this,n=e.files[0];if(n){var a=new FileReader;a.onload=function(e){var n=e.target.result;t.initEditor(n)},a.readAsText(n),e.remove()}}},{key:"upload",value:function(){var e=this,t=document.getElementById("arte-upload");null==t&&((t=document.createElement("input")).id="arte-upload",t.type="file",t.style.display="none",t.accept=".arte",t.addEventListener("change",(function(){return e.handleFileUpload(t)}),!1),document.body.appendChild(t)),t.click()}},{key:"getCleanData",value:function(){var e=this.editorNode.cloneNode(!0),t=this.toolbar.filter((function(e){return null!=e.clean}));return w(e,t),e.innerHTML=e.innerHTML.replace(/[\n ]*?</gm,"<"),e.innerHTML}},{key:"updateEditor",value:function(e){this.editorNode.innerHTML=e}},{key:"updateRange",value:function(){var e,t;this.modal.active()||(this.range=function(e){var t,n,a=window.getSelection();if(1==a.rangeCount){var r=a.getRangeAt(0);if(r.commonAncestorContainer==e||(t=e)!==(n=r.commonAncestorContainer)&&t.contains(n))return x(r)}return!1}(this.editorNode),this.options.debug&&(e=this.debugTarget,t=this.range,0!=e&&(e.innerHTML=!1===t?"<p>No range selected</p>":'\n                <h5>Selection info:</h5>\n                <div class="col">\n                    <label>Block parent</label><span>'.concat(t.blockParent.tagName,"</span>\n                    <label>commonAncestorC</label><span>").concat(t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent,"</span>\n                    <label>rootNode</label><span>").concat(t.rootNode.tagName,"</span>\n                    <label>collapsed</label><span>").concat(t.collapsed,"</span>\n                    <label>custom</label><span>").concat(t.custom?t.custom.tagName:"false",'</span>\n                </div>\n                <div class="col">\n                    <label>startC</label><span>').concat(t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent,"</span>\n                    <label>startOffset</label><span>").concat(t.startOffset,"</span>\n                    <label>endC</label><span>").concat(t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent,"</span>\n                    <label>endOffset</label><span>").concat(t.endOffset,"</span>\n                </div>"))))}},{key:"highlightCustomNode",value:function(e){this.editorNode.querySelectorAll("[contenteditable=false]").forEach((function(e){e.classList.remove("custom-selected")})),e&&e.classList.add("custom-selected")}},{key:"buffer",value:function(){!1!==this.updateBuffer&&this.updateBuffer(this),this.updateSidebar(!1)}}],n&&Ne(t.prototype,n),a&&Ne(t,a),e}();const Ee=Ce;const Se=function e(t,n,a,r,o,i){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.tag=n,this.label=a,this.input="button",this.icon=r,this.click=o,this.element=null,null!=i&&Object.keys(i).forEach((function(e){l[e]=i[e]}))};var Le,Te,xe,Ae=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.size=t,this.index=-1,this.buffer=[]},Oe=[],qe=function(e,t){var n=Oe[e.id];"UNDO"==t.tag?t.element.disabled=n.buffer.length<=1||n.index<=0:t.element.disabled=n.index>=n.buffer.length-1},He=function(e){void 0!==Oe[e]&&(Oe[e].buffering=!1)},De={init:function(e){e.buffer&&e.options.bufferSize>0&&(Oe[e.id]=new Ae(e.options.bufferSize))},setState:qe,update:function(e){if(void 0!==Oe[e.id]){var t=Oe[e.id];if(!(t.buffer.length>0&&e.editorNode.innerHTML==t.buffer[t.buffer.length-1])){if(t.buffer.length>t.size&&t.buffer.shift(),t.index+1<t.buffer.length)for(var n=t.buffer.length-(t.index+1),a=0;a<n;a++)t.buffer.pop();t.buffer.push(e.editorNode.innerHTML),t.index=t.buffer.length-1,qe(e,Pe),qe(e,Re)}}},buffering:function(e){return void 0!==Oe[e]&&Oe[e].buffering},restart:function(e){void 0!==Oe[e]&&(Oe[e].buffering=!0)},pause:He},Me={setState:qe},Pe=new Se("detached","UNDO","Undo",z,(function(e){e.buffer&&He(e.id);var t=Oe[e.id];t.index>0&&(t.index--,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),qe(e,Pe),qe(e,Re),e.updateEventHandlers()}),De),Re=new Se("detached","REDO","Redo",G,(function(e){e.buffer&&He(e.id);var t=Oe[e.id];t.index+1<t.buffer.length&&(t.index++,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),qe(e,Pe),qe(e,Re),e.updateEventHandlers()}),Me),Ie="",Ue=function(e,t){Le=e.startContainer,Te=e.endContainer,t&&(Le=y(Le),Te=y(Te)),Ie="pre"},Be=function(e){e==Le?(Ie="first",e==Te&&(Ie="both")):e==Te?Ie="last":"first"==Ie?Ie="during":"both"==Ie||"last"==Ie?Ie="post-first":"post-first"==Ie&&(Ie="post")},Fe=function(){return"pre"==Ie},Ke=function(){return"first"==Ie||"both"==Ie},je=function(){return"post-first"==Ie||"post"==Ie};function Ve(e){return function(e){if(Array.isArray(e))return Ye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ye(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ze,Ge=[],We=!1;function Qe(e,t){var n,a=ze,r=function(e){var t="";return e.childNodes.forEach((function(e){if(3===e.nodeType){var n=e.textContent;n.includes("\n")&&(n=n.trim()),t+=n}else(h(e)||m(e)||"BR"===e.tagName)&&(t+=e.outerHTML)})),t}(e),o=[],i=(o="during"==Ie||"first"==Ie||"last"==Ie||"both"==Ie?t.newFormats:t.oldFormats).slice(-1)[0];e.nodeType;if(!(1!==e.nodeType||""==r&&e.innerHTML.includes("<"))){if(0==Ge.length)o.forEach((function(e){n=document.createElement(e),a=a.appendChild(n)}));else if(o.length>Ge.length){if(function(e,t){return e.every((function(e,n){return t[n]==e}))}(Ge,o)){for(var l=0;l<Ge.length;l++)a=a.lastElementChild;for(var s=Ge.length;s<o.length;s++)n=document.createElement(o[s]),a=a.appendChild(n)}}else(function(e,t){return(0==e.length||0==t.length||e.length==t.length)&&e.every((function(e,n){return t[n]==e}))})(o,Ge)&&(We&&We!=ze&&(a=We.parentNode),n=document.createElement(i),a=a.appendChild(n));if(a==ze){var c=0;o.forEach((function(e,t){e==Ge[t]&&0==(t==o.length-1&&"LI"==e)&&(a=a.lastElementChild,c++)}));for(var d=c;d<o.length;d++)n=document.createElement(o[d]),a=a.appendChild(n)}We=a,Ge=o.slice(),""!=r&&(a.innerHTML=r)}}function _e(e,t,n){var a={oldFormats:[],newFormats:[]};e!=xe&&(Be(e),a=function(e,t,n){var a=[].concat(Ve(t.oldFormats),[e.tagName]),r=[];if(Fe()||je())return{newFormats:r=Ve(a),oldFormats:a};if("block"===n.type)return{newFormats:r=[n.newFormat],oldFormats:a};if(Ke())return"LI"==e.tagName?e.parentNode.firstElementChild==e?(r.pop(),r.push(n.newFormat),r.push("LI")):((r=t.oldFormats.slice()).push(n.newFormat),r.push("LI")):(r.push(n.newFormat),r.push("LI")),{newFormats:r,oldFormats:a};return{newFormats:r=Ge.slice(),oldFormats:a}}(e,t,n),Qe(e,a)),e.childNodes.forEach((function(e){(v(e)||b(e))&&_e(e,a,n)}))}var $e=function(e,t){var n=e.range;xe=e.editorNode,Ge=[],We=!1,function(e){e.action="apply",("CLEAR"==e.tag||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,"block"==e.type&&"remove"==e.action&&(e.newFormat="P")}(t);var a=k(n.rootNode,xe),r=k(n.startContainer,xe),o=k(n.endContainer,xe);if(!1!==a&&!1!==r&&!1!==o){if(n.rootNode=a,function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+N+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+C+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+N+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+C+e.endContainer.textContent.substring(e.endOffset))}(n),Ue(n,!0),r==o)ze=document.createElement("DIV"),_e(r,{oldFormats:[],newFormats:[]},t),r==xe?r.innerHTML=ze.innerHTML:r.outerHTML=ze.innerHTML;else{var i=!1,l=!1;ze=document.createElement("DIV"),n.rootNode.childNodes.forEach((function(e){1===e.nodeType&&(e==r&&(i=!0),i&&0==l&&("block"===t.type&&(Ge=[],We=!1,ze=document.createElement("DIV")),_e(e,{oldFormats:[],newFormats:[]},t),"block"===t.type?e.outerHTML=ze.innerHTML:e.setAttribute("data-remove",!0)),e==o&&(l=!0,"list"===t.type&&(e.outerHTML=ze.innerHTML),xe.querySelectorAll("[data-remove=true]").forEach((function(e){return e.remove()}))))}))}q(e.editorNode),e.updateRange(),e.setStateForButtonType("block"),e.buffer(),e.updateEventHandlers()}},Je=function(e,t){if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{var n=y(e.range.startContainer,e.editorNode);if(!1===n)return;t.element.disabled="DIV"===n.tagName||m(n)||n.tagName==t.tag,"list"===t.type&&"LI"===n.tagName&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}};function Xe(e){return e.id&&e.removeAttribute("id"),e}var Ze={setState:Je},et=new Se("block","H1","Heading 1",M,$e,{clean:Xe,sidebar:function(e){var t=e.editorNode.querySelectorAll("H1,H2,H3"),n="";return t.forEach((function(e){var t=e.tagName;e.id=H(),n+="<".concat(t,'><a href="#').concat(e.id,'">').concat(e.innerHTML,"</a></").concat(t,">")})),{icon:ue,label:"headings",content:"".concat(n)}},setState:Je}),tt=new Se("block","H2","Heading 2",P,$e,{clean:Xe,setState:Je}),nt=new Se("block","H3","Heading 3",R,$e,{clean:Xe,setState:Je}),at=new Se("block","P","Paragraph",I,$e,Ze),rt=new Se("block","BLOCKQUOTE","Blockquote",U,$e,Ze),ot=new Se("list","OL","Ordered list",B,$e,Ze),it=new Se("list","UL","Unordered list",F,$e,Ze);function lt(e){return function(e){if(Array.isArray(e))return st(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return st(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function ct(e,t){var n="",a="",r="";return"both"==Ie?(a=e.textContent.substring(0,t.startOffset),n=N+e.textContent.substring(t.startOffset,t.endOffset)+C,r=e.textContent.substring(t.endOffset)):Ke()?(a=e.textContent.substring(0,t.startOffset),n=N+e.textContent.substring(t.startOffset)):"last"==Ie?(n=e.textContent.substring(0,t.endOffset)+C,r=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:a,text:n,postText:r}}function dt(e,t,n){if(0==e.length)return t;for(var a=[],r=[],o=0;o<e.length;o++){var i=e[o].split(":");a.push(i[0].trim()),r.push(i[1].trim())}for(var l=0;l<a.length;l++)for(var s=0;s<a.length;s++)a[l]==a[s]&&l>s&&(a[s]="");for(var c="",d=0;d<a.length;d++)""!=a[d]&&(c+="".concat(a[d],":").concat(r[d],";"));var u='<span style="'.concat(c,'">').concat(t);return n&&(u+="</span>"),u}var ut,ft,pt,ht,bt=function(e,t){"CLEAR"==t.tag&&t.element.classList.remove("active"),t.element.disabled=e.range.collapsed||e.range.rootNode==e.rootNode||b(e.range.rootNode),mt(t);var n=function(e){for(var t="";0==v(e);){if(1===e.nodeType){var n=e.getAttribute("style");null!=n&&""!=n&&(t+=";"+n)}e.parentNode,e=e.parentNode}return t}(e.range.startContainer);n.includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")},vt=function(e,t,n,a){return 3===e.nodeType?function(e,t,n,a){Be(e);var r=ct(e,a),o=r.preText,i=r.text,l=r.postText,s="";if(Fe()||je())s+=dt(t,i,!0);else{var c="".concat(n.newStyle,":").concat(n.newValue),d=function(e,t){var n=-1;return e.forEach((function(e,a){e==t&&(n=a)})),n}(t,c),u=!0;if(o&&(0==t.length?s+=o:(u=!0,"apply"==n.action&&(d>-1||""!=l)&&(u=!1),s+=dt(t,o,u))),i)if("apply"==n.action)if(d>-1&&0==u)s+=i;else{var f=[];f=u?[].concat(lt(t),[c]):[c],s+=dt(f,i,!0)}else"remove"!=n.action&&"clear"!=n.action||(s+=i);l&&(0==t.length?s+=l:u?s+=dt(t,l,!0):(s+=l,t.forEach((function(){return s+="</span>"}))))}return s}(e,t,n,a):m(e)?e.outerHTML:function(e,t,n,a){if("SPAN"===e.tagName){var r=e.getAttribute("style");null!=r&&""!=r&&r.split(";").forEach((function(e){if(""!=e){var n=e.split(":");0==t.includes(n[0].trim())&&(t=[].concat(lt(t),[e]))}}))}var o="";return e.childNodes.forEach((function(e){o+=vt(e,t,n,a)})),o}(e,t,n,a)},mt=function(e){var t=e.style.split(":");e.newStyle=t[0],e.newValue=void 0!==t[1]?t[1]:"",e.action="apply",e.element.classList.contains("active")&&"CLEAR"!=e.style?e.action="remove":"CLEAR"==e.style&&(e.action="clear")},gt=function(e,t){var n=e.range;if(0==v(n.rootNode)){var a=y(n.rootNode);if(!1===a)return;n.rootNode=a}mt(t),Ue(n,!1);var r=vt(n.rootNode,[],t,n);!function(e,t,n){null==e||e.parentNode;var a=document.createElement(t);a.innerHTML=n;var r=e.parentNode.insertBefore(a,e);e.parentNode.removeChild(e)}(n.rootNode,n.rootNode.tagName,r);q(e.editorNode),e.updateRange(),t.setState(e,t),e.buffer(),e.updateEventHandlers()},yt={setState:bt,style:"font-weight:bold"},kt=new Se("style","B","Bold",K,gt,yt),wt=new Se("style","I","Italic",j,gt,yt={setState:bt,style:"font-style:italic"}),Nt=new Se("style","U","Underline",V,gt,yt={setState:bt,style:"text-decoration:underline"}),Ct=new Se("style","CLEAR","Clear",Y,gt,yt={setState:bt,style:"CLEAR"}),Et=[],St=0,Lt=null;function Tt(e){var t="";return Et.forEach((function(n){var a=n.toLowerCase();(""==e||a.includes(e))&&(t+="<li>".concat(n,"</li>"))})),t}function xt(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];St>=0&&ft.length>0&&(ft.forEach((function(e){return e.classList.remove("selected")})),ft[St].classList.add("selected"),e&&ft[St].scrollIntoView({block:"end",inline:"nearest"}))}function At(e){var t=e.key,n=e.shiftKey,a=!1;(e.preventDefault(),e.stopPropagation(),0==ft.length?St=-1:"ArrowDown"==t||"ArrowRight"==t||"Tab"==t&&0==n?(e.preventDefault(),St<ft.length-1?St++:St=0,a=!0,xt()):("ArrowUp"==t||"ArrowLeft"==t||"Tab"==t&&n)&&(e.preventDefault(),0==St?St=ft.length-1:St--,a=!0,xt()),0==a)&&("Enter"!=t?(pt.innerHTML=Tt(ht.value.toLowerCase()),ft=pt.querySelectorAll("li"),St=0,xt()):qt(-1!=St?ft[St].textContent:ht.value))}function Ot(e){qt(e.target.textContent)}function qt(e){var t=ut.range.startContainer.textContent,n=ut.range.startOffset,a=t.substring(0,n),r=t.substring(n);"@"===r.charAt(0)&&(r=r.slice(1,r.length)),""!=e&&(32!==t.charCodeAt(n-1)&&(e=" "+e),n<t.length&&32!==t.charCodeAt(n)&&(""!=r&&(r+=" "),e+=" ")),ut.range.startContainer.textContent=a+e+r,n+=e.length,ut.range=A(ut.range.startContainer,n),Lt.hide(),ut.buffer()}var Ht=function(){qt("")};var Dt,Mt,Pt,Rt,It=function(e){Et=e.sort()},Ut={setState:function(e,t){t.element.disabled=0==e.range.collapsed||!1!==e.range.custom},shortcut:["@","@"]},Bt=new Se("custom","MENTION","Mention",W,(function(e,t){var n;!1!==e.range&&(ut=e,(Lt=new ge({type:"positioned",escape:Ht,html:(n=Tt(""),'<div class="mentions">\n                <input type="text"/>\n                <ul>'.concat(n,"</ul>\n            </div>"))})).show(),Lt.setPosition(ut.range,ut.editorNode),Lt.container.addEventListener("keyup",At),(pt=Lt.container.querySelector("ul")).addEventListener("click",Ot),ft=pt.querySelectorAll("li"),St=0,xt(!1),(ht=Lt.container.querySelector("input")).value="",ht.focus())}),Ut),Ft="A",Kt=null,jt=null;function Vt(){jt.hide(),Kt.hide()}function Yt(){Rt?(jt=new ge({type:"overlay",severity:"warning",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:Vt}}})).show():Kt.hide()}function zt(){jt.hide(),Kt.hide(),Pt.remove(),Dt.range=!1,an(Dt,Mt),Dt.buffer()}function Gt(){(jt=new ge({type:"overlay",severity:"danger",html:"Do you really want to delete this link?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:zt}}})).show()}function Wt(e){Kt&&Kt.active()||(Pt=e,Qt("",!0))}function Qt(e,t){var n="Create link",a={cancel:{label:"Cancel",callback:Yt},confirm:{label:"Save",callback:_t}};t?(n="Edit link",a.delete={label:"Delete",callback:Gt}):((Pt=document.createElement(Ft)).id=H(),Pt.setAttribute("contenteditable","false"),Pt.href="",Pt.dataset.label=e,Pt.dataset.display=0),(Kt=new ge({type:"drawer",title:n,html:Jt(t),buttons:a})).show(),Rt=!1,Kt.panel.querySelectorAll("form input").forEach((function(e){return e.addEventListener("change",(function(){return Rt=!0}))}));var r=Kt.panel.querySelector("form #href");r.focus(),r.setSelectionRange(r.value.length,r.value.length)}function _t(){Pt.href=Kt.panel.querySelector("form #href").value.trim(),Pt.dataset.label=Kt.panel.querySelector("form #label").value.trim(),Pt.dataset.display=parseInt(Kt.panel.querySelector("form #display").value),null==Pt.parentNode&&function(e){var t,n=e.range.startContainer.parentNode,a=e.range.startContainer.textContent.substring(0,e.range.startOffset);e.range.collapsed?(t=e.range.startContainer.textContent.substring(e.range.startOffset)," "!=a.charAt(a.length+1)&&(a+=" ")," "!=t.charAt(0)&&(t=" "+t)):t=e.range.startContainer.textContent.substring(e.range.endOffset);a&&n.insertBefore(document.createTextNode(a),e.range.startContainer);Pt=n.insertBefore(Pt,e.range.startContainer),t&&n.insertBefore(document.createTextNode(t),e.range.startContainer);e.range.startContainer.remove()}(Dt),Kt.hide(),$t(Pt),Dt.range=A(Pt,0),an(Dt,Mt),Dt.buffer()}function $t(e){0==e.id&&(e.id=H()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerText=function(e){switch(parseInt(e.dataset.display)){case 0:if(e.dataset.label)return e.dataset.label;break;case 1:return e.href;case 2:if(e.dataset.label&&e.dataset.label!=e.href)return"".concat(e.dataset.label," (").concat(e.href,")")}return e.href}(e),e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Wt(e)}))}function Jt(e){var t="",n="http://",a=Pt.dataset.label,r=Pt.dataset.display?Pt.dataset.display:0;return e&&(n=Pt.href,t='<a href="'.concat(n,'" class="panel-link" target="_blank" title="Open link in new tab or window">').concat(X,"</a>")),'\n        <form class="arte-link">\n            <div class="form-input">\n                <label for="href">URL</label>\n                <input id="href" type="url" class="form-control '.concat(t?"with-button":"",'" placeholder="URL" required value="').concat(n,'">\n                ').concat(t,'\n            </div>\n            <div class="form-input">\n                <label for="label">Label (optional)</label>\n                <input id="label" type="text" class="form-control" placeholder="Label" value="').concat(a,'">\n            </div>\n            <div class="form-input">\n                <label for="label">Display option</label>\n                <select class="form-control" id="display">\n                    <option value="0" ').concat(0==r?"selected":"",'>Label only</option>\n                    <option value="1" ').concat(1==r?"selected":"",'>Link only</option>\n                    <option value="2" ').concat(2==r?"selected":"",">Label and link</option>\n                </select>\n            </div>\n        </form>")}var Xt,Zt,en,tn,nn,an=function(e,t){!1===e.range||e.range.rootNode==e.editorNode||b(e.range.rootNode)?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(Ft)?t.element.classList.add("active"):t.element.classList.remove("active"))},rn={init:function(e,t){Mt=t,(Dt=e).editorNode.querySelectorAll(Ft).forEach((function(e){return $t(e)}))},setState:an,addEventHandlers:function(e){Mt=on,(Dt=e).editorNode.querySelectorAll(Ft).forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Wt(e)}))}))},clean:function(e){return e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.innerText=" ",e},sidebar:function(e){var t=e.editorNode.querySelectorAll(Ft),n="";return t.forEach((function(e){n+='\n            <article>\n                <a href="#'.concat(e.id,'">').concat(e.dataset.label," (").concat(e.href,")</a>\n            </article>")})),{icon:Q,label:"links",content:"".concat(n)}}},on=new Se("custom",Ft,"Link",Q,(function(e,t){if(!(Kt&&Kt.active()||(Mt=t,!1===(Dt=e).range))){var n="";0==Dt.range.collapsed&&Dt.range.startContainer==Dt.range.endContainer&&(n=Dt.range.endContainer.textContent.substring(Dt.range.startOffset,Dt.range.endOffset)),Qt(n,!1)}}),rn),ln=100/30,sn=100/30,cn=null;function dn(e,t){(cn.panel.querySelectorAll(".active").forEach((function(e){return e.classList.remove("active")})),null==e)?(cn.panel.querySelectorAll(".colours .hues span").forEach((function(e,t){var n=12*t;e.style.backgroundColor="hsl(".concat(n,",100%,50%)"),n==Xt&&e.classList.add("active")})),cn.panel.querySelectorAll(".colours .saturations span").forEach((function(e,t){var n=t*ln;e.style.backgroundColor="hsl(".concat(Xt,",").concat(n,"%,50%)"),n==Zt&&e.classList.add("active")})),cn.panel.querySelectorAll(".colours .lightnesses span").forEach((function(e,t){var n=t*sn;e.style.backgroundColor="hsl(".concat(Xt,",50%,").concat(n,"%)"),n==en&&e.classList.add("active")}))):(e.classList.add("active"),Xt=0,Zt=100,en="black"==t?0:100);cn.panel.querySelector("form .result span").style.backgroundColor="hsl(".concat(Xt,",").concat(Zt,"%,").concat(en,"%)")}function un(){for(var e="",t="",n="",a=0;a<30;a++)e+='<span class="colour" data-colour="hue" data-index="'.concat(a,'">&nbsp;</span>'),t+='<span class="colour" data-colour="saturation" data-index="'.concat(a,'">&nbsp;</span>'),n+='<span class="colour" data-colour="lightness" data-index="'.concat(a,'">&nbsp;</span>');return'\n        <form id="colour-menu">\n\n            <div class="colours">\n                <div class="hues">\n                    <label>Hue</label>\n                    <div>'.concat(e,'</div>\n                </div>\n                <div class="saturations">\n                    <label>Saturation</label>\n                    <div>').concat(t,'</div>\n                </div>\n                <div class="lightnesses">\n                    <label>Lightness</label>\n                    <div>').concat(n,'</div>\n                </div>\n            </div>\n\n            <div class="result">\n                <label>Result</label>\n                <span class="final">&nbsp;</span>\n                <label>Black and white</label>\n                <span class="black-and-white" data-colour="black">&nbsp;</span>\n                <span class="black-and-white" data-colour="white">&nbsp;</span>\n            </div>\n            \n        </form>')}function fn(){Xt=Math.round(Xt),Zt=Math.round(Zt),en=Math.round(en);var e="hsl(".concat(Xt,", ").concat(Zt,"%, ").concat(en,"%)"),t={setState:gn,style:"".concat(nn.style,":").concat(e),element:nn.element};cn.hide(),gt(tn,t)}var pn,hn,bn,vn,mn=function(e,t){cn&&cn.active()||(nn=t,!1===(tn=e).range||tn.range.collapsed?new ge({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show():function(){Xt=0,Zt=29*ln,en=50;var e="Select highlight colour";"FGC"==nn.tag&&(e="Select text colour"),(cn=new ge({type:"drawer",title:e,html:un(),escape:!0,buttons:{cancel:{label:"Cancel"},confirm:{label:"Set",callback:fn}}})).show(),dn(),cn.panel.querySelectorAll("span.colour").forEach((function(e){return e.addEventListener("click",(function(e){var t=e.target,n=t.dataset.colour,a=t.dataset.index;switch(n){case"hue":Xt=12*a;break;case"saturation":Zt=a*ln;break;case"lightness":en=a*sn}dn()}))})),cn.panel.querySelectorAll("span.black-and-white").forEach((function(e){return e.addEventListener("click",(function(e){var t=e.target.dataset.colour;dn(e.target,t)}))}))}())},gn=function(e,t){t.element.disabled=!1===e.range||e.range.collapsed||e.range.rootNode==e.editorNode||b(e.range.rootNode);var n="",a=e.range.startContainer.parentNode.getAttribute("style");null!=a&&a.split(";").forEach((function(e){if(""!==e){var a=e.split(":");a[0].trim()===t.style&&(n=a[1].trim(),t.element.querySelector("span.bar").setAttribute("style","background-color:".concat(n,";")))}})),""==n&&t.element.querySelector("span.bar").removeAttribute("style")},yn=function(e,t){var n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")},kn={init:yn,setState:gn,style:"color"},wn=new Se("inline","FGC","Text colour",_,mn,kn),Nn=new Se("inline","BGC","Highlight colour",$,mn,kn={init:yn,setState:gn,style:"background-color"}),Cn="CUSTOM",En=null,Sn=null;function Ln(e){En&&En.active()||(bn=e,qn(!0))}function Tn(){Sn.hide(),En.hide()}function xn(){Sn.hide(),En.hide(),bn.remove(),pn.range=!1,Bn(pn,hn),pn.buffer()}function An(){vn?(Sn=new ge({type:"overlay",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:Tn}}})).show():En.hide()}function On(){(Sn=new ge({type:"overlay",severity:"danger",title:"Delete item",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete",callback:xn}}})).show()}function qn(e){var t="Create custom active element",n={cancel:{label:"Cancel",callback:An},confirm:{label:"Save",callback:Hn}};e?(t="Edit custom active element",n.delete={label:"Delete",callback:On}):((bn=document.createElement(Cn)).id=H(),bn.setAttribute("contenteditable","false"),bn.innerHTML=Mn({property1:" ",property2:" ",property3:" "}));var a,r={property1:bn.querySelector(".property1").innerText,property2:bn.querySelector(".property2").innerText,property3:bn.querySelector(".property3").innerText};(En=new ge({type:"drawer",title:t,html:(a=r,'\n        <form>\n            <div class="form-input">\n                <label for="property1">Property 1</label>\n                <input id="property1" type="text" class="form-control" placeholder="Property 1" required value="'.concat(a.property1,'">\n            </div>\n            <div class="form-input">\n                <label for="property2">Property 2</label>\n                <input id="property2" type="text" class="form-control" placeholder="Property 2" required value="').concat(a.property2,'">\n            </div>\n            <div class="form-input">\n                <label for="property3">Property 3</label>\n                <input id="property3" type="text" class="form-control" placeholder="Property 3" required value="').concat(a.property3,'">\n            </div>\n        </form>')),buttons:n})).show(),vn=!1,En.panel.querySelectorAll("form input").forEach((function(e){return e.addEventListener("change",(function(){return vn=!0}))}));var o=En.panel.querySelector("form input#property1");o.focus(),o.setSelectionRange(o.value.length,o.value.length)}function Hn(){bn.querySelector(".property1").innerText=En.panel.querySelector("form #property1").value.trim(),bn.querySelector(".property2").innerText=En.panel.querySelector("form #property2").value.trim(),bn.querySelector(".property3").innerText=En.panel.querySelector("form #property3").value.trim(),null==bn.parentNode&&(bn=pn.range.startContainer.parentNode.appendChild(bn)),En.hide(),Dn(bn),pn.range=A(bn,0),Bn(pn,hn),pn.buffer()}function Dn(e){e.id;0==e.id&&(e.id=H());var t={property1:e.querySelector(".property1").innerText,property2:e.querySelector(".property2").innerText,property3:e.querySelector(".property3").innerText};e.innerHTML=Mn(t),e.setAttribute("contenteditable",!1);var n=document.createElement("button");n.type="button",n.classList.add("edit"),n.innerText="Edit",n.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Ln(e)})),e.appendChild(n),e.addEventListener("click",(function(){Bn(pn,hn)}))}function Mn(e){return'\n        <span class="title">I am an active object with 3 properties:</span>\n        <span class="label">Property 1:</span><span class="prop property1">'.concat(e.property1,'</span>\n        <span class="label">Property 2:</span><span class="prop property2">').concat(e.property2,'</span>\n        <span class="label">Property 3:</span><span class="prop property3">').concat(e.property3,'</span>\n        <span class="advice">Click the top right-hand button to edit. Select anywhere in the element and then the Enter key to add a new line after this custom element.</span>\n    ')}var Pn,Rn,In,Un,Bn=function(e,t){!1===e.range||e.range.rootNode==e.editorNode||b(e.range.rootNode)?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(Cn)?t.element.classList.add("active"):t.element.classList.remove("active"))},Fn={setState:Bn,init:function(e,t){pn=e,hn=t,e.editorNode.querySelectorAll(t.tag).forEach((function(e){return Dn(e)}))},addEventHandlers:function(e){hn=Kn,(pn=e).editorNode.querySelectorAll("CUSTOM button").forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Ln(e.parentNode)}))}))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector(".title").remove(),e.querySelector(".advice").remove(),e.querySelectorAll(".label").forEach((function(e){return e.remove()})),e.querySelector("button").remove(),e}},Kn=new Se("custom",Cn,"Custom",J,(function(e,t){if(!En||!En.active()){hn=t;var n=(pn=e).range.blockParent.querySelector(Cn);null!=n?Ln(n):qn(!1)}}),Fn),jn="COMMENT",Vn=null,Yn=null;function zn(e){Vn&&Vn.active()||(In=e,Jn(!0))}function Gn(){Yn.hide(),Vn.hide()}function Wn(){Yn.hide(),Vn.hide(),In.remove(),Pn.range=!1,na(Pn,Rn),Pn.buffer()}function Qn(){Un?(Yn=new ge({type:"overlay",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No"},confirm:{label:"Yes - lose changes",callback:Gn}}})).show():Vn.hide()}function _n(){(Yn=new ge({type:"overlay",severity:"danger",title:"Delete changes",html:"Do you really want to delete this comment?",buttons:{cancel:{label:"No"},confirm:{label:"Yes - delete",callback:Wn}}})).show()}function $n(e){"false"==In.dataset.resolved?(In.dataset.resolved="true",resolve.innerHTML=ie+" Unresolve"):In.dataset.resolved="false",e.target.innerHTML=ea()}function Jn(e){var t="Add comment",n={cancel:{label:"Cancel",callback:Qn},confirm:{label:"Save",callback:Xn}};e?(t="Edit comment",n.delete={label:"Delete",callback:_n}):((In=document.createElement(jn)).id=H(),In.setAttribute("contenteditable","false"),In.dataset.comment="",In.dataset.created="",In.dataset.updated="",In.dataset.resolved="false"),(Vn=new ge({type:"drawer",title:t,html:ta(),buttons:n})).show(),Un=!1;var a=Vn.panel.querySelector("form textarea#comment");a.addEventListener("change",(function(){return Un=!0}));var r=Vn.panel.querySelector("form button#resolve");null!=r&&r.addEventListener("click",$n),a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function Xn(){In.dataset.comment=Vn.panel.querySelector("form #comment").value.trim();var e=(new Date).toLocaleString().slice(0,-3);""!=In.dataset.comment&&(null==In.parentNode&&(In.dataset.created=e,In=Pn.range.startContainer.parentNode.appendChild(In)),In.dataset.updated=e,Vn.hide(),Zn(In),Pn.range=A(In,0)),na(Pn,Rn),Pn.buffer()}function Zn(e){e.id;0==e.id&&(e.id=H()),e.innerHTML="",e.setAttribute("contenteditable",!1);var t=document.createElement("button");t.type="button",t.classList.add("edit"),t.innerHTML=ae,t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),zn(e)})),e.appendChild(t),e.addEventListener("click",(function(){na(Pn,Rn)}))}function ea(){return"true"==In.dataset.resolved?ie+" Unresolve":oe+" Resolve"}function ta(){var e="";""!=In.dataset.created&&(e="<span><label>Created</label> ".concat(In.dataset.created,"</span>")),""!=In.dataset.updated&&(e+="<span><label>Updated</label> ".concat(In.dataset.updated,"</span>"));var t="";if(""!=e){e='<div class="timestamps">'.concat(e,"</div>");var n=ea();t='<button type="button" id="resolve">'.concat(n,"</button>")}return'\n        <form class="comment">\n            <div class="form-input">\n                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>'.concat(In.dataset.comment,"</textarea>\n            </div>\n            ").concat(e,"\n            ").concat(t,"\n        </form>")}var na=function(e,t){!1===e.range||e.range.rootNode==e.editorNode||0==v(e.range.rootNode)?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(jn)?t.element.classList.add("active"):t.element.classList.remove("active"))},aa={setState:na,init:function(e,t){Pn=e,Rn=t,e.editorNode.querySelectorAll(t.tag).forEach((function(e){return Zn(e)}))},addEventHandlers:function(e){Rn=ra,(Pn=e).editorNode.querySelectorAll("COMMENT button").forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),zn(e.parentNode)}))}))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector("button").remove(),e},sidebar:function(e){var t=e.editorNode.querySelectorAll(jn),n="";return t.forEach((function(e){var t="true"==e.dataset.resolved?"comment-resolved":"comment-unresolved";n+='\n            <article>\n                <a href="#'.concat(e.id,'">').concat(e.dataset.comment,' <span class="comment-bubble ').concat(t,'">').concat(ae,'</span></a>\n                <p class="sub-title">Added: ').concat(e.dataset.created,"</p>\n            </article>")})),{icon:ne,label:"comments",content:"".concat(n)}}},ra=new Se("custom",jn,"Custom",ne,(function(e,t){if(!Vn||!Vn.active()){Rn=t;var n=(Pn=e).range.blockParent.querySelector(jn);null!=n?zn(n):Jn(!1)}}),aa),oa=null;function ia(e){localStorage.setItem("headingNumbers",e.options.headingNumbers),e.options.headingNumbers?e.editorNode.classList.add("heading-numbers"):e.editorNode.classList.remove("heading-numbers")}function la(e){localStorage.setItem("theme",e),document.documentElement.className=e}function sa(){oa.hide()}function ca(e){(oa=new ge({type:"drawer",escape:!0,title:"Options",html:da(e.options),buttons:{cancel:{label:"Close",callback:sa}}})).show(),oa.panel.querySelectorAll("form input").forEach((function(t){return t.addEventListener("change",(function(t){"headingNumbers"==t.target.name?(e.options.headingNumbers="on"==t.target.id,ia(e)):"theme"==t.target.name?(e.options.theme=t.target.id,la(e.options.theme)):"explorer"==t.target.name&&(e.options.explorer="show-explorer"==t.target.id,function(e){localStorage.setItem("explorer",e.options.explorer),e.options.explorer?e.showSidebar():e.hideSidebar()}(e))}))}))}function da(e){return'\n        <form>\n            <div class="form-input options">\n                <label>Heading numbers</label>\n                <label>\n                    <input name="headingNumbers" id="on" type="radio" class="form-control first" '.concat(e.headingNumbers?"checked":"",'/> On\n                </label>\n                <label>\n                    <input name="headingNumbers" id="off" type="radio" class="form-control" ').concat(e.headingNumbers?"":"checked",'/> Off\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Theme</label>\n                <label>\n                    <input name="theme" id="theme-light" type="radio" class="form-control first" ').concat("theme-light"==e.theme?"checked":"",'/> Light\n                </label>\n                <label>\n                    <input name="theme" id="theme-dark" type="radio" class="form-control" ').concat("theme-dark"==e.theme?"checked":"",'/> Dark\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Explorer</label>\n                <label>\n                    <input name="explorer" id="show-explorer" type="radio" class="form-control first" ').concat(e.explorer?"checked":"",'/> Show\n                </label>\n                <label>\n                    <input name="explorer" id="hide-explorer" type="radio" class="form-control" ').concat(0==e.explorer?"checked":"","/> Hide\n                </label>\n            </div>\n        </form>")}var ua={setState:function(e,t){t.element.disabled=!1},init:function(e,t){var n=localStorage.getItem("theme");n&&(e.options.theme=n),la(e.options.theme);var a=localStorage.getItem("headingNumbers");localStorage.getItem("headingNumbers")&&(e.options.headingNumbers=a),ia(e)}},fa=new Se("detached","SETTINGS","Preferences",re,(function(e,t){oa&&oa.active()||ca(e)}),ua);return t})()}));