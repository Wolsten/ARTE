!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ARTE",[],t):"object"==typeof exports?exports.ARTE=t():e.ARTE=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Blocks:()=>a,Buffer:()=>o,Colours:()=>s,Comments:()=>d,Custom:()=>c,Editor:()=>fe,Icons:()=>n,Links:()=>l,Mentions:()=>i,Modal:()=>he,Settings:()=>u,Styles:()=>r});var n={};e.r(n),e.d(n,{b:()=>F,bq:()=>P,clear:()=>V,colourBackground:()=>Q,colourForeground:()=>W,comment:()=>te,commentEdit:()=>ne,commentResolve:()=>ae,commentUnresolve:()=>re,danger:()=>ee,download:()=>le,fileOpen:()=>se,h1:()=>H,h2:()=>D,h3:()=>M,i:()=>U,info:()=>X,link:()=>G,ol:()=>I,openLink:()=>J,options:()=>oe,outline:()=>de,p:()=>R,person:()=>z,plugin:()=>_,preview:()=>ie,redo:()=>Y,sidebarOpen:()=>ce,u:()=>K,ul:()=>B,undo:()=>j,warning:()=>Z});var o={};e.r(o),e.d(o,{REDO:()=>Ee,UNDO:()=>we});var a={};e.r(a),e.d(a,{BQ:()=>ze,H1:()=>Ke,H2:()=>Ve,H3:()=>je,OL:()=>Ge,P:()=>Ye,UL:()=>We});var r={};e.r(r),e.d(r,{B:()=>nt,CLEAR:()=>rt,I:()=>ot,U:()=>at,click:()=>et});var i={};e.r(i),e.d(i,{BUTTON:()=>Ct,setup:()=>vt});var l={};e.r(l),e.d(l,{BUTTON:()=>Ft});var s={};e.r(s),e.d(s,{BACKGROUND:()=>on,FOREGROUND:()=>nn});var c={};e.r(c),e.d(c,{BUTTON:()=>En});var d={};e.r(d),e.d(d,{BUTTON:()=>jn});var u={};e.r(u),e.d(u,{BUTTON:()=>Xn});let p={block:["DIV","H1","H2","H3","P","LI","BLOCKQUOTE"],list:["LI"],custom:[]};const h=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},f=function(e){return 1==e.nodeType&&"SPAN"===e.tagName},b=function(e){return 1==e.nodeType&&("OL"===e.tagName||"UL"===e.tagName)},m=function(e){if(1!=e.nodeType)return!1;return p.block.includes(e.tagName)},g=function(e){return null!=e.tagName&&(null!=e.getAttribute("contenteditable")&&"false"==e.getAttribute("contenteditable"))};const y=function(e){let t=[],n=v(e.startContainer);if(!1===n)return[];const o=v(e.endContainer);if(!1===o)return[];let a=!1;for(;!a;){const e=n.querySelector('[contenteditable="false"]');null!==e&&t.push(e),n===o&&(a=!0),n=n.nextElementSibling}return t},v=function(e){if(null==e)return!1;for(;0==m(e);){if(null==e.parentNode)return!1;e=e.parentNode}return e},N=function(e,t){let n=e;for(;e!=t;){if(n=e,null==e)return!1;if(null==e.parentNode)return!1;e=e.parentNode}return n},C=function(e,t){if(3!==e.nodeType)if(1===e.nodeType)if(!1!==m(e)||!1!==b(e)||!1!==f(e)||!1!==g(e))if("SPAN"!=e.tagName){if(t.length>0){const n=t.find((t=>t.tag.toUpperCase()===e.tagName));if(n){const t=n.clean(e);e.parentNode,e.parentNode.replaceChild(t,e)}}g(e)||e.childNodes.forEach((e=>{C(e,t)}))}else!function(e){const t=e.getAttribute("style");let n="";if(t){t.split(";").forEach((e=>{e&&0==e.includes("var(--")&&(n+=`${e};`)}))}if(n)e.setAttribute("style",n);else if(t){const t=document.createTextNode(e.textContent.trim());o=t,(a=e).parentNode.insertBefore(o,a),e.remove()}var o,a}(e);else e.remove();else e.remove();else e.textContent.includes("\n")&&(e.textContent=e.textContent.trim())};const w="§§",E="±±";let k=null,S=0,L=null,T=0;function x(e){const t=v(e.commonAncestorContainer);if(!1===t)return!1;if(e.blockParent=t,e.rootNode=e.commonAncestorContainer,3===e.commonAncestorContainer.nodeType){if(null==e.commonAncestorContainer.parentNode)return!1;e.rootNode=e.commonAncestorContainer.parentNode}return e.custom=function(e){let t=e.startContainer;for(;0==g(t)&&null!=t.parentNode&&t.parentNode&&"DIV"!=t.parentNode.tagName;)t=t.parentNode;return!!g(t)&&t}(e),e}const $=function(e,t){let n=document.createRange();const o=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),o.removeAllRanges(),o.addRange(n),n=x(n),n};function A(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType){if(A(o,t))return!0}else if(3===o.nodeType){const e=o.textContent.indexOf(t);if(-1!=e)return o.textContent=o.textContent.replace(t,""),t==w?(k=o,S=e):(L=o,T=e),!0}}return!1}const q=function(e){if(A(e,w)&&function(e){return A(e,E)}(e)){const e=document.createRange(),t=window.getSelection();return e.setStart(k,S),k==L&&S==T?e.collapse(!0):e.setEnd(L,T),t.removeAllRanges(),t.addRange(e),e}return!1},O=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)};const H='<i class="bi bi-type-h1"></i>',D='<i class="bi bi-type-h2"></i>',M='<i class="bi bi-type-h3"></i>',R='<i class="bi bi-paragraph"></i>',P='<i class="bi bi-chat-left-quote"></i>',I='<i class="bi bi-list-ol"></i>',B='<i class="bi bi-list-ul"></i>',F='<i class="bi bi-type-bold"></i>',U='<i class="bi bi-type-italic"></i>',K='<i class="bi bi-type-underline"></i>',V='<i class="bi bi-eraser"></i>',j='<i class="bi bi-reply"></i>',Y='<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',z='<i class="bi bi-person"></i>',G='<i class="bi bi-link"></i>',W='<i class="bi bi-type"></i>',Q='<i class="bi bi-paint-bucket"></i>',_='<i class="bi bi-plug"></i>',J='<i class="bi bi-link-45deg"></i>',X='<i class="info bi bi-info-circle-fill"></i>',Z='<i class="warning bi bi-cone-striped"></i>',ee='<i class="danger bi bi-exclamation-circle-fill"></i>',te='<i class="bi bi-chat-dots"></i>',ne='<i class="bi bi-chat-dots-fill"></i>',oe='<i class="bi bi-gear"></i>',ae='<i class="bi bi-check-circle-fill"></i>',re='<i class="bi bi-x-circle-fill"></i>',ie='<i class="bi bi-eye"></i>',le='<i class="bi bi-cloud-download"></i>',se='<i class="bi bi-folder2-open"></i>',ce='<i class="bi bi-chevron-double-left"></i>',de='<i class="bi bi-card-heading"></i>',ue=["cancel","delete","confirm"];class pe{static self;constructor(e){this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1;for(let t in e)this[t]=e[t];pe.self=this}setPosition(e,t){let n;if(this.container=this.panel.querySelector(".modal-panel-container"),3!==e.startContainer.nodeType)if(e.startContainer.childNodes.length>0){n=e.startContainer.childNodes[0].getBoundingClientRect()}else n={x:t.offsetLeft,y:t.offsetTop};else n=e.getBoundingClientRect();n.x+this.container.offsetWidth>window.innerWidth&&(n.x=window.innerWidth-this.container.offsetWidth-20),n.y+this.container.offsetHeight>window.innerHeight&&(n.y=window.innerHeight-this.container.offsetHeight-40),this.container.style.top=`${n.y}px`,this.container.style.left=`${n.x}px`}template(){let e=[];null!=this.backgroundColour&&e.push(`background-color:${this.backgroundColour}`),null!=this.borderRadius&&e.push(`border-radius:${this.borderRadius}`);let t=`<div class="modal-panel-container" ${0==e.length?"":`style="${e.join(";")}"`}>`,n="";switch(this.severity){case"info":n=X;break;case"warning":n=Z;break;case"danger":n=ee}if(this.title||n){t+=`\n                <header class="modal-panel-header">\n                    <h3 class="modal-panel-title ${this.title?"with-text":""}">${n}${this.title}</h3>\n                </header>`}if(this.html&&(t+=`<div class="modal-panel-body">${this.html}</div>`),this.buttons){let e="",n=0;ue.forEach((t=>{this.buttons[t]&&(n++,e+=`<button type="button" class="${t}">${this.buttons[t].label}</button>`)}));t+=`<div class="modal-panel-buttons ${1==n?"centred":""}">${e}</div>`}return t+="</div>",t}hide(){null!=this.panel&&(this.panel.classList.remove("show"),document.body.removeEventListener("keydown",this.handleKeydown),setTimeout((()=>{null!=this.panel&&(this.panel.remove(),this.panel=null)}),500))}active(){return!!document.querySelector(".modal-panel")}escapeOrHide(){this.escape instanceof Function?this.escape():this.hide()}handleKeydown(e){"Escape"==e.key&&(e.stopPropagation(),pe.self.escapeOrHide())}addEventListeners(){this.buttons&&ue.forEach((e=>{if(this.buttons[e]){const t=this.buttons[e],n=this.panel.querySelector(`button.${e}`);n&&n.addEventListener("click",(()=>{t.callback?t.callback():this.hide()}))}})),this.escape&&(document.body.addEventListener("keydown",this.handleKeydown),this.panel.addEventListener("click",(e=>{e.target==this.panel&&(e.stopPropagation(),this.escapeOrHide())})))}show(){this.panel=document.createElement("DIV"),this.panel.id=O(),this.panel.classList.add("modal-panel"),this.panel.classList.add(`modal-panel-${this.type}`),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout((()=>{this.panel.classList.add("show"),this.panel.scrollIntoView()}),10)}}const he=pe;const fe=class{constructor(e,t="",n,o){if(this.options=this.initOptions(o),this.toolbar=this.initToolbarArray(n),e.innerHTML=function(e,t){const n=function(e){let t="",n=[];return e.forEach(((o,a)=>{t+=function(e){const{type:t,tag:n,label:o,icon:a}=e;return`\n        <button id="${n}" type="button" class="btn btn-light ${t}" title="${o}">\n            ${a}\n        </button>`}(o);const r=a==e.length-1?"":e[a+1].group;if(o.group!=r){const e=`${o.group} buttons`;n.push(function(e,t){return`<div class="editor-toolbar-group block" role="group" title="${e}">${t}</div>`}(e,t)),t=""}})),n.join('<span class="editor-toolbar-group-separator">|</span>')}(e);let o="";return t.headingNumbers&&(o+="heading-numbers"),`\n        <div class="editor-container">\n            <div class="editor-toolbar">\n                ${n}\n            </div>\n            <div class="editor-main">\n                \x3c!-- Sidebar can go here --\x3e \n                <div class="editor-body ${o}" contenteditable="true"></div>\n            </div>\n        </div>`}(this.toolbar,this.options),this.id=O(),this.toolbarNode=e.querySelector(".editor-toolbar"),this.mainNode=e.querySelector(".editor-main"),this.editorNode=e.querySelector(".editor-body"),this.sidebarNode=null,this.debugTarget=!1,this.options.debug){const e=document.createElement("div");e.classList.add("editor-debug"),this.debugTarget=h(e,this.mainNode)}this.listenForMouseUpEvents(),this.listenForPasteEvents(),this.listenForKeydownEvents(),this.listenForKeyupEvents(),this.preview=this.getCleanData,this.update=this.updateEditor,this.modal=new he,setTimeout((()=>this.initEditor(t)),100)}initOptions(e){return e?(e.headingNumbers=null==e.headingNumbers||e.headingNumbers,e.bufferSize=null==e.bufferSize?10:Math.max(parseInt(e.bufferSize),10),e.debug=null!=e.debug&&e.debug,e.defaultContent=null==e.defaultContent?"":e.defaultContent,e.explorer=null==e.explorer||e.explorer):e={headingNumbers:true,bufferSize:10,debug:false,defaultContent:"",explorer:true},e}async initEditor(e=""){if(""==e&&""!=this.options.defaultContent){const t=await fetch(this.options.defaultContent);200==t.status&&(e=await t.text())}this.editorNode.innerHTML=e,this.range=!1,this.initialiseButtons(),this.options.explorer&&this.toolbar.find((e=>void 0!==e.sidebar))&&this.showSidebar(),window.onhashchange=e=>{const t=document.getElementById(window.location.hash.substring(1));null!=t&&t.scrollIntoView({block:"center",behaviour:"smooth"})}}initToolbarArray(e){let t=[];return e.forEach(((e,n)=>{e.forEach((e=>{var o,a;e.group=n,o=e.type,a=e.tag,null!=p[o]&&0==p[o].includes(a)&&"CLEAR"!=a&&p[o].push(a),t.push(e)}))})),t}setState(e){let t=!1;"detached"!==e.type&&(void 0===this.range||!1===this.range||this.range.custom)&&(t=!0,e.element.disabled=!0,e.element.classList.remove("active")),0==t&&"setState"in e&&e.setState(this,e)}setStateForButtonType(e=""){this.toolbar.forEach((t=>{""!=e&&t.type!=e||this.setState(t)}))}initialiseButtons(){this.shortcuts=[],this.updateBuffer=!1,this.toolbar.forEach((e=>{if(e.element=this.toolbarNode.querySelector(`#${e.tag}`),"UNDO"===e.tag&&this.options.bufferSize>0&&(this.updateBuffer=e.update,e.init(this,e)),"init"in e&&"UNDO"!==e.tag&&"REDO"!==e.tag&&e.init(this,e),this.setState(e),"shortcut"in e){e.shortcut[0],e.shortcut[1];this.shortcuts.push({shortcut:e.shortcut[0],trigger:e.shortcut[1],button:e})}this.buttonClicked=!1,e.element.addEventListener("click",(t=>{this.buttonClicked||(this.buttonClicked=!0,this.updateRange(),this.modal.active()||("detached"!==e.type&&!1===this.range||e.click(this,e),t.preventDefault(),this.buttonClicked=!1))}))}))}showSidebar(){if(null!=this.mainNode.querySelector(".editor-sidebar"))return void this.updateSidebar();let e=[];this.toolbar.forEach((t=>{t.sidebar&&e.push(t.sidebar(this))})),this.sidebarNode=document.createElement("DIV"),this.sidebarNode.classList.add("editor-sidebar"),this.sidebarNode.classList.add("dont-break-out"),this.sidebarNode.innerHTML=function(e){let t="",n="";return e.forEach(((e,o)=>{const a=0==o?"active":"",r=0==o?"show":"",i=e.content?e.content:`You have no ${e.label} in your document.`;t+=`<li><a href="#" class="tab-menu ${a}" data-tab-target="tab-${o}" title="${e.label}">${e.icon}</a></li>`,n+=`\n            <div class="tab-item ${r}" data-tab-id="tab-${o}">\n                ${i}\n            </div>`})),`\n            <div class="editor-sidebar-content">\n                <ul class="tab-menu">${t}</ul>\n                <div class="tab-content">${n}</div>\n            </div>`}(e);const t=this.sidebarNode.querySelector(".tab-menu").querySelectorAll("a");t.forEach((e=>e.addEventListener("click",(e=>this.handleTabMenuClicks(e,t))))),this.mainNode.appendChild(this.sidebarNode)}hideSidebar(){this.sidebarNode.remove()}updateSidebar(){if(null==this.mainNode.querySelector(".editor-sidebar"))return;let e=[];this.toolbar.forEach((t=>{t.sidebar&&e.push(t.sidebar(this))})),e.forEach(((e,t)=>{const n=this.sidebarNode.querySelector(`[data-tab-id="tab-${t}"]`);""==e.content&&(e.content=`You have no ${e.label} in your document.`),n.innerHTML=e.content}))}handleTabMenuClicks(e,t){e.preventDefault(),e.stopPropagation();const n=e.currentTarget,o=n.dataset.tabTarget;for(;null==o;)n=n.parentNode,o=n.dataset.tabTarget;t.forEach((e=>e.classList.remove("active"))),this.sidebarNode.querySelectorAll(".tab-item").forEach((e=>e.classList.remove("show"))),n.classList.add("active");this.sidebarNode.querySelector(`[data-tab-id="${o}"]`).classList.add("show")}listenForMouseUpEvents(){document.addEventListener("mouseup",(e=>{const t=document.activeElement;if(!this.modal.active())if(t==this.editorNode)this.handleMouseUp();else{if(this.nodeInToolbar(e.target))return;this.resetRange()}}))}resetRange(){this.range=!1,this.toolbar.forEach((e=>{this.setState(e)}))}nodeInEditor(e){for(;3==e.nodeType||"BODY"!=e.tagName||0!=e.contentEditable;){if(e==this.editorNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}nodeInToolbar(e){for(;3==e.nodeType||"BODY"!=e.tagName;){if(e==this.toolbarNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}setToolbarStates(){!1!==this.range?this.toolbar.forEach((e=>{this.setState(e)})):this.toolbar.forEach((e=>{e.element.classList.remove("active")}))}handleMouseUp(){this.updateRange(),!1!==this.range&&(""==this.editorNode.innerText&&this.insertParagraph(),this.highlightCustomNode(this.range.custom)),this.setToolbarStates()}insertParagraph(){let e=document.createElement("P");e.innerText="\n",e=this.editorNode.appendChild(e),$(e,0),this.updateRange(),this.setToolbarStates(),this.buffer()}listenForKeydownEvents(){this.lastKey="",this.editorNode.addEventListener("keydown",(e=>{let t=!1;if(this.modal.active()&&(e.preventDefault(),t=!0),t||"Enter"!=e.key||(this.handleEnter()&&e.preventDefault(),t=!0),!t&&("Backspace"==e.key||"Delete"==e.key||e.ctrlKey&&"d"==e.key)&&(this.handleDelete(e.key)&&e.preventDefault(),t=!0),t||this.shortcuts.forEach((n=>{this.lastKey===n.shortcut&&e.key===n.trigger&&(e.preventDefault(),e.stopPropagation(),n.button.click(this,n.button),t=!0)})),!t&&!1!==this.bufferUpdate&&(e.ctrlKey||e.metaKey)&&"z"==e.key){let n;e.preventDefault(),n=e.shiftKey?this.toolbar.find((e=>"REDO"==e.tag)):this.toolbar.find((e=>"UNDO"==e.tag)),n.element.click(),t=!0}this.lastKey=e.key}))}handleEnter(){if(this.updateRange(),!1===this.range)return;const e=this.range.endContainer.textContent.trim().length==this.range.endOffset;let t=!1;if(this.range.custom||e){const e="<br>"==this.range.blockParent.innerHTML,n="LI"==this.range.blockParent.tagName,o=e||!n?"P":this.range.blockParent.tagName;let a=document.createElement(o);a.innerText="\n",a=h(a,this.range.blockParent),$(a,0),t=!0,setTimeout((()=>{this.updateRange(),this.setStateForButtonType("block")}),10)}const n=this.range.blockParent;return n.childNodes.forEach((e=>{"false"==e.contentEditable&&setTimeout((()=>{n.appendChild(e)}),10)})),this.range.custom&&this.highlightCustomNode(!1),t}handleDelete(e){if("d"==e&&(e="Delete"),this.range){const t=new he({type:"overlay",severity:"info",title:"Information",html:"\n                    <p>You are attempting to delete one or more active elements, such as comments or links.</p>\n                    <p>To delete active elements you need to edit them individually and choose Delete.</p>\n                    ",escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if("Backspace"==e&&0==this.range.startOffset){const e=this.range.blockParent.previousElementSibling;e.childNodes.forEach((t=>{"false"==t.contentEditable&&setTimeout((()=>{e.appendChild(t)}),1)}))}else if("Delete"==e&&this.range.endContainer.textContent.trim().length==this.range.endOffset){const e=this.range.endContainer.nextElementSibling;if(e&&"false"==e.getAttribute("contenteditable"))return t.show(),!0}}else{if(y(this.range).length>0)return t.show(),!0}}return setTimeout((()=>this.updateRange()),10),!1}listenForKeyupEvents(){this.handleKeyup=function(e,t){let n;return function(...o){n&&clearTimeout(n),n=setTimeout((()=>{e(...o)}),t)}}(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",(e=>{0==["Shift","Meta","Ctrl"].includes(e.key)&&0==this.modal.active()&&this.handleKeyup(e.key,this)}))}handleKeyupDelayed(...e){let t=e[0];const n=e[1];n.updateRange(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"].includes(t)&&n.setToolbarStates(),n.buffer()}updateEventHandlers(){this.toolbar.forEach((e=>{"addEventHandlers"in e&&e.addEventHandlers(this)}))}listenForPasteEvents(){["cut","copy","paste"].forEach((e=>this.editorNode.addEventListener(e,(t=>{this.handleCutCopyPaste(e)?t.preventDefault():setTimeout((()=>this.buffer()),100)}))))}handleCutCopyPaste(e){if(this.updateRange(),0==this.range||"paste"!=e&&this.range.collapsed)return!1;if(y(this.range).length>0){navigator.clipboard.writeText("");return new he({type:"overlay",severity:"info",title:"Information",html:"<p>Cut, copy and paste (of or over) selections with active elements, such as comments or links, is not supported.</p>\n                        <p>Please modify your selection and try again.</p>",escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0}return!1}testModals(e){if("overlay"==e){new he({type:"overlay",title:"Example feedback modal",html:'\n                    <p>This is an example of an overlay modal.</p>\n                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>\n                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>',severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show()}else if("drawer"==e){new he({type:"drawer",title:"Example of an edit modal",html:'\n                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>\n                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>\n                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>',buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:()=>alert("delete")},confirm:{label:"Confirm",callback:()=>alert("confirm")}}}).show()}else"positioned"==e&&this.editorNode.addEventListener("click",(()=>{this.updateRange();const e=new he({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:'\n                        <div style="width:400px;padding:1rem;">\n                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>\n                            <p>The contents can be added as required.</p>\n                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>\n                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>\n                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>\n                        </div>'});e.show(),e.setPosition(this.range,this.editorNode)}))}download(){let e=this.getCleanData();const t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","arte-download.arte"),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}handleFileUpload(e){const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{const t=e.target.result;this.initEditor(t)},n.readAsText(t),e.remove()}upload(){let e=document.getElementById("arte-upload");null==e&&(e=document.createElement("input"),e.id="arte-upload",e.type="file",e.style.display="none",e.accept=".arte",e.addEventListener("change",(()=>this.handleFileUpload(e)),!1),document.body.appendChild(e)),e.click()}getCleanData(){let e=this.editorNode.cloneNode(!0);const t=this.toolbar.filter((e=>null!=e.clean));return C(e,t),e.innerHTML=e.innerHTML.replace(/[\n ]*?</gm,"<"),e.innerHTML}updateEditor(e){this.editorNode.innerHTML=e}updateRange(){var e,t;this.modal.active()||(this.range=function(e){let t=window.getSelection();if(1==t.rangeCount){let a=t.getRangeAt(0);if(a.commonAncestorContainer==e||(n=e)!==(o=a.commonAncestorContainer)&&n.contains(o))return a=x(a),a}var n,o;return!1}(this.editorNode),this.options.debug&&(e=this.debugTarget,t=this.range,0!=e&&(e.innerHTML=!1===t?"<p>No range selected</p>":`\n                <h5>Selection info:</h5>\n                <div class="col">\n                    <label>Block parent</label><span>${t.blockParent.tagName}</span>\n                    <label>commonAncestorC</label><span>${t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent}</span>\n                    <label>rootNode</label><span>${t.rootNode.tagName}</span>\n                    <label>collapsed</label><span>${t.collapsed}</span>\n                    <label>custom</label><span>${t.custom?t.custom.tagName:"false"}</span>\n                </div>\n                <div class="col">\n                    <label>startC</label><span>${t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent}</span>\n                    <label>startOffset</label><span>${t.startOffset}</span>\n                    <label>endC</label><span>${t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent}</span>\n                    <label>endOffset</label><span>${t.endOffset}</span>\n                </div>`)))}highlightCustomNode(e){this.editorNode.querySelectorAll("[contenteditable=false]").forEach((e=>{e.classList.remove("custom-selected")})),e&&e.classList.add("custom-selected")}buffer(){!1!==this.updateBuffer&&this.updateBuffer(this),this.updateSidebar(!1)}};const be=class{constructor(e,t,n,o,a,r){this.type=e,this.tag=t,this.label=n,this.input="button",this.icon=o,this.click=a,this.element=null,null!=r&&Object.keys(r).forEach((e=>{this[e]=r[e]}))}};class me{constructor(e){this.size=e,this.index=-1,this.buffer=[]}}let ge=[];const ye=function(e,t){const n=ge[e.id];"UNDO"==t.tag?t.element.disabled=n.buffer.length<=1||n.index<=0:t.element.disabled=n.index>=n.buffer.length-1},ve=function(e){void 0!==ge[e]&&(ge[e].buffering=!1)},Ne={init:function(e){e.buffer&&e.options.bufferSize>0&&(ge[e.id]=new me(e.options.bufferSize))},setState:ye,update:function(e){if(void 0===ge[e.id])return;const t=ge[e.id];if(!(t.buffer.length>0&&e.editorNode.innerHTML==t.buffer[t.buffer.length-1])){if(t.buffer.length>t.size&&t.buffer.shift(),t.index+1<t.buffer.length){const e=t.buffer.length-(t.index+1);for(let n=0;n<e;n++)t.buffer.pop()}t.buffer.push(e.editorNode.innerHTML),t.index=t.buffer.length-1,ye(e,we),ye(e,Ee)}},buffering:function(e){return void 0!==ge[e]&&ge[e].buffering},restart:function(e){void 0!==ge[e]&&(ge[e].buffering=!0)},pause:ve},Ce={setState:ye},we=new be("detached","UNDO","Undo",j,(function(e){e.buffer&&ve(e.id);const t=ge[e.id];t.index>0&&(t.index--,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),ye(e,we),ye(e,Ee),e.updateEventHandlers()}),Ne),Ee=new be("detached","REDO","Redo",Y,(function(e){e.buffer&&ve(e.id);const t=ge[e.id];t.index+1<t.buffer.length&&(t.index++,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),ye(e,we),ye(e,Ee),e.updateEventHandlers()}),Ce);let ke,Se,Le="";const Te=function(e,t){ke=e.startContainer,Se=e.endContainer,t&&(ke=v(ke),Se=v(Se)),Le="pre"},xe=function(e){e==ke?(Le="first",e==Se&&(Le="both")):e==Se?Le="last":"first"==Le?Le="during":"both"==Le||"last"==Le?Le="post-first":"post-first"==Le&&(Le="post")},$e=function(){return"pre"==Le},Ae=function(){return"first"==Le||"both"==Le},qe=function(){return"post-first"==Le||"post"==Le};let Oe,He,De=[],Me=!1;function Re(e,t){let n,o=He,a=function(e){let t="";return e.childNodes.forEach((e=>{if(3===e.nodeType){let n=e.textContent;n.includes("\n")&&(n=n.trim()),t+=n}else(f(e)||g(e)||"BR"===e.tagName)&&(t+=e.outerHTML)})),t}(e),r=[];r="during"==Le||"first"==Le||"last"==Le||"both"==Le?t.newFormats:t.oldFormats;let i=r.slice(-1)[0];e.nodeType;if(!(1!==e.nodeType||""==a&&e.innerHTML.includes("<"))){if(0==De.length)r.forEach((e=>{n=document.createElement(e),o=o.appendChild(n)}));else if(r.length>De.length){if(function(e,t){return e.every(((e,n)=>t[n]==e))}(De,r)){for(let e=0;e<De.length;e++)o=o.lastElementChild;for(let e=De.length;e<r.length;e++)n=document.createElement(r[e]),o=o.appendChild(n)}}else(function(e,t){return(0==e.length||0==t.length||e.length==t.length)&&e.every(((e,n)=>t[n]==e))})(r,De)&&(Me&&Me!=He&&(o=Me.parentNode),n=document.createElement(i),o=o.appendChild(n));if(o==He){let e=0;r.forEach(((t,n)=>{t==De[n]&&0==(n==r.length-1&&"LI"==t)&&(o=o.lastElementChild,e++)}));for(let t=e;t<r.length;t++)n=document.createElement(r[t]),o=o.appendChild(n)}Me=o,De=r.slice(),""!=a&&(o.innerHTML=a)}}function Pe(e,t,n){let o={oldFormats:[],newFormats:[]};e!=Oe&&(xe(e),o=function(e,t,n){const o=[...t.oldFormats,e.tagName];let a=[];if($e()||qe())return a=[...o],{newFormats:a,oldFormats:o};if("block"===n.type)return a=[n.newFormat],{newFormats:a,oldFormats:o};if(Ae())return"LI"==e.tagName?e.parentNode.firstElementChild==e?(a.pop(),a.push(n.newFormat),a.push("LI")):(a=t.oldFormats.slice(),a.push(n.newFormat),a.push("LI")):(a.push(n.newFormat),a.push("LI")),{newFormats:a,oldFormats:o};return a=De.slice(),{newFormats:a,oldFormats:o}}(e,t,n),Re(e,o)),e.childNodes.forEach((e=>{(m(e)||b(e))&&Pe(e,o,n)}))}const Ie=function(e,t){const n=e.range;Oe=e.editorNode,De=[],Me=!1,function(e){e.action="apply",("CLEAR"==e.tag||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,"block"==e.type&&"remove"==e.action&&(e.newFormat="P")}(t);const o=N(n.rootNode,Oe),a=N(n.startContainer,Oe),r=N(n.endContainer,Oe);if(!1!==o&&!1!==a&&!1!==r){if(n.rootNode=o,function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+w+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+E+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+w+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+E+e.endContainer.textContent.substring(e.endOffset))}(n),Te(n,!0),a==r)He=document.createElement("DIV"),Pe(a,{oldFormats:[],newFormats:[]},t),a==Oe?a.innerHTML=He.innerHTML:a.outerHTML=He.innerHTML;else{let e=!1,o=!1;He=document.createElement("DIV"),n.rootNode.childNodes.forEach((n=>{if(1===n.nodeType&&(n==a&&(e=!0),e&&0==o&&("block"===t.type&&(De=[],Me=!1,He=document.createElement("DIV")),Pe(n,{oldFormats:[],newFormats:[]},t),"block"===t.type?n.outerHTML=He.innerHTML:n.setAttribute("data-remove",!0)),n==r)){o=!0,"list"===t.type&&(n.outerHTML=He.innerHTML),Oe.querySelectorAll("[data-remove=true]").forEach((e=>e.remove()))}}))}q(e.editorNode),e.updateRange(),e.setStateForButtonType("block"),e.buffer(),e.updateEventHandlers()}},Be=function(e,t){if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{let n=v(e.range.startContainer,e.editorNode);if(!1===n)return;t.element.disabled="DIV"===n.tagName||g(n)||n.tagName==t.tag,"list"===t.type&&"LI"===n.tagName&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}};function Fe(e){return e.id&&e.removeAttribute("id"),e}const Ue={setState:Be},Ke=new be("block","H1","Heading 1",H,Ie,{clean:Fe,sidebar:function(e){const t=e.editorNode.querySelectorAll("H1,H2,H3");let n="";return t.forEach((e=>{const t=e.tagName;e.id=O(),n+=`<${t}><a href="#${e.id}">${e.innerHTML}</a></${t}>`})),{icon:de,label:"headings",content:`${n}`}},setState:Be}),Ve=new be("block","H2","Heading 2",D,Ie,{clean:Fe,setState:Be}),je=new be("block","H3","Heading 3",M,Ie,{clean:Fe,setState:Be}),Ye=new be("block","P","Paragraph",R,Ie,Ue),ze=new be("block","BLOCKQUOTE","Blockquote",P,Ie,Ue),Ge=new be("list","OL","Ordered list",I,Ie,Ue),We=new be("list","UL","Unordered list",B,Ie,Ue);function Qe(e,t){let n="",o="",a="";return"both"==Le?(o=e.textContent.substring(0,t.startOffset),n=w+e.textContent.substring(t.startOffset,t.endOffset)+E,a=e.textContent.substring(t.endOffset)):Ae()?(o=e.textContent.substring(0,t.startOffset),n=w+e.textContent.substring(t.startOffset)):"last"==Le?(n=e.textContent.substring(0,t.endOffset)+E,a=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:o,text:n,postText:a}}function _e(e,t,n){if(0==e.length)return t;let o=[],a=[];for(let t=0;t<e.length;t++){const n=e[t].split(":");o.push(n[0].trim()),a.push(n[1].trim())}for(let e=0;e<o.length;e++)for(let t=0;t<o.length;t++)o[e]==o[t]&&e>t&&(o[t]="");let r="";for(let e=0;e<o.length;e++)""!=o[e]&&(r+=`${o[e]}:${a[e]};`);let i=`<span style="${r}">${t}`;return n&&(i+="</span>"),i}const Je=function(e,t){"CLEAR"==t.tag&&t.element.classList.remove("active"),t.element.disabled=e.range.collapsed||e.range.rootNode==e.rootNode||b(e.range.rootNode),Ze(t);const n=function(e){let t="";for(;0==m(e);){if(1===e.nodeType){const n=e.getAttribute("style");null!=n&&""!=n&&(t+=";"+n)}e.parentNode,e=e.parentNode}return t}(e.range.startContainer);n.includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")},Xe=function(e,t,n,o){return 3===e.nodeType?function(e,t,n,o){xe(e);const{preText:a,text:r,postText:i}=Qe(e,o);let l="";if($e()||qe())l+=_e(t,r,!0);else{const e=`${n.newStyle}:${n.newValue}`,o=function(e,t){let n=-1;return e.forEach(((e,o)=>{e==t&&(n=o)})),n}(t,e);let s=!0;if(a&&(0==t.length?l+=a:(s=!0,"apply"==n.action&&(o>-1||""!=i)&&(s=!1),l+=_e(t,a,s))),r)if("apply"==n.action)if(o>-1&&0==s)l+=r;else{let n=[];n=s?[...t,e]:[e],l+=_e(n,r,!0)}else"remove"!=n.action&&"clear"!=n.action||(l+=r);i&&(0==t.length?l+=i:s?l+=_e(t,i,!0):(l+=i,t.forEach((()=>l+="</span>"))))}return l}(e,t,n,o):g(e)?e.outerHTML:function(e,t,n,o){if("SPAN"===e.tagName){const n=e.getAttribute("style");null!=n&&""!=n&&n.split(";").forEach((e=>{if(""!=e){const n=e.split(":");0==t.includes(n[0].trim())&&(t=[...t,e])}}))}let a="";return e.childNodes.forEach((e=>{a+=Xe(e,t,n,o)})),a}(e,t,n,o)},Ze=function(e){const t=e.style.split(":");e.newStyle=t[0],e.newValue=void 0!==t[1]?t[1]:"",e.action="apply",e.element.classList.contains("active")&&"CLEAR"!=e.style?e.action="remove":"CLEAR"==e.style&&(e.action="clear")},et=function(e,t){const n=e.range;if(0==m(n.rootNode)){const e=v(n.rootNode);if(!1===e)return;n.rootNode=e}Ze(t),Te(n,!1);const o=Xe(n.rootNode,[],t,n);!function(e,t,n){null==e||e.parentNode;const o=document.createElement(t);o.innerHTML=n;const a=e.parentNode.insertBefore(o,e);e.parentNode.removeChild(e)}(n.rootNode,n.rootNode.tagName,o);q(e.editorNode),e.updateRange(),t.setState(e,t),e.buffer(),e.updateEventHandlers()};let tt={setState:Je,style:"font-weight:bold"};const nt=new be("style","B","Bold",F,et,tt);tt={setState:Je,style:"font-style:italic"};const ot=new be("style","I","Italic",U,et,tt);tt={setState:Je,style:"text-decoration:underline"};const at=new be("style","U","Underline",K,et,tt);tt={setState:Je,style:"CLEAR"};const rt=new be("style","CLEAR","Clear",V,et,tt);let it,lt,st,ct,dt=[],ut=0,pt=null;function ht(e){let t="";return dt.forEach((n=>{const o=n.toLowerCase();(""==e||o.includes(e))&&(t+=`<li>${n}</li>`)})),t}function ft(e=!0){ut>=0&&lt.length>0&&(lt.forEach((e=>e.classList.remove("selected"))),lt[ut].classList.add("selected"),e&&lt[ut].scrollIntoView({block:"end",inline:"nearest"}))}function bt(e){const t=e.key,n=e.shiftKey;let o=!1;if(e.preventDefault(),e.stopPropagation(),0==lt.length?ut=-1:"ArrowDown"==t||"ArrowRight"==t||"Tab"==t&&0==n?(e.preventDefault(),ut<lt.length-1?ut++:ut=0,o=!0,ft()):("ArrowUp"==t||"ArrowLeft"==t||"Tab"==t&&n)&&(e.preventDefault(),0==ut?ut=lt.length-1:ut--,o=!0,ft()),0==o)if("Enter"!=t)st.innerHTML=ht(ct.value.toLowerCase()),lt=st.querySelectorAll("li"),ut=0,ft();else{gt(-1!=ut?lt[ut].textContent:ct.value)}}function mt(e){gt(e.target.textContent)}function gt(e){let t=it.range.startContainer.textContent,n=it.range.startOffset,o=t.substring(0,n),a=t.substring(n);"@"===a.charAt(0)&&(a=a.slice(1,a.length)),""!=e&&(32!==t.charCodeAt(n-1)&&(e=" "+e),n<t.length&&32!==t.charCodeAt(n)&&(""!=a&&(a+=" "),e+=" ")),it.range.startContainer.textContent=o+e+a,n+=e.length,it.range=$(it.range.startContainer,n),pt.hide(),it.buffer()}const yt=function(){gt("")};const vt=function(e){dt=e.sort()},Nt={setState:function(e,t){t.element.disabled=0==e.range.collapsed||!1!==e.range.custom},shortcut:["@","@"]},Ct=new be("custom","MENTION","Mention",z,(function(e,t){!1!==e.range&&(it=e,pt=new he({type:"positioned",escape:yt,html:`<div class="mentions">\n                <input type="text"/>\n                <ul>${ht("")}</ul>\n            </div>`}),pt.show(),pt.setPosition(it.range,it.editorNode),pt.container.addEventListener("keyup",bt),st=pt.container.querySelector("ul"),st.addEventListener("click",mt),lt=st.querySelectorAll("li"),ut=0,ft(!1),ct=pt.container.querySelector("input"),ct.value="",ct.focus())}),Nt),wt="A";let Et,kt,St,Lt,Tt=null,xt=null;function $t(){xt.hide(),Tt.hide()}function At(){Lt?(xt=new he({type:"overlay",severity:"warning",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:$t}}}),xt.show()):Tt.hide()}function qt(){xt.hide(),Tt.hide(),St.remove(),Et.range=!1,It(Et,kt),Et.buffer()}function Ot(){xt=new he({type:"overlay",severity:"danger",html:"Do you really want to delete this link?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:qt}}}),xt.show()}function Ht(e){Tt&&Tt.active()||(St=e,Dt("",!0))}function Dt(e,t){let n="Create link",o={cancel:{label:"Cancel",callback:At},confirm:{label:"Save",callback:Mt}};t?(n="Edit link",o.delete={label:"Delete",callback:Ot}):(St=document.createElement(wt),St.id=O(),St.setAttribute("contenteditable","false"),St.href="",St.dataset.label=e,St.dataset.display=0),Tt=new he({type:"drawer",title:n,html:Pt(t),buttons:o}),Tt.show(),Lt=!1;Tt.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>Lt=!0))));const a=Tt.panel.querySelector("form #href");a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function Mt(){St.href=Tt.panel.querySelector("form #href").value.trim(),St.dataset.label=Tt.panel.querySelector("form #label").value.trim(),St.dataset.display=parseInt(Tt.panel.querySelector("form #display").value),null==St.parentNode&&function(e){const t=e.range.startContainer.parentNode;let n,o=e.range.startContainer.textContent.substring(0,e.range.startOffset);e.range.collapsed?(n=e.range.startContainer.textContent.substring(e.range.startOffset)," "!=o.charAt(o.length+1)&&(o+=" ")," "!=n.charAt(0)&&(n=" "+n)):n=e.range.startContainer.textContent.substring(e.range.endOffset);o&&t.insertBefore(document.createTextNode(o),e.range.startContainer);St=t.insertBefore(St,e.range.startContainer),n&&t.insertBefore(document.createTextNode(n),e.range.startContainer);e.range.startContainer.remove()}(Et),Tt.hide(),Rt(St),Et.range=$(St,0),It(Et,kt),Et.buffer()}function Rt(e){0==e.id&&(e.id=O()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerText=function(e){switch(parseInt(e.dataset.display)){case 0:if(e.dataset.label)return e.dataset.label;break;case 1:return e.href;case 2:if(e.dataset.label&&e.dataset.label!=e.href)return`${e.dataset.label} (${e.href})`}return e.href}(e),e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Ht(e)}))}function Pt(e){let t="",n="http://",o=St.dataset.label,a=St.dataset.display?St.dataset.display:0;return e&&(n=St.href,t=`<a href="${n}" class="panel-link" target="_blank" title="Open link in new tab or window">${J}</a>`),`\n        <form class="arte-link">\n            <div class="form-input">\n                <label for="href">URL</label>\n                <input id="href" type="url" class="form-control ${t?"with-button":""}" placeholder="URL" required value="${n}">\n                ${t}\n            </div>\n            <div class="form-input">\n                <label for="label">Label (optional)</label>\n                <input id="label" type="text" class="form-control" placeholder="Label" value="${o}">\n            </div>\n            <div class="form-input">\n                <label for="label">Display option</label>\n                <select class="form-control" id="display">\n                    <option value="0" ${0==a?"selected":""}>Label only</option>\n                    <option value="1" ${1==a?"selected":""}>Link only</option>\n                    <option value="2" ${2==a?"selected":""}>Label and link</option>\n                </select>\n            </div>\n        </form>`}const It=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||b(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(wt)?t.element.classList.add("active"):t.element.classList.remove("active")}},Bt={init:function(e,t){Et=e,kt=t;Et.editorNode.querySelectorAll(wt).forEach((e=>Rt(e)))},setState:It,addEventHandlers:function(e){Et=e,kt=Ft;Et.editorNode.querySelectorAll(wt).forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Ht(e)}))))},clean:function(e){return e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.innerText=" ",e},sidebar:function(e){const t=e.editorNode.querySelectorAll(wt);let n="";return t.forEach((e=>{n+=`\n            <article>\n                <a href="#${e.id}">${e.dataset.label} (${e.href})</a>\n            </article>`})),{icon:G,label:"links",content:`${n}`}}},Ft=new be("custom",wt,"Link",G,(function(e,t){if(Tt&&Tt.active())return;if(Et=e,kt=t,!1===Et.range)return;let n="";0==Et.range.collapsed&&Et.range.startContainer==Et.range.endContainer&&(n=Et.range.endContainer.textContent.substring(Et.range.startOffset,Et.range.endOffset)),Dt(n,!1)}),Bt),Ut=100/30,Kt=100/30;let Vt,jt,Yt,zt,Gt,Wt=null;function Qt(e,t){if(Wt.panel.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),null==e){Wt.panel.querySelectorAll(".colours .hues span").forEach(((e,t)=>{const n=12*t;e.style.backgroundColor=`hsl(${n},100%,50%)`,n==Vt&&e.classList.add("active")}));Wt.panel.querySelectorAll(".colours .saturations span").forEach(((e,t)=>{const n=t*Ut;e.style.backgroundColor=`hsl(${Vt},${n}%,50%)`,n==jt&&e.classList.add("active")}));Wt.panel.querySelectorAll(".colours .lightnesses span").forEach(((e,t)=>{const n=t*Kt;e.style.backgroundColor=`hsl(${Vt},50%,${n}%)`,n==Yt&&e.classList.add("active")}))}else e.classList.add("active"),Vt=0,jt=100,Yt="black"==t?0:100;Wt.panel.querySelector("form .result span").style.backgroundColor=`hsl(${Vt},${jt}%,${Yt}%)`}function _t(){let e="",t="",n="";for(let o=0;o<30;o++)e+=`<span class="colour" data-colour="hue" data-index="${o}">&nbsp;</span>`,t+=`<span class="colour" data-colour="saturation" data-index="${o}">&nbsp;</span>`,n+=`<span class="colour" data-colour="lightness" data-index="${o}">&nbsp;</span>`;return`\n        <form id="colour-menu">\n\n            <div class="colours">\n                <div class="hues">\n                    <label>Hue</label>\n                    <div>${e}</div>\n                </div>\n                <div class="saturations">\n                    <label>Saturation</label>\n                    <div>${t}</div>\n                </div>\n                <div class="lightnesses">\n                    <label>Lightness</label>\n                    <div>${n}</div>\n                </div>\n            </div>\n\n            <div class="result">\n                <label>Result</label>\n                <span class="final">&nbsp;</span>\n                <label>Black and white</label>\n                <span class="black-and-white" data-colour="black">&nbsp;</span>\n                <span class="black-and-white" data-colour="white">&nbsp;</span>\n            </div>\n            \n        </form>`}function Jt(){Vt=Math.round(Vt),jt=Math.round(jt),Yt=Math.round(Yt);const e=`hsl(${Vt}, ${jt}%, ${Yt}%)`,t={setState:Zt,style:`${Gt.style}:${e}`,element:Gt.element};Wt.hide(),et(zt,t)}const Xt=function(e,t){if(!Wt||!Wt.active())if(zt=e,Gt=t,!1===zt.range||zt.range.collapsed){new he({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show()}else!function(){Vt=0,jt=29*Ut,Yt=50;let e="Select highlight colour";"FGC"==Gt.tag&&(e="Select text colour"),Wt=new he({type:"drawer",title:e,html:_t(),escape:!0,buttons:{cancel:{label:"Cancel"},confirm:{label:"Set",callback:Jt}}}),Wt.show(),Qt(),Wt.panel.querySelectorAll("span.colour").forEach((e=>e.addEventListener("click",(e=>{const t=e.target,n=t.dataset.colour,o=t.dataset.index;switch(n){case"hue":Vt=12*o;break;case"saturation":jt=o*Ut;break;case"lightness":Yt=o*Kt}Qt()})))),Wt.panel.querySelectorAll("span.black-and-white").forEach((e=>e.addEventListener("click",(e=>{const t=e.target.dataset.colour;Qt(e.target,t)}))))}()},Zt=function(e,t){t.element.disabled=!1===e.range||e.range.collapsed||e.range.rootNode==e.editorNode||b(e.range.rootNode);let n="",o=[];const a=e.range.startContainer.parentNode.getAttribute("style");null!=a&&(o=a.split(";"),o.forEach((e=>{if(""!==e){const o=e.split(":");o[0].trim()===t.style&&(n=o[1].trim(),t.element.querySelector("span.bar").setAttribute("style",`background-color:${n};`))}}))),""==n&&t.element.querySelector("span.bar").removeAttribute("style")},en=function(e,t){const n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")};let tn={init:en,setState:Zt,style:"color"};const nn=new be("inline","FGC","Text colour",W,Xt,tn);tn={init:en,setState:Zt,style:"background-color"};const on=new be("inline","BGC","Highlight colour",Q,Xt,tn),an="CUSTOM";let rn,ln,sn,cn,dn=null,un=null;function pn(e){dn&&dn.active()||(sn=e,gn(!0))}function hn(){un.hide(),dn.hide()}function fn(){un.hide(),dn.hide(),sn.remove(),rn.range=!1,Cn(rn,ln),rn.buffer()}function bn(){cn?(un=new he({type:"overlay",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:hn}}}),un.show()):dn.hide()}function mn(){un=new he({type:"overlay",severity:"danger",title:"Delete item",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete",callback:fn}}}),un.show()}function gn(e){let t="Create custom active element",n={cancel:{label:"Cancel",callback:bn},confirm:{label:"Save",callback:yn}};e?(t="Edit custom active element",n.delete={label:"Delete",callback:mn}):(sn=document.createElement(an),sn.id=O(),sn.setAttribute("contenteditable","false"),sn.innerHTML=Nn({property1:" ",property2:" ",property3:" "}));const o={property1:sn.querySelector(".property1").innerText,property2:sn.querySelector(".property2").innerText,property3:sn.querySelector(".property3").innerText};var a;dn=new he({type:"drawer",title:t,html:(a=o,`\n        <form>\n            <div class="form-input">\n                <label for="property1">Property 1</label>\n                <input id="property1" type="text" class="form-control" placeholder="Property 1" required value="${a.property1}">\n            </div>\n            <div class="form-input">\n                <label for="property2">Property 2</label>\n                <input id="property2" type="text" class="form-control" placeholder="Property 2" required value="${a.property2}">\n            </div>\n            <div class="form-input">\n                <label for="property3">Property 3</label>\n                <input id="property3" type="text" class="form-control" placeholder="Property 3" required value="${a.property3}">\n            </div>\n        </form>`),buttons:n}),dn.show(),cn=!1;dn.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>cn=!0))));const r=dn.panel.querySelector("form input#property1");r.focus(),r.setSelectionRange(r.value.length,r.value.length)}function yn(){sn.querySelector(".property1").innerText=dn.panel.querySelector("form #property1").value.trim(),sn.querySelector(".property2").innerText=dn.panel.querySelector("form #property2").value.trim(),sn.querySelector(".property3").innerText=dn.panel.querySelector("form #property3").value.trim(),null==sn.parentNode&&(sn=rn.range.startContainer.parentNode.appendChild(sn)),dn.hide(),vn(sn),rn.range=$(sn,0),Cn(rn,ln),rn.buffer()}function vn(e){e.id;0==e.id&&(e.id=O());const t={property1:e.querySelector(".property1").innerText,property2:e.querySelector(".property2").innerText,property3:e.querySelector(".property3").innerText};e.innerHTML=Nn(t),e.setAttribute("contenteditable",!1);const n=document.createElement("button");n.type="button",n.classList.add("edit"),n.innerText="Edit",n.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),pn(e)})),e.appendChild(n),e.addEventListener("click",(()=>{Cn(rn,ln)}))}function Nn(e){return`\n        <span class="title">I am an active object with 3 properties:</span>\n        <span class="label">Property 1:</span><span class="prop property1">${e.property1}</span>\n        <span class="label">Property 2:</span><span class="prop property2">${e.property2}</span>\n        <span class="label">Property 3:</span><span class="prop property3">${e.property3}</span>\n        <span class="advice">Click the top right-hand button to edit. Select anywhere in the element and then the Enter key to add a new line after this custom element.</span>\n    `}const Cn=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||b(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(an)?t.element.classList.add("active"):t.element.classList.remove("active")}},wn={setState:Cn,init:function(e,t){rn=e,ln=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>vn(e)))},addEventHandlers:function(e){rn=e,ln=En,rn.editorNode.querySelectorAll("CUSTOM button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();pn(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector(".title").remove(),e.querySelector(".advice").remove(),e.querySelectorAll(".label").forEach((e=>e.remove())),e.querySelector("button").remove(),e}},En=new be("custom",an,"Custom",_,(function(e,t){if(dn&&dn.active())return;rn=e,ln=t;const n=rn.range.blockParent.querySelector(an);null!=n?pn(n):gn(!1)}),wn),kn="COMMENT";let Sn,Ln,Tn,xn,$n=null,An=null;function qn(e){$n&&$n.active()||(Tn=e,Pn(!0))}function On(){An.hide(),$n.hide()}function Hn(){An.hide(),$n.hide(),Tn.remove(),Sn.range=!1,Kn(Sn,Ln),Sn.buffer()}function Dn(){xn?(An=new he({type:"overlay",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No"},confirm:{label:"Yes - lose changes",callback:On}}}),An.show()):$n.hide()}function Mn(){An=new he({type:"overlay",severity:"danger",title:"Delete changes",html:"Do you really want to delete this comment?",buttons:{cancel:{label:"No"},confirm:{label:"Yes - delete",callback:Hn}}}),An.show()}function Rn(e){"false"==Tn.dataset.resolved?(Tn.dataset.resolved="true",resolve.innerHTML=re+" Unresolve"):Tn.dataset.resolved="false",e.target.innerHTML=Fn()}function Pn(e){let t="Add comment",n={cancel:{label:"Cancel",callback:Dn},confirm:{label:"Save",callback:In}};e?(t="Edit comment",n.delete={label:"Delete",callback:Mn}):(Tn=document.createElement(kn),Tn.id=O(),Tn.setAttribute("contenteditable","false"),Tn.dataset.comment="",Tn.dataset.created="",Tn.dataset.updated="",Tn.dataset.resolved="false"),$n=new he({type:"drawer",title:t,html:Un(),buttons:n}),$n.show(),xn=!1;const o=$n.panel.querySelector("form textarea#comment");o.addEventListener("change",(()=>xn=!0));const a=$n.panel.querySelector("form button#resolve");null!=a&&a.addEventListener("click",Rn),o.focus(),o.setSelectionRange(o.value.length,o.value.length)}function In(){Tn.dataset.comment=$n.panel.querySelector("form #comment").value.trim();const e=(new Date).toLocaleString().slice(0,-3);""!=Tn.dataset.comment&&(null==Tn.parentNode&&(Tn.dataset.created=e,Tn=Sn.range.startContainer.parentNode.appendChild(Tn)),Tn.dataset.updated=e,$n.hide(),Bn(Tn),Sn.range=$(Tn,0)),Kn(Sn,Ln),Sn.buffer()}function Bn(e){e.id;0==e.id&&(e.id=O()),e.innerHTML="",e.setAttribute("contenteditable",!1);const t=document.createElement("button");t.type="button",t.classList.add("edit"),t.innerHTML=ne,t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),qn(e)})),e.appendChild(t),e.addEventListener("click",(()=>{Kn(Sn,Ln)}))}function Fn(){return"true"==Tn.dataset.resolved?re+" Unresolve":ae+" Resolve"}function Un(){let e="";""!=Tn.dataset.created&&(e=`<span><label>Created</label> ${Tn.dataset.created}</span>`),""!=Tn.dataset.updated&&(e+=`<span><label>Updated</label> ${Tn.dataset.updated}</span>`);let t="";if(""!=e){e=`<div class="timestamps">${e}</div>`;t=`<button type="button" id="resolve">${Fn()}</button>`}return`\n        <form class="comment">\n            <div class="form-input">\n                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>${Tn.dataset.comment}</textarea>\n            </div>\n            ${e}\n            ${t}\n        </form>`}const Kn=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||0==m(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(kn)?t.element.classList.add("active"):t.element.classList.remove("active")}},Vn={setState:Kn,init:function(e,t){Sn=e,Ln=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>Bn(e)))},addEventHandlers:function(e){Sn=e,Ln=jn,Sn.editorNode.querySelectorAll("COMMENT button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();qn(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector("button").remove(),e},sidebar:function(e){const t=e.editorNode.querySelectorAll(kn);let n="";return t.forEach((e=>{const t="true"==e.dataset.resolved?"comment-resolved":"comment-unresolved";n+=`\n            <article>\n                <a href="#${e.id}">${e.dataset.comment} <span class="comment-bubble ${t}">${ne}</span></a>\n                <p class="sub-title">Added: ${e.dataset.created}</p>\n            </article>`})),{icon:te,label:"comments",content:`${n}`}}},jn=new be("custom",kn,"Custom",te,(function(e,t){if($n&&$n.active())return;Sn=e,Ln=t;const n=Sn.range.blockParent.querySelector(kn);null!=n?qn(n):Pn(!1)}),Vn);let Yn=null;function zn(e){localStorage.setItem("headingNumbers",e.options.headingNumbers),e.options.headingNumbers?e.editorNode.classList.add("heading-numbers"):e.editorNode.classList.remove("heading-numbers")}function Gn(e){localStorage.setItem("theme",e),document.documentElement.className=e}function Wn(){Yn.hide()}function Qn(e){Yn=new he({type:"drawer",escape:!0,title:"Options",html:_n(e.options),buttons:{cancel:{label:"Close",callback:Wn}}}),Yn.show();Yn.panel.querySelectorAll("form input").forEach((t=>t.addEventListener("change",(t=>{"headingNumbers"==t.target.name?(e.options.headingNumbers="on"==t.target.id,zn(e)):"theme"==t.target.name?(e.options.theme=t.target.id,Gn(e.options.theme)):"explorer"==t.target.name&&(e.options.explorer="show-explorer"==t.target.id,function(e){localStorage.setItem("explorer",e.options.explorer),e.options.explorer?e.showSidebar():e.hideSidebar()}(e))}))))}function _n(e){return`\n        <form>\n            <div class="form-input options">\n                <label>Heading numbers</label>\n                <label>\n                    <input name="headingNumbers" id="on" type="radio" class="form-control first" ${e.headingNumbers?"checked":""}/> On\n                </label>\n                <label>\n                    <input name="headingNumbers" id="off" type="radio" class="form-control" ${e.headingNumbers?"":"checked"}/> Off\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Theme</label>\n                <label>\n                    <input name="theme" id="theme-light" type="radio" class="form-control first" ${"theme-light"==e.theme?"checked":""}/> Light\n                </label>\n                <label>\n                    <input name="theme" id="theme-dark" type="radio" class="form-control" ${"theme-dark"==e.theme?"checked":""}/> Dark\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Explorer</label>\n                <label>\n                    <input name="explorer" id="show-explorer" type="radio" class="form-control first" ${e.explorer?"checked":""}/> Show\n                </label>\n                <label>\n                    <input name="explorer" id="hide-explorer" type="radio" class="form-control" ${0==e.explorer?"checked":""}/> Hide\n                </label>\n            </div>\n        </form>`}const Jn={setState:function(e,t){t.element.disabled=!1},init:function(e,t){const n=localStorage.getItem("theme");n&&(e.options.theme=n),Gn(e.options.theme);const o=localStorage.getItem("headingNumbers");localStorage.getItem("headingNumbers")&&(e.options.headingNumbers=o),zn(e)}},Xn=new be("detached","SETTINGS","Preferences",oe,(function(e,t){Yn&&Yn.active()||Qn(e)}),Jn);return t})()}));