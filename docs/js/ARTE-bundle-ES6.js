!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ARTE",[],t):"object"==typeof exports?exports.ARTE=t():e.ARTE=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Actions:()=>u,Blocks:()=>i,Buffer:()=>a,Clipboard:()=>o,Colours:()=>d,Comments:()=>f,Editor:()=>Ae,Icons:()=>n,Images:()=>c,Links:()=>s,Mentions:()=>l,Modal:()=>ee,Settings:()=>h,Styles:()=>r});var n={};e.r(n),e.d(n,{action:()=>W,b:()=>C,bq:()=>v,clear:()=>S,colourBackground:()=>A,colourForeground:()=>$,comment:()=>I,commentEdit:()=>P,commentResolve:()=>B,commentUnresolve:()=>F,copy:()=>Q,cut:()=>_,danger:()=>M,download:()=>V,fileOpen:()=>Y,h1:()=>p,h2:()=>m,h3:()=>b,i:()=>w,image:()=>H,info:()=>D,link:()=>x,menu:()=>G,ol:()=>y,openLink:()=>q,options:()=>U,outline:()=>z,p:()=>g,paste:()=>J,person:()=>T,plugin:()=>O,preview:()=>K,redo:()=>L,sidebarOpen:()=>j,u:()=>E,ul:()=>N,undo:()=>k,warning:()=>R});var a={};e.r(a),e.d(a,{REDO:()=>Ue,UNDO:()=>Pe});var o={};e.r(o),e.d(o,{COPY:()=>We,CUT:()=>Ge,PASTE:()=>_e});var i={};e.r(i),e.d(i,{BQ:()=>vt,H1:()=>pt,H2:()=>mt,H3:()=>bt,OL:()=>yt,P:()=>gt,UL:()=>Nt});var r={};e.r(r),e.d(r,{B:()=>xt,CLEAR:()=>Ot,I:()=>$t,U:()=>At,click:()=>Lt});var l={};e.r(l),e.d(l,{BUTTON:()=>Gt,setup:()=>jt});var s={};e.r(s),e.d(s,{BUTTON:()=>hn});var c={};e.r(c),e.d(c,{BUTTON:()=>On});var d={};e.r(d),e.d(d,{BACKGROUND:()=>Bn,FOREGROUND:()=>Un});var u={};e.r(u),e.d(u,{BUTTON:()=>oa});var f={};e.r(f),e.d(f,{BUTTON:()=>ka});var h={};e.r(h),e.d(h,{BUTTON:()=>Da});const p='<i class="bi bi-type-h1"></i>',m='<i class="bi bi-type-h2"></i>',b='<i class="bi bi-type-h3"></i>',g='<i class="bi bi-paragraph"></i>',v='<i class="bi bi-chat-left-quote"></i>',y='<i class="bi bi-list-ol"></i>',N='<i class="bi bi-list-ul"></i>',C='<i class="bi bi-type-bold"></i>',w='<i class="bi bi-type-italic"></i>',E='<i class="bi bi-type-underline"></i>',S='<i class="bi bi-eraser"></i>',k='<i class="bi bi-reply"></i>',L='<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',T='<i class="bi bi-person"></i>',x='<i class="bi bi-link"></i>',$='<i class="bi bi-type"></i>',A='<i class="bi bi-paint-bucket"></i>',O='<i class="bi bi-plug"></i>',q='<i class="bi bi-link-45deg"></i>',D='<i class="info bi bi-info-circle-fill"></i>',H='<i class="bi bi-image"></i>',R='<i class="warning bi bi-cone-striped"></i>',M='<i class="danger bi bi-exclamation-circle-fill"></i>',I='<i class="bi bi-chat-dots"></i>',P='<i class="bi bi-chat-dots-fill"></i>',U='<i class="bi bi-gear"></i>',B='<i class="bi bi-check-circle-fill"></i>',F='<i class="bi bi-x-circle-fill"></i>',K='<i class="bi bi-eye"></i>',V='<i class="bi bi-cloud-download"></i>',Y='<i class="bi bi-folder2-open"></i>',j='<i class="bi bi-chevron-double-left"></i>',z='<i class="bi bi-card-heading"></i>',G='<i class="bi bi-list"></i>',W='<i class="bi bi-check2-square"></i>',_='<i class="bi bi-scissors"></i>',Q='<i class="bi bi-clipboard-plus"></i>',J='<i class="bi bi-box-arrow-down"></i>',X=["cancel","delete","confirm"];class Z{static self;constructor(e){this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1;for(let t in e)this[t]=e[t];Z.self=this}setPosition(e,t){let n;if(this.container=this.panel.querySelector(".modal-panel-container"),3!==e.startContainer.nodeType)if(e.startContainer.childNodes.length>0){n=e.startContainer.childNodes[0].getBoundingClientRect()}else n={x:t.offsetLeft,y:t.offsetTop};else n=e.getBoundingClientRect();n.x+this.container.offsetWidth>window.innerWidth&&(n.x=window.innerWidth-this.container.offsetWidth-20),n.y+this.container.offsetHeight>window.innerHeight&&(n.y=window.innerHeight-this.container.offsetHeight-40),this.container.style.top=`${n.y}px`,this.container.style.left=`${n.x}px`}template(){let e=[];null!=this.backgroundColour&&e.push(`background-color:${this.backgroundColour}`),null!=this.borderRadius&&e.push(`border-radius:${this.borderRadius}`);let t=`<div class="modal-panel-container" ${0==e.length?"":`style="${e.join(";")}"`}>`,n="";switch(this.severity){case"info":n=D;break;case"warning":n=R;break;case"danger":n=M}if(this.title||n){t+=`\n                <header class="modal-panel-header">\n                    <h3 class="modal-panel-title ${this.title?"with-text":""}">${n}${this.title}</h3>\n                </header>`}if(t+=`<div class="modal-panel-body">${this.html}</div>`,this.buttons){let e="",n=0;X.forEach((t=>{if(this.buttons[t]){n++;e+=`<button type="${"confirm"==t?"submit":"button"}" class="${t}">${this.buttons[t].label}</button>`}}));const a=`<div class="modal-panel-buttons ${1==n?"centred":""}">${e}</div>`;t.includes("</form")?t=t.replace("</form>",a+"</form>"):t+=`<form>${a}</form>`}return t+="</div>",t}hide(){null!=this.panel&&(this.panel.classList.remove("show"),document.body.removeEventListener("keydown",this.handleKeydown),setTimeout((()=>{null!=this.panel&&(this.panel.remove(),this.panel=null)}),500))}active(){return!!document.querySelector(".modal-panel")}escapeOrHide(){this.escape instanceof Function?this.escape():this.hide()}handleKeydown(e){"Escape"==e.key&&(e.stopPropagation(),Z.self.escapeOrHide())}addEventListeners(){this.buttons&&X.forEach((e=>{if(this.buttons[e]){const t=this.buttons[e],n=this.panel.querySelector(`button.${e}`);if(n){let a="click",o=n;"confirm"==e&&(a="submit",o=this.panel.querySelector("form")),o.addEventListener(a,(e=>{e.preventDefault(),e.stopPropagation(),t.callback?t.callback():this.hide()}))}}})),this.escape&&(document.body.addEventListener("keydown",this.handleKeydown),this.panel.addEventListener("click",(e=>{e.target==this.panel&&(e.stopPropagation(),this.escapeOrHide())})))}show(){this.panel=document.createElement("DIV"),this.panel.id=Te(),this.panel.classList.add("modal-panel"),this.panel.classList.add(`modal-panel-${this.type}`),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout((()=>{this.panel.classList.add("show"),this.panel.scrollIntoView()}),10)}}const ee=Z;let te={block:["DIV","LI"],list:["LI"],custom:[]};const ne=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},ae=function(e){return 1==e.nodeType&&("SPAN"===e.tagName||"I"===e.tagName)},oe=function(e){return 1==e.nodeType&&("OL"===e.tagName||"UL"===e.tagName)},ie=function(e){if(1!=e.nodeType)return!1;return te.block.includes(e.tagName)},re=function(e){return null!=e.tagName&&te.custom.includes(e.tagName)};const le=function(e,t){const n=e.querySelectorAll('[contenteditable="false"]');let a=!1;for(let e=0;e<n.length&&0==a;e++)t.containsNode(n[e],!0)&&(a=!0);return a},se=function(e){if(null==e)return!1;for(;0==ie(e);){if(null==e.parentNode)return!1;e=e.parentNode}return e},ce=function(e,t){let n=e;for(;e!=t;){if(n=e,null==e)return!1;if(null==e.parentNode)return!1;e=e.parentNode}return n},de=function(e,t){const n=e.range.startContainer.parentNode;let a,o=e.range.startContainer.textContent.substring(0,e.range.startOffset);return e.range.collapsed?(a=e.range.startContainer.textContent.substring(e.range.startOffset)," "!=o.charAt(o.length+1)&&(o+=" ")," "!=a.charAt(0)&&(a=" "+a)):a=e.range.startContainer.textContent.substring(e.range.endOffset),o&&n.insertBefore(document.createTextNode(o),e.range.startContainer),t=n.insertBefore(t,e.range.startContainer),a&&n.insertBefore(document.createTextNode(a),e.range.startContainer),e.range.startContainer.remove(),setTimeout((()=>{!function(e){re(e)?null!==e.nextSibling?we(e.nextSibling,0):null!==e.previousSibling&&we(e.previousSibling,e.previousSibling.textContent.length):we(e,e.textContent.length)}(t)}),10),t};const ue=function(e,t){if(3===e.nodeType)return void(e.textContent.includes("\n")&&(e.textContent=e.textContent.trim()));if(1!==e.nodeType)return void e.remove();const n=re(e);if(!1!==ie(e)||!1!==oe(e)||!1!==ae(e)||!1!==n)if("SPAN"!=e.tagName){if(t.length>0){const n=t.find((t=>t.tag.toUpperCase()===e.tagName));if(n){const t=n.clean(e);e.parentNode,e.parentNode.replaceChild(t,e)}}n||e.childNodes.forEach((e=>{ue(e,t)}))}else!function(e){const t=e.getAttribute("style");let n="";if(t){t.split(";").forEach((e=>{e&&0==e.includes("var(--")&&(n+=`${e};`)}))}if(n)e.setAttribute("style",n.trim());else if(t){const t=document.createTextNode(e.textContent.trim());a=t,(o=e).parentNode.insertBefore(a,o),e.remove()}var a,o}(e);else e.remove()};let fe="";function he(e){let t="\n";for(let n=0;n<e;n++)t+="    ";return t}function pe(e,t){if(3==e.nodeType){const n=e.textContent;""!=n&&(null==e.previousElementSibling&&(t++,fe+=he(t)),fe+=n)}else if(1==e.nodeType){let n=!1;if("DIV"!=e.tagName){const a=e.attributes;let o=e.tagName;for(let e=0;e<a.length;e++){const t=a[e];o+=` ${t.nodeName}="${t.nodeValue}"`}(function(e){return re(e)?null==e.nextElementSibling||3!==e.nextElementSibling.nodeType:ie(e)||oe(e)})(e)&&(n=!0,t++,fe+=he(t)),fe+=`<${o}>`}e.childNodes.forEach((e=>{pe(e,t)})),"DIV"!=e.tagName&&(n&&0==re(e)&&(fe+=he(t)),fe+=`</${e.tagName}>`)}}const me="§§",be="±±";let ge=null,ve=0,ye=null,Ne=0;function Ce(e){const t=se(e.commonAncestorContainer);if(!1===t)return!1;if(e.blockParent=t,e.rootNode=e.commonAncestorContainer,3===e.commonAncestorContainer.nodeType){if(null==e.commonAncestorContainer.parentNode)return!1;e.rootNode=e.commonAncestorContainer.parentNode}return e.custom=function(e){let t=e.startContainer;for(;0==re(t)&&null!=t.parentNode&&t.parentNode&&"DIV"!=t.parentNode.tagName;)t=t.parentNode;return!!re(t)&&t}(e),e}const we=function(e,t){let n=document.createRange();const a=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),a.removeAllRanges(),a.addRange(n),n=Ce(n),n};function Ee(e,t){for(let n=0;n<e.childNodes.length;n++){const a=e.childNodes[n];if(1===a.nodeType){if(Ee(a,t))return!0}else if(3===a.nodeType){const e=a.textContent.indexOf(t);if(-1!=e)return a.textContent=a.textContent.replace(t,""),t==me?(ge=a,ve=e):(ye=a,Ne=e),!0}}return!1}const Se=function(e){if(Ee(e,me)&&function(e){return Ee(e,be)}(e)){const e=document.createRange(),t=window.getSelection();return e.setStart(ge,ve),ge==ye&&ve==Ne?e.collapse(!0):e.setEnd(ye,Ne),t.removeAllRanges(),t.addRange(e),e}return!1},ke=function(e){const t=new ee({type:"overlay",severity:"warning",title:"Cancel changes?",html:"Do you really want to lose changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:e}}});return t.show(),t},Le=function(e,t){const n=new ee({type:"overlay",severity:"warning",title:`Delete ${e}?`,html:`Do you really want to delete this ${e}?`,buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete",callback:t}}});return n.show(),n},Te=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)};const xe=function(e,t){const n=function(e){let t="",n=[];e.forEach(((a,o)=>{t+=function(e){const{type:t,tag:n,label:a,icon:o}=e;return`\n        <button id="${n}" type="button" class="btn btn-light ${t}" title="${a}">\n            ${o} <span class="mobile">${a}</span>\n        </button>`}(a);const i=o==e.length-1?"":e[o+1].group;if(a.group!=i){const e=`${a.group} buttons`;n.push(function(e,t){return`<div class="editor-toolbar-group block" role="group" title="${e}">\n                ${t}\n            </div>`}(e,t)),t=""}}));const a=n.join('<span class="editor-toolbar-group-separator"></span>');return`<span class="menu-icon mobile" title="Click to toggle toolbar menu">${G} Menu</span><section>${a}</section></details>`}(e);let a="";return t.headingNumbers&&(a+="heading-numbers"),`\n        <div class="editor-container">\n            <div class="editor-toolbar">\n                ${n}\n            </div>\n            <div class="editor-main">\n                \x3c!-- Sidebar can go here --\x3e \n                <div class="editor-body ${a}" contenteditable="true"></div>\n            </div>\n        </div>`},$e=function(e="arte-download"){return`\n        <form class="save">\n            <p class="advice">Enter the filename without extension. The file will be saved in your <strong>Downloads</strong> folder with the extension <strong>arte</strong>.</>\n            <div class="form-input">\n                <input type="text" id="filename" title="filename" class="form-control" placeholder="Filename" required value="${e}"/>\n            </div>\n            <p class="feedback"></p>\n        </form>`};const Ae=class{constructor(e,t="",n,a){if(this.options=this.initOptions(a),this.toolbar=this.initToolbarArray(n),e.innerHTML=xe(this.toolbar,this.options),this.id=Te(),this.toolbarNode=e.querySelector(".editor-toolbar"),this.mainNode=e.querySelector(".editor-main"),this.editorNode=e.querySelector(".editor-body"),this.menuIcon=this.toolbarNode.querySelector(".menu-icon"),this.menuItems=this.toolbarNode.querySelector("section"),this.sidebarNode=null,this.debugTarget=!1,this.options.debug){const e=document.createElement("div");e.classList.add("editor-debug"),this.debugTarget=ne(e,this.mainNode)}this.listenForMouseUpEvents(),this.listenForKeydownEvents(),this.listenForKeyupEvents(),this.preview=()=>this.getCleanData(!0),this.update=this.updateEditor,this.filename="arte-download",this.modal=new ee,setTimeout((()=>this.initEditor(t)),100)}initOptions(e){return e?(e.headingNumbers=null==e.headingNumbers||e.headingNumbers,e.bufferSize=null==e.bufferSize?10:Math.max(parseInt(e.bufferSize),10),e.debug=null!=e.debug&&e.debug,e.defaultContent=null==e.defaultContent?"":e.defaultContent,e.explorer=null==e.explorer||e.explorer):e={headingNumbers:true,bufferSize:10,debug:false,defaultContent:"",explorer:true},e}async initEditor(e=""){if(""==e&&""!=this.options.defaultContent){const t=await fetch(this.options.defaultContent);200==t.status&&(e=await t.text())}this.editorNode.innerHTML=e,this.range=!1,this.initialiseButtons(),this.options.explorer&&this.toolbar.find((e=>void 0!==e.sidebar))&&this.showSidebar(),window.onhashchange=e=>{const t=document.getElementById(window.location.hash.substring(1));null!=t&&t.scrollIntoView({block:"center",behaviour:"smooth"})},setTimeout((()=>this.buffer()),100)}initToolbarArray(e){let t=[];return e.forEach(((e,n)=>{e.forEach((e=>{var a,o;e.group=n,a=e.type,o=e.tag,null!=te[a]&&0==te[a].includes(o)&&"CLEAR"!=o&&te[a].push(o),t.push(e)}))})),t}setState(e){let t=!1;"detached"!==e.type&&(void 0===this.range||!1===this.range||this.range.custom)&&(t=!0,e.element.disabled=!0,e.element.classList.remove("active")),0==t&&"setState"in e&&e.setState(this,e)}setStateForButtonType(e=""){this.toolbar.forEach((t=>{""!=e&&t.type!=e||this.setState(t)}))}initialiseButtons(){this.shortcuts=[],this.updateBuffer=!1,this.toolbar.forEach((e=>{if(e.element=this.toolbarNode.querySelector(`#${e.tag}`),"UNDO"===e.tag&&this.options.bufferSize>0&&(this.updateBuffer=e.update,e.init(this,e)),"init"in e&&"UNDO"!==e.tag&&"REDO"!==e.tag&&e.init(this,e),this.setState(e),"shortcut"in e){e.shortcut[0],e.shortcut[1];this.shortcuts.push({shortcut:e.shortcut[0],trigger:e.shortcut[1],button:e})}this.buttonClicked=!1,e.element.addEventListener("click",(t=>{this.buttonClicked||(this.buttonClicked=!0,this.updateRange(),this.modal.active()||("detached"!==e.type&&!1===this.range||e.click(this,e),t.preventDefault(),this.buttonClicked=!1))}))}))}handleMenuClick(){this.menuItems.classList.toggle("show"),this.menuItems.classList.contains("show")&&!1!==this.range&&(this.range=function(e){const t=window.getSelection();return t.removeAllRanges(),t.addRange(e),Ce(e)}(this.range),this.setToolbarStates())}showSidebar(){if(null!=this.mainNode.querySelector(".editor-sidebar"))return void this.updateSidebar();let e=[];this.toolbar.forEach((t=>{t.sidebar&&e.push(t.sidebar(this))})),this.sidebarNode=document.createElement("DIV"),this.sidebarNode.classList.add("editor-sidebar"),this.sidebarNode.classList.add("dont-break-out"),this.sidebarNode.innerHTML=function(e){let t="",n="";return e.forEach(((e,a)=>{const o=0==a?"active":"",i=0==a?"show":"",r=e.label.replaceAll(" ","-"),l=e.content?e.content:`You have no ${e.label} in your document.`;t+=`<li><a href="#" class="tab-menu ${o}" data-tab-target="tab-${a}" title="${e.label}">${e.icon}</a></li>`,n+=`\n            <div class="tab-item ${r} ${i}" data-tab-id="tab-${a}">\n                <header><h2>${e.label}</h2></header>\n                ${l}\n            </div>`})),`\n            \n            <div class="editor-sidebar-content">\n                <header><h1>Explorer</h1></header>\n                <ul class="tab-menu">${t}</ul>\n                <div class="tab-content">${n}</div>\n                <button class="close">Close explorer</button>\n            </div>`}(e);const t=this.sidebarNode.querySelector(".tab-menu").querySelectorAll("a");t.forEach((e=>e.addEventListener("click",(e=>this.handleTabMenuClicks(e,t))))),this.sidebarNode.querySelector("button.close").addEventListener("click",(()=>this.hideSidebar())),this.mainNode.appendChild(this.sidebarNode)}hideSidebar(){this.sidebarNode.remove(),this.options.explorer=!1}updateSidebar(){if(null==this.mainNode.querySelector(".editor-sidebar"))return;let e=[];this.toolbar.forEach((t=>{t.sidebar&&e.push(t.sidebar(this))})),e.forEach(((e,t)=>{const n=this.sidebarNode.querySelector(`[data-tab-id="tab-${t}"]`);""==e.content&&(e.content=`You have no ${e.label} in your document.`),n.innerHTML=e.content}))}handleTabMenuClicks(e,t){e.preventDefault(),e.stopPropagation();const n=e.currentTarget,a=n.dataset.tabTarget;for(;null==a;)n=n.parentNode,a=n.dataset.tabTarget;t.forEach((e=>e.classList.remove("active"))),this.sidebarNode.querySelectorAll(".tab-item").forEach((e=>e.classList.remove("show"))),n.classList.add("active");this.sidebarNode.querySelector(`[data-tab-id="${a}"]`).classList.add("show")}listenForMouseUpEvents(){document.addEventListener("mouseup",(e=>{const t=document.activeElement,n=e.target;if(!this.modal.active())if(t==this.editorNode)this.handleMouseUp();else if(n==this.menuIcon)this.handleMenuClick();else{if(this.nodeInToolbar(n))return;this.resetRange()}}))}resetRange(){this.range=!1,this.toolbar.forEach((e=>{this.setState(e)}))}nodeInEditor(e){for(;3==e.nodeType||"BODY"!=e.tagName||0!=e.contentEditable;){if(e==this.editorNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}nodeInToolbar(e){for(;3==e.nodeType||"BODY"!=e.tagName;){if(e==this.toolbarNode)return!0;if(null==e.parentNode)return!1;e=e.parentNode}return!1}setToolbarStates(){!1!==this.range?this.toolbar.forEach((e=>{this.setState(e)})):this.toolbar.forEach((e=>{e.element.classList.remove("active")}))}handleMouseUp(){this.updateRange(),!1!==this.range&&(""==this.editorNode.innerText&&this.insertParagraph(),this.highlightCustomNode(this.range.custom)),this.setToolbarStates()}insertParagraph(){let e=document.createElement("P");e.innerText="\n",e=this.editorNode.appendChild(e),we(e,0),this.updateRange(),this.setToolbarStates(),this.buffer()}listenForKeydownEvents(){this.lastKey="",this.editorNode.addEventListener("keydown",(e=>{let t=!1;if(this.modal.active()&&(e.preventDefault(),t=!0),t||"Enter"!=e.key||(this.handleEnter()&&e.preventDefault(),t=!0),!t&&("Backspace"==e.key||"Delete"==e.key||e.ctrlKey&&"d"==e.key)&&(this.handleDelete(e.key)&&e.preventDefault(),t=!0),t||this.shortcuts.forEach((n=>{this.lastKey===n.shortcut&&e.key===n.trigger&&(e.preventDefault(),e.stopPropagation(),n.button.click(this,n.button),t=!0)})),!t&&!1!==this.bufferUpdate&&(e.ctrlKey||e.metaKey)&&"z"==e.key){let n;e.preventDefault(),n=e.shiftKey?this.toolbar.find((e=>"REDO"==e.tag)):this.toolbar.find((e=>"UNDO"==e.tag)),n.element.click(),t=!0}this.lastKey=e.key}))}handleEnter(){if(this.updateRange(),!1===this.range)return;const e=this.range.endContainer.textContent.trim().length==this.range.endOffset;let t=!1;if(this.range.custom||e){const e="<br>"==this.range.blockParent.innerHTML,n="LI"==this.range.blockParent.tagName,a=e||!n?"P":this.range.blockParent.tagName;let o=document.createElement(a);o.innerText="\n",o=ne(o,this.range.blockParent),we(o,0),t=!0,setTimeout((()=>{this.updateRange(),this.setStateForButtonType("block")}),10)}const n=this.range.blockParent;return n.childNodes.forEach((e=>{"false"==e.contentEditable&&setTimeout((()=>{n.appendChild(e)}),10)})),this.range.custom&&this.highlightCustomNode(!1),t}handleDelete(e){if("d"==e&&(e="Delete"),this.range){const t=new ee({type:"overlay",severity:"info",title:"Information",html:"\n                    <p>You are attempting to delete one or more active elements, such as comments or links.</p>\n                    <p>To delete active elements you need to edit them individually and choose Delete.</p>\n                    ",escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if("Backspace"==e&&0==this.range.startOffset){const e=this.range.blockParent.previousElementSibling;e.childNodes.forEach((t=>{"false"==t.contentEditable&&setTimeout((()=>{e.appendChild(t)}),1)}))}else if("Delete"==e&&this.range.endContainer.textContent.trim().length==this.range.endOffset){const e=this.range.endContainer.nextElementSibling;if(e&&"false"==e.getAttribute("contenteditable"))return t.show(),!0}}else{const e=document.getSelection();if(le(this.editorNode,e))return t.show(),!0}}return setTimeout((()=>this.updateRange()),10),!1}listenForKeyupEvents(){this.handleKeyup=function(e,t){let n;return function(...a){n&&clearTimeout(n),n=setTimeout((()=>{e(...a)}),t)}}(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",(e=>{0==["Shift","Meta","Ctrl"].includes(e.key)&&0==this.modal.active()&&this.handleKeyup(e.key,this)}))}handleKeyupDelayed(...e){let t=e[0];const n=e[1];n.updateRange(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"].includes(t)&&n.setToolbarStates(),n.buffer()}updateEventHandlers(){this.toolbar.forEach((e=>{"addEventHandlers"in e&&e.addEventHandlers(this)}))}testModals(e){if("overlay"==e){new ee({type:"overlay",title:"Example feedback modal",html:'\n                    <p>This is an example of an overlay modal.</p>\n                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>\n                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>',severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show()}else if("drawer"==e){new ee({type:"drawer",title:"Example of an edit modal",html:'\n                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>\n                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>\n                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>',buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:()=>alert("delete")},confirm:{label:"Confirm",callback:()=>alert("confirm")}}}).show()}else"positioned"==e&&this.editorNode.addEventListener("click",(()=>{this.updateRange();const e=new ee({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:'\n                        <div style="width:400px;padding:1rem;">\n                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>\n                            <p>The contents can be added as required.</p>\n                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>\n                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>\n                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>\n                        </div>'});e.show(),e.setPosition(this.range,this.editorNode)}))}download(){this.modal.active()||(this.modal=new ee({type:"drawer",title:"Save file",html:$e(this.filename),escape:!0,buttons:{cancel:{label:"Cancel",callback:()=>this.modal.hide()},confirm:{label:"Save",callback:()=>this.save()}}}),this.modal.show())}save(){let e=document.querySelector("form.save #filename").value.trim().toLowerCase();if(""==e)return void(document.querySelector("form.save .feedback").innerHTML="You must provide a filename. Click <strong>Cancel</strong> or press the <strong>Escape</strong> key to close this dialogue without saving.");e+=".arte";let t=this.getCleanData();const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),n.remove()}handleFileUpload(e){const t=e.files[0];if(!t)return;if("arte"!=t.name.slice(-4).toLowerCase())return;this.filename=t.name.slice(0,-5);const n=new FileReader;n.onload=e=>{const t=e.target.result;this.initEditor(t)},n.readAsText(t),e.remove()}upload(){let e=document.getElementById("arte-upload");null==e&&(e=document.createElement("input"),e.id="arte-upload",e.type="file",e.style.display="none",e.accept=".arte",e.addEventListener("change",(()=>this.handleFileUpload(e)),!1),document.body.appendChild(e)),e.click()}clear(){this.modal.active()||(this.modal=new ee({type:"overlay",severity:"warning",title:"Start new document?",html:"<p>Are you sure you want to clear the editor and start a new document? Any changes will be lost.</p>",escape:!0,buttons:{cancel:{label:"Cancel",callback:()=>this.modal.hide()},confirm:{label:"Yes",callback:()=>{this.editorNode.innerHTML="",this.filename="arte-download",this.modal.hide(),setTimeout((()=>this.buffer()),100)}}}}),this.modal.show())}getCleanData(e=!1){let t=this.editorNode.cloneNode(!0);const n=this.toolbar.filter((e=>null!=e.clean));return ue(t,n),e?function(e){return fe="",pe(e,-1),fe}(t):t.innerHTML}updateEditor(e){this.editorNode.innerHTML=e}updateRange(){var e,t;this.modal.active()||(this.range=function(e){let t=window.getSelection();if(1==t.rangeCount){let o=t.getRangeAt(0);if(o.commonAncestorContainer==e||(n=e)!==(a=o.commonAncestorContainer)&&n.contains(a))return o=Ce(o),o}var n,a;return!1}(this.editorNode),this.options.debug&&(e=this.debugTarget,t=this.range,0!=e&&(e.innerHTML=!1===t?"<p>No range selected</p>":`\n                <h5>Selection info:</h5>\n                <div class="col">\n                    <label>Block parent</label><span>${t.blockParent.tagName}</span>\n                    <label>commonAncestorC</label><span>${t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent}</span>\n                    <label>rootNode</label><span>${t.rootNode.tagName}</span>\n                    <label>collapsed</label><span>${t.collapsed}</span>\n                    <label>custom</label><span>${t.custom?t.custom.tagName:"false"}</span>\n                </div>\n                <div class="col">\n                    <label>startC</label><span>${t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent}</span>\n                    <label>startOffset</label><span>${t.startOffset}</span>\n                    <label>endC</label><span>${t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent}</span>\n                    <label>endOffset</label><span>${t.endOffset}</span>\n                </div>`)))}highlightCustomNode(e){this.editorNode.querySelectorAll("[contenteditable=false]").forEach((e=>{e.classList.remove("custom-selected")})),e&&e.classList.add("custom-selected")}buffer(){!1!==this.updateBuffer&&this.updateBuffer(this),this.updateSidebar(!1)}};const Oe=class{constructor(e,t,n,a,o,i){this.type=e,this.tag=t,this.label=n,this.input="button",this.icon=a,this.click=o,this.element=null,null!=i&&Object.keys(i).forEach((e=>{this[e]=i[e]}))}};class qe{constructor(e){this.size=e,this.index=-1,this.buffer=[]}}let De=[];const He=function(e,t){const n=De[e.id];"UNDO"==t.tag?t.element.disabled=n.buffer.length<=1||n.index<=0:t.element.disabled=n.index>=n.buffer.length-1},Re=function(e){void 0!==De[e]&&(De[e].buffering=!1)},Me={init:function(e){e.buffer&&e.options.bufferSize>0&&(De[e.id]=new qe(e.options.bufferSize))},setState:He,update:function(e){if(void 0===De[e.id])return;const t=De[e.id];if(!(t.buffer.length>0&&e.editorNode.innerHTML==t.buffer[t.buffer.length-1])){if(t.buffer.length>t.size&&t.buffer.shift(),t.index+1<t.buffer.length){const e=t.buffer.length-(t.index+1);for(let n=0;n<e;n++)t.buffer.pop()}t.buffer.push(e.editorNode.innerHTML),t.index=t.buffer.length-1,He(e,Pe),He(e,Ue)}},buffering:function(e){return void 0!==De[e]&&De[e].buffering},restart:function(e){void 0!==De[e]&&(De[e].buffering=!0)},pause:Re},Ie={setState:He},Pe=new Oe("detached","UNDO","Undo",k,(function(e){e.buffer&&Re(e.id);const t=De[e.id];t.index>0&&(t.index--,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),He(e,Pe),He(e,Ue),e.updateEventHandlers()}),Me),Ue=new Oe("detached","REDO","Redo",L,(function(e){e.buffer&&Re(e.id);const t=De[e.id];t.index+1<t.buffer.length&&(t.index++,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),He(e,Pe),He(e,Ue),e.updateEventHandlers()}),Ie);let Be,Fe;function Ke(e){if(le(Fe.editorNode,e)){return new ee({type:"overlay",severity:"info",title:"Information",html:"<p>Cut, copy and paste (of or over) selections with active elements, such as comments or links, is not supported.</p>\n                   <p>Please modify your selection and try again.</p>",escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0}return!1}function Ve(e){Ke(document.getSelection())&&e.preventDefault(),"cut"==e.type&&setTimeout((()=>Fe.buffer()),100)}function Ye(e){if(0==Ke(document.getSelection())){const t=(e.clipboardData||window.clipboardData).getData("text/html");if(Be&&t.includes("urn:schemas-microsoft-com:office")){const t=(e.clipboardData||window.clipboardData).getData("text/plain");e.preventDefault();let n=document.createTextNode(t);n=de(Fe,n)}setTimeout((()=>Fe.buffer()),100)}}const je=function(e,t){if(!1!==Be)switch(t.tag){case"CUT":!function(){const e=document.getSelection();0==Ke(e)&&(navigator.clipboard.writeText(e.toString()),e.deleteFromDocument(),setTimeout((()=>Fe.buffer()),100))}();break;case"COPY":!function(){const e=document.getSelection();0==Ke(e)&&navigator.clipboard.writeText(e.toString())}();break;case"PASTE":!async function(){if(0==Ke(document.getSelection())){const e=await navigator.clipboard.readText();let t=document.createTextNode(e);t=de(Fe,t),setTimeout((()=>Fe.buffer()),100)}}()}},ze=async function(e,t){switch(t.tag){case"PASTE":if(document.activeElement==e.editorNode){const e=await navigator.clipboard.readText();t.element.disabled=""==e}else t.element.disabled=!0;break;case"CUT":case"COPY":0==e.range||e.range.collapsed?t.element.disabled=!0:t.element.disabled=!1}if(0==t.element.disabled){const e=document.getSelection();t.element.disabled=le(Fe.editorNode,e)}},Ge=new Oe("detached","CUT","Cut (text only - use Ctr-V or Cmd-V to include formatting)",_,je,{init:function(e,t){Fe=e,navigator.clipboard&&(Be=!0,Fe.editorNode.addEventListener("cut",Ve),Fe.editorNode.addEventListener("copy",Ve),Fe.editorNode.addEventListener("paste",Ye))},setState:ze}),We=new Oe("detached","COPY","Copy (text only - use Ctr-V or Cmd-V to include formatting)",Q,je,{setState:ze}),_e=new Oe("detached","PASTE","Paste (text only - use Ctr-V or Cmd-V to include formatting)",J,je,{setState:ze});let Qe,Je,Xe="";const Ze=function(e,t){Qe=e.startContainer,Je=e.endContainer,t&&(Qe=se(Qe),Je=se(Je)),Xe="pre"},et=function(e){e==Qe?(Xe="first",e==Je&&(Xe="both")):e==Je?Xe="last":"first"==Xe?Xe="during":"both"==Xe||"last"==Xe?Xe="post-first":"post-first"==Xe&&(Xe="post")},tt=function(){return"pre"==Xe},nt=function(){return"first"==Xe||"both"==Xe},at=function(){return"post-first"==Xe||"post"==Xe};let ot,it,rt=[],lt=!1;function st(e,t){let n,a=it,o=function(e){let t="";return e.childNodes.forEach((e=>{if(3===e.nodeType){let n=e.textContent;n.includes("\n")&&(n=n.trim()),t+=n}else(ae(e)||re(e)||"BR"===e.tagName)&&(t+=e.outerHTML)})),t}(e),i=[];i="during"==Xe||"first"==Xe||"last"==Xe||"both"==Xe?t.newFormats:t.oldFormats;let r=i.slice(-1)[0];e.nodeType;if(!(1!==e.nodeType||""==o&&e.innerHTML.includes("<"))){if(0==rt.length)i.forEach((e=>{n=document.createElement(e),a=a.appendChild(n)}));else if(i.length>rt.length){if(function(e,t){return e.every(((e,n)=>t[n]==e))}(rt,i)){for(let e=0;e<rt.length;e++)a=a.lastElementChild;for(let e=rt.length;e<i.length;e++)n=document.createElement(i[e]),a=a.appendChild(n)}}else(function(e,t){return(0==e.length||0==t.length||e.length==t.length)&&e.every(((e,n)=>t[n]==e))})(i,rt)&&(lt&&lt!=it&&(a=lt.parentNode),n=document.createElement(r),a=a.appendChild(n));if(a==it){let e=0;i.forEach(((t,n)=>{t==rt[n]&&0==(n==i.length-1&&"LI"==t)&&(a=a.lastElementChild,e++)}));for(let t=e;t<i.length;t++)n=document.createElement(i[t]),a=a.appendChild(n)}lt=a,rt=i.slice(),""!=o&&(a.innerHTML=o)}}function ct(e,t,n){let a={oldFormats:[],newFormats:[]};e!=ot&&(et(e),a=function(e,t,n){const a=[...t.oldFormats,e.tagName];let o=[];if(tt()||at())return o=[...a],{newFormats:o,oldFormats:a};if("block"===n.type)return o=[n.newFormat],{newFormats:o,oldFormats:a};if(nt())return"LI"==e.tagName?e.parentNode.firstElementChild==e?(o.pop(),o.push(n.newFormat),o.push("LI")):(o=t.oldFormats.slice(),o.push(n.newFormat),o.push("LI")):(o.push(n.newFormat),o.push("LI")),{newFormats:o,oldFormats:a};return o=rt.slice(),{newFormats:o,oldFormats:a}}(e,t,n),st(e,a)),e.childNodes.forEach((e=>{(ie(e)||oe(e))&&ct(e,a,n)}))}const dt=function(e,t){const n=e.range;ot=e.editorNode,rt=[],lt=!1,function(e){e.action="apply",("CLEAR"==e.tag||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,"block"==e.type&&"remove"==e.action&&(e.newFormat="P")}(t);const a=ce(n.rootNode,ot),o=ce(n.startContainer,ot),i=ce(n.endContainer,ot);if(!1!==a&&!1!==o&&!1!==i){if(n.rootNode=a,function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+me+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+be+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+me+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+be+e.endContainer.textContent.substring(e.endOffset))}(n),Ze(n,!0),o==i)it=document.createElement("DIV"),ct(o,{oldFormats:[],newFormats:[]},t),o==ot?o.innerHTML=it.innerHTML:o.outerHTML=it.innerHTML;else{let e=!1,a=!1;it=document.createElement("DIV"),n.rootNode.childNodes.forEach((n=>{if(1===n.nodeType&&(n==o&&(e=!0),e&&0==a&&("block"===t.type&&(rt=[],lt=!1,it=document.createElement("DIV")),ct(n,{oldFormats:[],newFormats:[]},t),"block"===t.type?n.outerHTML=it.innerHTML:n.setAttribute("data-remove",!0)),n==i)){a=!0,"list"===t.type&&(n.outerHTML=it.innerHTML),ot.querySelectorAll("[data-remove=true]").forEach((e=>e.remove()))}}))}Se(e.editorNode),e.updateRange(),e.setStateForButtonType("block"),e.buffer(),e.updateEventHandlers()}},ut=function(e,t){if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{let n=se(e.range.startContainer,e.editorNode);if(!1===n)return;t.element.disabled="DIV"===n.tagName||re(n)||n.tagName==t.tag,"list"===t.type&&"LI"===n.tagName&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}};function ft(e){return e.id&&e.removeAttribute("id"),e}const ht={setState:ut},pt=new Oe("block","H1","Heading 1",p,dt,{clean:ft,sidebar:function(e){const t=e.editorNode.querySelectorAll("H1,H2,H3");let n="";return t.forEach((e=>{const t=e.tagName;e.id=Te(),n+=`<${t}><a href="#${e.id}" title="Click to view heading in context">${e.innerHTML}</a></${t}>`})),{icon:z,label:"headings",content:`${n}`}},setState:ut}),mt=new Oe("block","H2","Heading 2",m,dt,{clean:ft,setState:ut}),bt=new Oe("block","H3","Heading 3",b,dt,{clean:ft,setState:ut}),gt=new Oe("block","P","Paragraph",g,dt,ht),vt=new Oe("block","BLOCKQUOTE","Blockquote",v,dt,ht),yt=new Oe("list","OL","Ordered list",y,dt,ht),Nt=new Oe("list","UL","Unordered list",N,dt,ht);function Ct(e,t){let n="",a="",o="";return"both"==Xe?(a=e.textContent.substring(0,t.startOffset),n=me+e.textContent.substring(t.startOffset,t.endOffset)+be,o=e.textContent.substring(t.endOffset)):nt()?(a=e.textContent.substring(0,t.startOffset),n=me+e.textContent.substring(t.startOffset)):"last"==Xe?(n=e.textContent.substring(0,t.endOffset)+be,o=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:a,text:n,postText:o}}function wt(e,t,n){if(0==e.length)return t;let a=[],o=[];for(let t=0;t<e.length;t++){const n=e[t].split(":");a.push(n[0].trim()),o.push(n[1].trim())}for(let e=0;e<a.length;e++)for(let t=0;t<a.length;t++)a[e]==a[t]&&e>t&&(a[t]="");let i="";for(let e=0;e<a.length;e++)""!=a[e]&&(i+=`${a[e]}:${o[e]};`);let r=`<span style="${i}">${t}`;return n&&(r+="</span>"),r}const Et=function(e,t){"CLEAR"==t.tag&&t.element.classList.remove("active"),t.element.disabled=e.range.collapsed||e.range.rootNode==e.rootNode||oe(e.range.rootNode),kt(t);const n=function(e){let t="";for(;0==ie(e);){if(1===e.nodeType){const n=e.getAttribute("style");null!=n&&""!=n&&(t+=";"+n)}e.parentNode,e=e.parentNode}return t}(e.range.startContainer);n.includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")},St=function(e,t,n,a){return 3===e.nodeType?function(e,t,n,a){et(e);const{preText:o,text:i,postText:r}=Ct(e,a);let l="";if(tt()||at())l+=wt(t,i,!0);else{const e=`${n.newStyle}:${n.newValue}`,a=function(e,t){let n=-1;return e.forEach(((e,a)=>{e==t&&(n=a)})),n}(t,e);let s=!0;if(o&&(0==t.length?l+=o:(s=!0,"apply"==n.action&&(a>-1||""!=r)&&(s=!1),l+=wt(t,o,s))),i)if("apply"==n.action)if(a>-1&&0==s)l+=i;else{let n=[];n=s?[...t,e]:[e],l+=wt(n,i,!0)}else"remove"!=n.action&&"clear"!=n.action||(l+=i);r&&(0==t.length?l+=r:s?l+=wt(t,r,!0):(l+=r,t.forEach((()=>l+="</span>"))))}return l}(e,t,n,a):re(e)?e.outerHTML:function(e,t,n,a){if("SPAN"===e.tagName){const n=e.getAttribute("style");null!=n&&""!=n&&n.split(";").forEach((e=>{if(""!=e){const n=e.split(":");0==t.includes(n[0].trim())&&(t=[...t,e])}}))}let o="";return e.childNodes.forEach((e=>{o+=St(e,t,n,a)})),o}(e,t,n,a)},kt=function(e){const t=e.style.split(":");e.newStyle=t[0],e.newValue=void 0!==t[1]?t[1]:"",e.action="apply",e.element.classList.contains("active")&&"CLEAR"!=e.style?e.action="remove":"CLEAR"==e.style&&(e.action="clear")},Lt=function(e,t){const n=e.range;if(0==ie(n.rootNode)){const e=se(n.rootNode);if(!1===e)return;n.rootNode=e}kt(t),Ze(n,!1);const a=St(n.rootNode,[],t,n);!function(e,t,n){null==e||e.parentNode;const a=document.createElement(t);a.innerHTML=n;const o=e.parentNode.insertBefore(a,e);e.parentNode.removeChild(e)}(n.rootNode,n.rootNode.tagName,a);Se(e.editorNode),e.updateRange(),t.setState(e,t),e.buffer(),e.updateEventHandlers()};let Tt={setState:Et,style:"font-weight:bold"};const xt=new Oe("style","B","Bold",C,Lt,Tt);Tt={setState:Et,style:"font-style:italic"};const $t=new Oe("style","I","Italic",w,Lt,Tt);Tt={setState:Et,style:"text-decoration:underline"};const At=new Oe("style","U","Underline",E,Lt,Tt);Tt={setState:Et,style:"CLEAR"};const Ot=new Oe("style","CLEAR","Clear",S,Lt,Tt);let qt,Dt,Ht,Rt,Mt=[],It=0,Pt=null;function Ut(e){let t="";return Mt.forEach((n=>{const a=n.toLowerCase();(""==e||a.includes(e))&&(t+=`<li>${n}</li>`)})),t}function Bt(e=!0){It>=0&&Dt.length>0&&(Dt.forEach((e=>e.classList.remove("selected"))),Dt[It].classList.add("selected"),e&&Dt[It].scrollIntoView({block:"end",inline:"nearest"}))}function Ft(e){const t=e.key,n=e.shiftKey;let a=!1;if(e.preventDefault(),e.stopPropagation(),0==Dt.length?It=-1:"ArrowDown"==t||"ArrowRight"==t||"Tab"==t&&0==n?(e.preventDefault(),It<Dt.length-1?It++:It=0,a=!0,Bt()):("ArrowUp"==t||"ArrowLeft"==t||"Tab"==t&&n)&&(e.preventDefault(),0==It?It=Dt.length-1:It--,a=!0,Bt()),0==a)if("Enter"!=t)Ht.innerHTML=Ut(Rt.value.toLowerCase()),Dt=Ht.querySelectorAll("li"),It=0,Bt();else{Vt(-1!=It?Dt[It].textContent:Rt.value)}}function Kt(e){Vt(e.target.textContent)}function Vt(e){let t=qt.range.startContainer.textContent,n=qt.range.startOffset,a=t.substring(0,n),o=t.substring(n);"@"===o.charAt(0)&&(o=o.slice(1,o.length)),""!=e&&(32!==t.charCodeAt(n-1)&&(e=" "+e),n<t.length&&32!==t.charCodeAt(n)&&(""!=o&&(o+=" "),e+=" ")),qt.range.startContainer.textContent=a+e+o,n+=e.length,qt.range=we(qt.range.startContainer,n),Pt.hide(),qt.buffer()}const Yt=function(){Vt("")};const jt=function(e){Mt=e.sort()},zt={setState:function(e,t){t.element.disabled=0==e.range.collapsed||!1!==e.range.custom},shortcut:["@","@"]},Gt=new Oe("custom","MENTION","Mention",T,(function(e,t){!1!==e.range&&(qt=e,Pt=new ee({type:"positioned",escape:Yt,html:`<div class="mentions">\n                <input type="text"/>\n                <ul>${Ut("")}</ul>\n            </div>`}),Pt.show(),Pt.setPosition(qt.range,qt.editorNode),Pt.container.addEventListener("keyup",Ft),Ht=Pt.container.querySelector("ul"),Ht.addEventListener("click",Kt),Dt=Ht.querySelectorAll("li"),It=0,Bt(!1),Rt=Pt.container.querySelector("input"),Rt.value="",Rt.focus())}),zt),Wt="ARTE-LINK";let _t,Qt,Jt,Xt,Zt=null,en=null;function tn(){en.hide(),Zt.hide()}function nn(){Xt?en=ke(tn):Zt.hide()}function an(){en.hide(),Zt.hide(),Jt.remove(),_t.range=!1,un(_t,Qt),_t.buffer()}function on(){en=Le("link",an)}function rn(e){Zt&&Zt.active()||(Jt=e,ln("",!0))}function ln(e,t){let n="Create link",a={cancel:{label:"Cancel",callback:nn},confirm:{label:"Save",callback:sn}};t?(n="Edit link",a.delete={label:"Delete",callback:on}):(Jt=document.createElement(Wt),Jt.id=Te(),Jt.setAttribute("contenteditable","false"),Jt.dataset.href="",Jt.dataset.label=e,Jt.dataset.display=0),Zt=new ee({type:"drawer",title:n,html:dn(t),buttons:a}),Zt.show(),Xt=!1;Zt.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>Xt=!0))));const o=Zt.panel.querySelector("form #href");o.focus(),o.setSelectionRange(o.value.length,o.value.length)}function sn(){null==Jt.parentNode&&(Jt=de(_t,Jt)),Jt.dataset.href=Zt.panel.querySelector("form #href").value.trim(),Jt.dataset.label=Zt.panel.querySelector("form #label").value.trim(),Jt.dataset.display=parseInt(Zt.panel.querySelector("form #display").value),Zt.hide(),cn(Jt),_t.range=we(Jt,0),un(_t,Qt),_t.buffer()}function cn(e){0==e.id&&(e.id=Te()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerHTML="";const t=document.createElement("a");t.href=e.dataset.href,t.innerText=function(e){switch(parseInt(e.dataset.display)){case 0:if(""!=e.dataset.label)return e.dataset.label;break;case 1:return e.dataset.href;case 2:if(""!=e.dataset.label&&e.dataset.label!=e.dataset.href)return`${e.dataset.label} (${e.dataset.href})`}return e.dataset.href}(e),e.appendChild(t),t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),rn(e)}))}function dn(e){let t="",n=Jt.dataset.display?Jt.dataset.display:0;return e&&(t=`(<a href="${Jt.dataset.href}" class="link" target="_blank" title="Open link in new tab or window">${q} Open</a>)`),`\n        <form class="arte-link">\n            <div class="form-input">\n                <label for="href">URL ${t}</label>\n                <input id="href" type="text" class="form-control" placeholder="URL" required value="${Jt.dataset.href}">\n            </div>\n            <div class="form-input">\n                <label for="label">Label (optional)</label>\n                <input id="label" type="text" class="form-control" placeholder="Label" value="${Jt.dataset.label}">\n            </div>\n            <div class="form-input">\n                <label for="label">Display option</label>\n                <select class="form-control" id="display">\n                    <option value="0" ${0==n?"selected":""}>Label only</option>\n                    <option value="1" ${1==n?"selected":""}>Link only</option>\n                    <option value="2" ${2==n?"selected":""}>Label and link</option>\n                </select>\n            </div>\n        </form>`}const un=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||oe(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(Wt)?t.element.classList.add("active"):t.element.classList.remove("active")}},fn={init:function(e,t){_t=e,Qt=t;_t.editorNode.querySelectorAll(Wt).forEach((e=>cn(e)))},setState:un,addEventHandlers:function(e){_t=e,Qt=hn;_t.editorNode.querySelectorAll(Wt).forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),rn(e)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.removeAttribute("title"),e.innerHTML="",e},sidebar:function(e){const t=e.editorNode.querySelectorAll(Wt);let n="";return t.forEach((e=>{n+=`\n            <article>\n                <a href="#${e.id}" title="Click to view link in context">\n                    ${e.dataset.label} (${e.dataset.href})\n                </a>\n            </article>`})),{icon:x,label:"links",content:`${n}`}}},hn=new Oe("custom",Wt,"Link",x,(function(e,t){if(Zt&&Zt.active())return;if(_t=e,Qt=t,!1===_t.range)return;let n="";0==_t.range.collapsed&&_t.range.startContainer==_t.range.endContainer&&(n=_t.range.endContainer.textContent.substring(_t.range.startOffset,_t.range.endOffset)),ln(n,!1)}),fn),pn="ARTE-IMAGE";let mn,bn,gn,vn,yn=null,Nn=null;function Cn(){Nn.hide(),yn.hide()}function wn(){vn?Nn=ke(Cn):yn.hide()}function En(){Nn.hide(),yn.hide(),gn.remove(),mn.range=!1,$n(mn,bn),mn.buffer()}function Sn(){Nn=Le("image",En)}function kn(e){yn&&yn.active()||(gn=e,Ln(!0))}function Ln(e){let t="Insert image",n={cancel:{label:"Cancel",callback:wn},confirm:{label:"Save",callback:()=>function(e=!1){gn.dataset.src=yn.panel.querySelector("form #src").value.trim(),gn.dataset.caption=yn.panel.querySelector("form #caption").value.trim(),gn.dataset.alt=yn.panel.querySelector("form #alt").value.trim(),0==e&&mn.range.blockParent.appendChild(gn);yn.hide(),Tn(gn),mn.range=we(gn,0),$n(mn,bn),mn.buffer()}(e)}};e?(t="Edit image",n.delete={label:"Delete",callback:Sn}):(gn=document.createElement(pn),gn.id=Te(),gn.setAttribute("contenteditable","false"),gn.dataset.src="",gn.dataset.alt="",gn.dataset.caption=""),yn=new ee({type:"drawer",title:t,html:xn(e),buttons:n,escape:!0}),yn.show(),vn=!1;yn.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>vn=!0))));const a=yn.panel.querySelector("form #src");a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function Tn(e){0==e.id&&(e.id=Te()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerHTML="";const t=document.createElement("img");if(t.src=e.dataset.src,t.alt=e.dataset.alt,e.appendChild(t),""!=e.dataset.caption){const t=document.createElement("span");t.classList.add("caption"),t.innerText=e.dataset.caption,e.appendChild(t)}e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),kn(e)}))}function xn(e){return`\n        <form class="arte-image">\n            <p class="advice">Please enter a URL and optional caption for an image file:\n            <div class="form-input">\n                <label for="src">URL</label>\n                <input id="src" type="text" class="form-control" placeholder="Source URL" required value="${gn.dataset.src}">\n            </div>\n            <div class="form-input">\n                <label for="caption">Caption</label>\n                <input id="caption" type="text" class="form-control" placeholder="Caption for image" value="${gn.dataset.caption}">\n            </div>\n            <div class="form-input">\n                <label for="alt">Alt text</label>\n                <input id="alt" type="text" class="form-control" placeholder="Alt text for image" value="${gn.dataset.alt}">\n            </div>\n        </form>`}const $n=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||oe(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(pn)?t.element.classList.add("active"):t.element.classList.remove("active")}},An={init:function(e,t){mn=e,bn=t;mn.editorNode.querySelectorAll(pn).forEach((e=>Tn(e)))},setState:$n,addEventHandlers:function(e){mn=e,bn=On;mn.editorNode.querySelectorAll(pn).forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),kn(e)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.removeAttribute("title"),e.innerHTML="",e},sidebar:function(e){const t=e.editorNode.querySelectorAll(pn);let n="";return t.forEach((e=>{const t=e.querySelector("img");n+=`\n            <a href="#${e.id}">\n                <img src="${t.src}" alt="${t.alt}" title="Click to view image in document"/>\n            </a>`})),{icon:H,label:"images",content:`${n}`}}},On=new Oe("custom",pn,"Image",H,(function(e,t){yn&&yn.active()||(mn=e,bn=t,!1!==mn.range&&Ln(!1))}),An),qn=["black","white","violet","indigo","blue","green","yellow","orange","red"];let Dn=null;function Hn(){let e="";for(let t=0;t<qn.length;t++)e+=`<span class="colour" data-index="${t}" style="background-color:${qn[t]}">&nbsp;</span>`;return`\n        <form id="colour-menu">\n            <div class="colours">\n                ${e}\n            </div>\n        </form>`}const Rn=function(e,t){if(!Dn||!Dn.active())if(!1===e.range||e.range.collapsed){new ee({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show()}else!function(e,t){let n="Select highlight colour";"ARTE-COLOR"==t.tag&&(n="Select text colour"),Dn=new ee({type:"drawer",title:n,html:Hn(),escape:!0,buttons:{cancel:{label:"Cancel"}}}),Dn.show(),Dn.panel.querySelectorAll("span.colour").forEach((n=>n.addEventListener("click",(n=>{const a=qn[n.target.dataset.index],o={setState:Mn,style:`${t.style}:${a}`,element:t.element};Dn.hide(),Lt(e,o)}))))}(e,t)},Mn=function(e,t){t.element.disabled=!1===e.range||e.range.collapsed||e.range.rootNode==e.editorNode||oe(e.range.rootNode);let n="",a=[];const o=e.range.startContainer.parentNode.getAttribute("style");null!=o&&(a=o.split(";"),a.forEach((e=>{if(""!==e){const a=e.split(":");a[0].trim()===t.style&&(n=a[1].trim(),t.element.querySelector("span.bar").setAttribute("style",`background-color:${n};`))}}))),""==n&&t.element.querySelector("span.bar").removeAttribute("style")},In=function(e,t){const n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")};let Pn={init:In,setState:Mn,style:"color"};const Un=new Oe("inline","ARTE-COLOR","Text colour",$,Rn,Pn);Pn={init:In,setState:Mn,style:"background-color"};const Bn=new Oe("inline","ARTE-BACKGROUND-COLOR","Highlight colour",A,Rn,Pn),Fn="ARTE-ACTION";let Kn,Vn,Yn,jn,zn=null,Gn=null;function Wn(e){zn&&zn.active()||(Yn=e,Zn(!0))}function _n(){Gn.hide(),zn.hide()}function Qn(){Gn.hide(),zn.hide(),Yn.remove(),Kn.range=!1,na(Kn,Vn),Kn.buffer()}function Jn(){jn?Gn=ke(_n):zn.hide()}function Xn(){Gn=Le("action",Qn)}function Zn(e){let t="Add action",n={cancel:{label:"Cancel",callback:Jn},confirm:{label:"Save",callback:ea}};e?(t="Edit action",n.delete={label:"Delete",callback:Xn}):(Yn=document.createElement(Fn),Yn.id=Te(),Yn.setAttribute("contenteditable","false"),Yn.dataset.status="0",Yn.dataset.todo="",Yn.dataset.owners="",Yn.dataset.due="",Yn.dataset.created="",Yn.dataset.updated="",Yn.dataset.notes=""),zn=new ee({type:"drawer",title:t,html:`\n        <form class="comment">\n            <div class="form-input">\n                <label for="todo">What needs to be done</label>\n                <textarea id="todo" class="form-control" required>${Yn.dataset.todo}</textarea>\n            </div>\n            <div class="form-input">\n                <label for="owners">Owners</label>\n                <input type="text" id="owners" class="form-control" value="${Yn.dataset.owners}" required />\n            </div>\n            <div class="form-input">\n                <label for="due">Due by</label>\n                <input type="text" id="due" class="form-control" value="${Yn.dataset.due}"/>\n            </div>\n            <div class="form-input">\n                <label for="status">Status</label>\n                <select id="status" class="form-control">\n                    <option value="0" ${0==Yn.dataset.status?"selected":""}>Open</option>\n                    <option value="1" ${1==Yn.dataset.status?"selected":""}>Closed - Incomplete</option>\n                    <option value="2" ${2==Yn.dataset.status?"selected":""}>Closed - Complete</option>\n                </select>\n            </div>\n            <div class="form-input">\n                <label for="notes">Notes</label>\n                <textarea id="notes" class="form-control">${Yn.dataset.notes}</textarea>\n            </div>\n        </form>`,buttons:n}),zn.show(),jn=!1;zn.panel.querySelectorAll("form input, form textarea, form select").forEach((e=>e.addEventListener("change",(()=>jn=!0))));const a=zn.panel.querySelector("#todo");a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function ea(){Yn.dataset.todo=zn.panel.querySelector("#todo").value.trim(),Yn.dataset.owners=zn.panel.querySelector("#owners").value.trim(),Yn.dataset.due=zn.panel.querySelector("#due").value.trim(),Yn.dataset.status=parseInt(zn.panel.querySelector("#status").value.trim()),Yn.dataset.notes=zn.panel.querySelector("#notes").value.trim();const e=(new Date).toLocaleString().slice(0,-3);""==Yn.dataset.created&&(Yn.dataset.created=e,Yn=Kn.range.startContainer.parentNode.appendChild(Yn)),Yn.dataset.updated=e,zn.hide(),ta(Yn),Kn.range=we(Yn,0),na(Kn,Vn),Kn.buffer()}function ta(e){e.id;0==e.id&&(e.id=Te()),e.setAttribute("contenteditable",!1),e.innerHTML=function(e){const t=function(e){switch(parseInt(e)){case 0:return"status-open";case 1:return"status-closed-incomplete";case 2:return"status-closed-complete"}return"status-unknown"}(e.dataset.status),n=""==e.dataset.due?"":`\n        <label>Due:</label>\n        <span class="due">${e.dataset.due}</span>`;return`\n        <button type="button" title="Edit this action">\n            <label class="${t}">${W}</label>\n            <span class="todo">${e.dataset.todo}</span>\n            <label>Owners:</label>\n            <span class="owners">${e.dataset.owners}</span>\n            ${n}\n        </button>`}(e),e.querySelector("button").addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Wn(e)})),e.addEventListener("click",(()=>{na(Kn,Vn)}))}const na=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||0==ie(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(Fn)?t.element.classList.add("active"):t.element.classList.remove("active")}},aa={setState:na,init:function(e,t){Kn=e,Vn=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>ta(e)))},addEventHandlers:function(e){Kn=e,Vn=oa,Kn.editorNode.querySelectorAll("ARTE-ACTION button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();Wn(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.innerHTML="",e},sidebar:function(e){const t=e.editorNode.querySelectorAll(Fn);let n="";return t.forEach((e=>{const t=e.querySelector(".todo").innerHTML.trim(),a=e.querySelector(".owners").innerHTML.trim(),o=e.querySelector(".due");let i="";null!=o&&(i+=`,<br/>Due: ${o.innerText.trim()}`),n+=`\n            <article class="action">\n                <a href="#${e.id}">${t}</a>\n                <p>Owned by: ${a}${i}</p>\n            </article>`})),{icon:W,label:"actions",content:`${n}`}}},oa=new Oe("custom",Fn,"Action",W,(function(e,t){if(zn&&zn.active())return;Kn=e,Vn=t;const n=Kn.range.blockParent.querySelector(Fn);null!=n?Wn(n):Zn(!1)}),aa),ia="ARTE-COMMENT";let ra,la,sa,ca,da=null,ua=null;function fa(e){da&&da.active()||(sa=e,va(!0))}function ha(){ua.hide(),da.hide()}function pa(){ua.hide(),da.hide(),sa.remove(),ra.range=!1,Ea(ra,la),ra.buffer()}function ma(){ca?ua=ke(ha):da.hide()}function ba(){ua=Le("comment",pa)}function ga(e){"false"==sa.dataset.resolved?(sa.dataset.resolved="true",resolve.innerHTML=F+" Unresolve"):sa.dataset.resolved="false",e.target.innerHTML=Ca()}function va(e){let t="Add comment",n={cancel:{label:"Cancel",callback:ma},confirm:{label:"Save",callback:ya}};e?(t="Edit comment",n.delete={label:"Delete",callback:ba}):(sa=document.createElement(ia),sa.id=Te(),sa.setAttribute("contenteditable","false"),sa.dataset.comment="",sa.dataset.created="",sa.dataset.updated="",sa.dataset.resolved="false"),da=new ee({type:"drawer",title:t,html:wa(),buttons:n}),da.show(),ca=!1;const a=da.panel.querySelector("form textarea#comment");a.addEventListener("change",(()=>ca=!0));const o=da.panel.querySelector("form button#resolve");null!=o&&o.addEventListener("click",ga),a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function ya(){sa.dataset.comment=da.panel.querySelector("form #comment").value.trim();const e=(new Date).toLocaleString().slice(0,-3);""==sa.dataset.created&&(sa.dataset.created=e,sa=ra.range.startContainer.parentNode.appendChild(sa)),sa.dataset.updated=e,da.hide(),Na(sa),ra.range=we(sa,0),Ea(ra,la),ra.buffer()}function Na(e){e.id;0==e.id&&(e.id=Te()),e.innerHTML="",e.setAttribute("contenteditable",!1);const t=document.createElement("button");t.type="button",t.title="Edit this comment",t.innerHTML=P,t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),fa(e)})),e.appendChild(t),e.addEventListener("click",(()=>{Ea(ra,la)}))}function Ca(){return"true"==sa.dataset.resolved?F+" Unresolve":B+" Resolve"}function wa(){let e="";""!=sa.dataset.created&&(e=`<span><label>Created</label> ${sa.dataset.created}</span>`),""!=sa.dataset.updated&&(e+=`<span><label>Updated</label> ${sa.dataset.updated}</span>`);let t="";if(""!=e){e=`<div class="timestamps">${e}</div>`;t=`<button type="button" id="resolve">${Ca()}</button>`}return`\n        <form class="comment">\n            <div class="form-input">\n                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>${sa.dataset.comment}</textarea>\n            </div>\n            ${e}\n            ${t}\n        </form>`}const Ea=function(e,t){if(!1===e.range||e.range.rootNode==e.editorNode||0==ie(e.range.rootNode))t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(ia)?t.element.classList.add("active"):t.element.classList.remove("active")}},Sa={setState:Ea,init:function(e,t){ra=e,la=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>Na(e)))},addEventHandlers:function(e){ra=e,la=ka,ra.editorNode.querySelectorAll("ARTE-COMMENT button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();fa(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.innerHTML="",e},sidebar:function(e){const t=e.editorNode.querySelectorAll(ia);let n="";return t.forEach((e=>{const t="true"==e.dataset.resolved?"comment-resolved":"comment-unresolved";n+=`\n            <article>\n                <a href="#${e.id}" title="Click to view comment in context">\n                    <span class="comment-bubble ${t}">${P}</span> ${e.dataset.comment}\n                </a>\n                <p class="sub-title">Added: ${e.dataset.created}</p>\n            </article>`})),{icon:I,label:"comments",content:`${n}`}}},ka=new Oe("custom",ia,"Custom",I,(function(e,t){if(da&&da.active())return;ra=e,la=t;const n=ra.range.blockParent.querySelector(ia);null!=n?fa(n):va(!1)}),Sa);let La=null;function Ta(e){localStorage.setItem("headingNumbers",e.options.headingNumbers),e.options.headingNumbers?e.editorNode.classList.add("heading-numbers"):e.editorNode.classList.remove("heading-numbers")}function xa(e){localStorage.setItem("theme",e),document.documentElement.className=e}function $a(){La.hide()}function Aa(e){La=new ee({type:"drawer",escape:!0,title:"Options",html:Oa(e.options),buttons:{cancel:{label:"Close",callback:$a}}}),La.show();La.panel.querySelectorAll("form input").forEach((t=>t.addEventListener("change",(t=>{"headingNumbers"==t.target.name?(e.options.headingNumbers="on"==t.target.id,Ta(e)):"theme"==t.target.name?(e.options.theme=t.target.id,xa(e.options.theme)):"explorer"==t.target.name&&(e.options.explorer="show-explorer"==t.target.id,function(e){localStorage.setItem("explorer",e.options.explorer),e.options.explorer?e.showSidebar():e.hideSidebar()}(e))}))))}function Oa(e){return`\n        <form>\n            <div class="form-input options">\n                <label>Heading numbers</label>\n                <label>\n                    <input name="headingNumbers" id="on" type="radio" class="form-control first" ${e.headingNumbers?"checked":""}/> On\n                </label>\n                <label>\n                    <input name="headingNumbers" id="off" type="radio" class="form-control" ${e.headingNumbers?"":"checked"}/> Off\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Theme</label>\n                <label>\n                    <input name="theme" id="theme-light" type="radio" class="form-control first" ${"theme-light"==e.theme?"checked":""}/> Light\n                </label>\n                <label>\n                    <input name="theme" id="theme-dark" type="radio" class="form-control" ${"theme-dark"==e.theme?"checked":""}/> Dark\n                </label>\n            </div>\n            <div class="form-input options">\n                <label>Explorer</label>\n                <label>\n                    <input name="explorer" id="show-explorer" type="radio" class="form-control first" ${e.explorer?"checked":""}/> Show\n                </label>\n                <label>\n                    <input name="explorer" id="hide-explorer" type="radio" class="form-control" ${0==e.explorer?"checked":""}/> Hide\n                </label>\n            </div>\n        </form>`}const qa={setState:function(e,t){t.element.disabled=!1},init:function(e,t){const n=localStorage.getItem("theme");n&&(e.options.theme=n),xa(e.options.theme);const a=localStorage.getItem("headingNumbers");localStorage.getItem("headingNumbers")&&(e.options.headingNumbers=a),Ta(e)}},Da=new Oe("detached","SETTINGS","Preferences",U,(function(e,t){La&&La.active()||Aa(e)}),qa);return t})()}));