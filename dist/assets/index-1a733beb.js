var Qt=Object.defineProperty;var Zt=(e,t,n)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ct=(e,t,n)=>(Zt(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Jt='<i class="bi bi-type-h1"></i>',en='<i class="bi bi-type-h2"></i>',tn='<i class="bi bi-type-h3"></i>',nn='<i class="bi bi-paragraph"></i>',an='<i class="bi bi-chat-left-quote"></i>',sn='<i class="bi bi-list-ol"></i>',on='<i class="bi bi-list-ul"></i>',ln='<i class="bi bi-type-bold"></i>',rn='<i class="bi bi-type-italic"></i>',cn='<i class="bi bi-type-underline"></i>',ht='<i class="bi bi-eraser"></i>',dn='<i class="bi bi-reply"></i>',un='<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',fn='<i class="bi bi-person"></i>',pt='<i class="bi bi-link"></i>',hn='<i class="bi bi-type"></i>',pn='<i class="bi bi-paint-bucket"></i>',mn='<i class="bi bi-link-45deg"></i>',bn='<i class="info bi bi-info-circle-fill"></i>',mt='<i class="bi bi-image"></i>',gn='<i class="warning bi bi-cone-striped"></i>',yn='<i class="danger bi bi-exclamation-circle-fill"></i>',bt='<i class="bi bi-chat-dots"></i>',gt='<i class="bi bi-chat-dots-fill"></i>',vn='<i class="bi bi-gear"></i>',wn='<i class="bi bi-check-circle-fill"></i>',yt='<i class="bi bi-x-circle-fill"></i>',Cn='<i class="bi bi-eye"></i>',$n='<i class="bi bi-cloud-download"></i>',Nn='<i class="bi bi-folder2-open"></i>',En='<i class="bi bi-card-heading"></i>',Sn='<i class="bi bi-list"></i>',Ke='<i class="bi bi-check2-square"></i>',Tn='<i class="bi bi-scissors"></i>',Ln='<i class="bi bi-clipboard-plus"></i>',kn='<i class="bi bi-box-arrow-down"></i>',dt=["cancel","delete","confirm"],he=class{constructor(t){this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1;for(let n in t)this[n]=t[n];he.self=this}setPosition(t,n){this.container=this.panel.querySelector(".modal-panel-container");let a;t.startContainer.nodeType!==3?t.startContainer.childNodes.length>0?a=t.startContainer.childNodes[0].getBoundingClientRect():a={x:n.offsetLeft,y:n.offsetTop}:a=t.getBoundingClientRect(),a.x+this.container.offsetWidth>window.innerWidth&&(a.x=window.innerWidth-this.container.offsetWidth-20),a.y+this.container.offsetHeight>window.innerHeight&&(a.y=window.innerHeight-this.container.offsetHeight-40),this.container.style.top=`${a.y}px`,this.container.style.left=`${a.x}px`}template(){let t=[];this.backgroundColour!=null&&t.push(`background-color:${this.backgroundColour}`),this.borderRadius!=null&&t.push(`border-radius:${this.borderRadius}`);let a=`<div class="modal-panel-container" ${t.length==0?"":`style="${t.join(";")}"`}>`,s="";switch(this.severity){case"info":s=bn;break;case"warning":s=gn;break;case"danger":s=yn;break}if(this.title||s){const i=this.title?"with-text":"";a+=`
                <header class="modal-panel-header">
                    <h3 class="modal-panel-title ${i}">${s}${this.title}</h3>
                </header>`}if(a+=`<div class="modal-panel-body">${this.html}</div>`,this.buttons){let i="",l=0;dt.forEach(C=>{if(this.buttons[C]){l++;const A=C=="confirm"?"submit":"button";i+=`<button type="${A}" class="${C}">${this.buttons[C].label}</button>`}});const r=`<div class="modal-panel-buttons ${l==1?"centred":""}">${i}</div>`;a.includes("</form")?a=a.replace("</form>",r+"</form>"):a+=`<form>${r}</form>`}return a+="</div>",a}hide(){if(this.panel==null){console.warn("Attempt to hide panel that is already hidden");return}this.panel.classList.remove("show"),document.body.removeEventListener("keydown",this.handleKeydown),setTimeout(()=>{this.panel!=null&&(this.panel.remove(),this.panel=null)},500)}active(){return!!document.querySelector(".modal-panel")}escapeOrHide(){this.escape instanceof Function?this.escape():this.hide()}handleKeydown(t){t.key=="Escape"&&(t.stopPropagation(),he.self.escapeOrHide())}addEventListeners(){this.buttons&&dt.forEach(t=>{if(this.buttons[t]){const n=this.buttons[t],a=this.panel.querySelector(`button.${t}`);if(a){let s="click",i=a;t=="confirm"&&(s="submit",i=this.panel.querySelector("form")),i.addEventListener(s,l=>{l.preventDefault(),l.stopPropagation(),n.callback?n.callback():this.hide()})}}}),this.escape&&(document.body.addEventListener("keydown",this.handleKeydown),this.panel.addEventListener("click",t=>{t.target==this.panel&&(t.stopPropagation(),this.escapeOrHide())}))}show(){this.panel=document.createElement("DIV"),this.panel.id=x(),this.panel.classList.add("modal-panel"),this.panel.classList.add(`modal-panel-${this.type}`),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout(()=>{this.panel.classList.add("show"),this.panel.scrollIntoView()},10)}};let h=he;ct(h,"self");const xn=function(e,t){return e.length!=0&&t.length!=0&&e.length!=t.length?!1:e.every((n,a)=>t[a]==n)},An=function(e,t){return e.every((n,a)=>t[a]==n)};let ee={block:["DIV","LI"],list:["LI"],custom:[]};const On=function(e,t){ee[e]!=null&&ee[e].includes(t)==!1&&t!="CLEAR"&&ee[e].push(t)},ut=function(e,t){return(e==null||t==null)&&console.warn("Error.  Found when inserting a new node after an existing node"),t.parentNode.insertBefore(e,t.nextSibling)},Dn=function(e,t){return(e==null||t==null)&&console.warn("Error.  Found when inserting a new node before an existing node"),t.parentNode.insertBefore(e,t)},Hn=function(e,t,n){(e==null||e.parentNode==null)&&(console.warn("Error.  Found when replacing an existing node with a new node"),console.warn({existingNode:e}),console.warn(e.parentNode));const a=document.createElement(t);a.innerHTML=n;const s=e.parentNode.insertBefore(a,e);return e.parentNode.removeChild(e),s},vt=function(e){return e.nodeType!=1?!1:e.tagName==="SPAN"||e.tagName==="I"},U=function(e){return e.nodeType!=1?!1:e.tagName==="OL"||e.tagName==="UL"},P=function(e){return e.nodeType!=1?!1:ee.block.includes(e.tagName)},R=function(e){return e.tagName==null?!1:ee.custom.includes(e.tagName)};function qn(e,t){return e!==t&&e.contains(t)}const Rn=function(e){e===!1&&console.warn("Error.  Passed missing range when looking for a custom node");let t=e.startContainer;for(;R(t)==!1&&t.parentNode!=null&&t.parentNode&&t.parentNode.tagName!="DIV";)t=t.parentNode;return R(t)?t:!1},Ve=function(e,t){const n=e.querySelectorAll('[contenteditable="false"]');let a=!1;for(let s=0;s<n.length&&a==!1;s++)t.containsNode(n[s],!0)&&(a=!0);return a},In=function(e){e==null&&console.warn("Found null node when getting inline styles");let t="";for(;P(e)==!1;){if(e.nodeType===1){const n=e.getAttribute("style");n!=null&&n!=""&&(t+=";"+n)}e.parentNode==null&&console.warn("Error.  Found missing parent node when getting inline styles"),e=e.parentNode}return t},se=function(e){if(e==null)return console.warn("Error. Passed null node to getParentBlockNode"),!1;for(;P(e)==!1;){if(e.parentNode==null)return console.warn("Error. Found missing parent node when getting parent block node"),!1;e=e.parentNode}return e},Ae=function(e,t){(e==null||t==null)&&console.warn("Error. Passed null node or stopNode to getTopParentNode");let n=e;for(;e!=t;){if(n=e,e==null)return console.warn("Error.  Found missing node traversing tree in getTopParentNode"),!1;if(e.parentNode==null)return console.warn("Error.  Found missing parent node when getting top parent node"),!1;e=e.parentNode}return n},Ye=function(e,t){const n=e.range.startContainer.parentNode;let a=e.range.startContainer.textContent.substring(0,e.range.startOffset),s;return e.range.collapsed?(s=e.range.startContainer.textContent.substring(e.range.startOffset),a.charAt(a.length+1)!=" "&&(a=a+" "),s.charAt(0)!=" "&&(s=" "+s)):s=e.range.startContainer.textContent.substring(e.range.endOffset),a&&n.insertBefore(document.createTextNode(a),e.range.startContainer),t=n.insertBefore(t,e.range.startContainer),console.warn(t),s&&n.insertBefore(document.createTextNode(s),e.range.startContainer),e.range.startContainer.remove(),setTimeout(()=>{Mn(t)},10),t};function Mn(e){R(e)?e.nextSibling!==null?H(e.nextSibling,0):e.previousSibling!==null&&H(e.previousSibling,e.previousSibling.textContent.length):H(e,e.textContent.length)}const wt=function(e,t){if(e.nodeType===3){e.textContent.includes(`
`)&&(e.textContent=e.textContent.trim());return}if(e.nodeType!==1){e.remove();return}const n=R(e);if(P(e)===!1&&U(e)===!1&&vt(e)===!1&&n===!1){console.warn("Removing node",e.tagName),e.remove();return}if(e.tagName=="SPAN"){Pn(e);return}if(t.length>0){const a=t.find(s=>s.tag.toUpperCase()===e.tagName);if(a){const s=a.clean(e);e.parentNode==null&&console.warn("Error.  Found missing parent node when cleaning for saving"),e.parentNode.replaceChild(s,e)}}n||e.childNodes.forEach(a=>{wt(a,t)})};function Pn(e){const t=e.getAttribute("style");let n="";if(t&&t.split(";").forEach(s=>{s&&s.includes("var(--")==!1&&(n+=`${s};`)}),n)e.setAttribute("style",n.trim());else if(t){const a=document.createTextNode(e.textContent.trim());Dn(a,e),e.remove()}}let I="";function Oe(e){let t=`
`;for(let n=0;n<e;n++)t+="    ";return t}function Bn(e){return R(e)?!(e.nextElementSibling!=null&&e.nextElementSibling.nodeType===3):P(e)||U(e)}function Ct(e,t){if(e.nodeType==3){const n=e.textContent;n!=""&&(e.previousElementSibling==null&&(t++,I+=Oe(t)),I+=n)}else if(e.nodeType==1){let n=!1;if(e.tagName!="DIV"){const a=e.attributes;let s=e.tagName;for(let i=0;i<a.length;i++){const l=a[i];s+=` ${l.nodeName}="${l.nodeValue}"`}Bn(e)&&(n=!0,t++,I+=Oe(t)),I+=`<${s}>`}e.childNodes.forEach(a=>{Ct(a,t)}),e.tagName!="DIV"&&(n&&R(e)==!1&&(I+=Oe(t)),I+=`</${e.tagName}>`)}else console.warn("Found unknown node type",e.nodeType)}const Fn=function(e){return I="",Ct(e,-1),I},W="§§",ie="±±";let De=null,He=0,qe=null,Re=0;const Un=function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+W+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+ie+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+W+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+ie+e.endContainer.textContent.substring(e.endOffset))};function ze(e){e===!1&&console.warn("Found missing range when augmenting range");const t=se(e.commonAncestorContainer);if(t===!1)return!1;if(e.blockParent=t,e.rootNode=e.commonAncestorContainer,e.commonAncestorContainer.nodeType===3){if(e.commonAncestorContainer.parentNode==null)return console.warn("Error.  Found missing parent node when augmenting range"),!1;e.rootNode=e.commonAncestorContainer.parentNode}return e.custom=Rn(e),e}const Kn=function(e){let t=window.getSelection();if(t.rangeCount==1){let n=t.getRangeAt(0);if(n.commonAncestorContainer==e||qn(e,n.commonAncestorContainer))return n=ze(n),n}return!1},H=function(e,t){let n=document.createRange();const a=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),a.removeAllRanges(),a.addRange(n),n=ze(n),n},Vn=function(e){const t=window.getSelection();return t.removeAllRanges(),t.addRange(e),e=ze(e),e},Yn=function(e){return Ge(e,W)},zn=function(e){return Ge(e,ie)};function Ge(e,t){for(let n=0;n<e.childNodes.length;n++){const a=e.childNodes[n];if(a.nodeType===1){if(Ge(a,t))return!0}else if(a.nodeType===3){const s=a.textContent.indexOf(t);if(s!=-1)return a.textContent=a.textContent.replace(t,""),t==W?(De=a,He=s):(qe=a,Re=s),!0}}return!1}const $t=function(e){if(Yn(e)&&zn(e)){const t=document.createRange(),n=window.getSelection();return t.setStart(De,He),De==qe&&He==Re?t.collapse(!0):t.setEnd(qe,Re),n.removeAllRanges(),n.addRange(t),t}return!1},pe=function(e){const t=new h({type:"overlay",severity:"warning",title:"Cancel changes?",html:"Do you really want to lose changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - lose changes",callback:e}}});return t.show(),t},me=function(e,t){const n=new h({type:"overlay",severity:"warning",title:`Delete ${e}?`,html:`Do you really want to delete this ${e}?`,buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete",callback:t}}});return n.show(),n},x=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},Gn=function(e,t){let n;return function(...a){n&&clearTimeout(n),n=setTimeout(()=>{e(...a)},t)}};function Wn(e){const{type:t,tag:n,label:a,icon:s}=e;return`
        <button id="${n}" type="button" class="btn btn-light ${t}" title="${a}">
            ${s} <span class="mobile">${a}</span>
        </button>`}function _n(e,t){return`<div class="editor-toolbar-group block" role="group" title="${e}">
                ${t}
            </div>`}function jn(e){let t="",n=[];e.forEach((s,i)=>{t+=Wn(s);const l=i==e.length-1?"":e[i+1].group;if(s.group!=l){const o=`${s.group} buttons`;n.push(_n(o,t)),t=""}});const a=n.join('<span class="editor-toolbar-group-separator"></span>');return`<span class="menu-icon mobile" title="Click to toggle toolbar menu">${Sn} Menu</span><section>${a}</section></details>`}const Xn=function(e,t){const n=jn(e);let a="";return t.headingNumbers&&(a+="heading-numbers"),`
        <div class="editor-container">
            <div class="editor-toolbar">
                ${n}
            </div>
            <div class="editor-main">
                <!-- Sidebar can go here --> 
                <div class="editor-body ${a}" contenteditable="true"></div>
            </div>
        </div>`},Qn=function(e){let t="",n="";return e.forEach((s,i)=>{const l=i==0?"active":"",o=i==0?"show":"",r=s.label.replaceAll(" ","-"),C=s.content?s.content:`You have no ${s.label} in your document.`;t+=`<li><a href="#" class="tab-menu ${l}" data-tab-target="tab-${i}" title="${s.label}">${s.icon}</a></li>`,n+=`
            <div class="tab-item ${r} ${o}" data-tab-id="tab-${i}">
                <header><h2>${s.label}</h2></header>
                ${C}
            </div>`}),`
            
            <div class="editor-sidebar-content">
                <header><h1>Explorer</h1></header>
                <ul class="tab-menu">${t}</ul>
                <div class="tab-content">${n}</div>
                <button class="close">Close explorer</button>
            </div>`},Zn=function(e,t){e!=!1&&(t===!1?e.innerHTML="<p>No range selected</p>":e.innerHTML=`
                <h5>Selection info:</h5>
                <div class="col">
                    <label>Block parent</label><span>${t.blockParent.tagName}</span>
                    <label>commonAncestorC</label><span>${t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent}</span>
                    <label>rootNode</label><span>${t.rootNode.tagName}</span>
                    <label>collapsed</label><span>${t.collapsed}</span>
                    <label>custom</label><span>${t.custom?t.custom.tagName:"false"}</span>
                </div>
                <div class="col">
                    <label>startC</label><span>${t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent}</span>
                    <label>startOffset</label><span>${t.startOffset}</span>
                    <label>endC</label><span>${t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent}</span>
                    <label>endOffset</label><span>${t.endOffset}</span>
                </div>`)},Jn=function(e="arte-download"){return`
        <form class="save">
            <p class="advice">Enter the filename without extension. The file will be saved in your <strong>Downloads</strong> folder with the extension <strong>arte</strong>.</>
            <div class="form-input">
                <input type="text" id="filename" title="filename" class="form-control" placeholder="Filename" required value="${e}"/>
            </div>
            <p class="feedback"></p>
        </form>`};class ea{constructor(t,n="",a,s){if(this.options=this.initOptions(s),this.toolbar=this.initToolbarArray(a),t.innerHTML=Xn(this.toolbar,this.options),this.id=x(),this.toolbarNode=t.querySelector(".editor-toolbar"),this.mainNode=t.querySelector(".editor-main"),this.editorNode=t.querySelector(".editor-body"),this.menuIcon=this.toolbarNode.querySelector(".menu-icon"),this.menuItems=this.toolbarNode.querySelector("section"),this.sidebarNode=null,this.debugTarget=!1,this.options.debug){const i=document.createElement("div");i.classList.add("editor-debug"),this.debugTarget=ut(i,this.mainNode)}this.listenForMouseUpEvents(),this.listenForKeydownEvents(),this.listenForKeyupEvents(),this.preview=()=>this.getCleanData(!0),this.update=this.updateEditor,this.filename="arte-download",this.modal=new h,setTimeout(()=>this.initEditor(n),100)}initOptions(t){return t?(t.headingNumbers=t.headingNumbers==null?!0:t.headingNumbers,t.bufferSize=t.bufferSize==null?10:Math.max(parseInt(t.bufferSize),10),t.debug=t.debug==null?!1:t.debug,t.defaultContent=t.defaultContent==null?"":t.defaultContent,t.explorer=t.explorer==null?!0:t.explorer):t={headingNumbers:!0,bufferSize:10,debug:!1,defaultContent:"",explorer:!0},t}async initEditor(t=""){if(t==""&&this.options.defaultContent!=""){const n=await fetch(this.options.defaultContent);n.status==200&&(t=await n.text())}this.editorNode.innerHTML=t,this.range=!1,this.initialiseButtons(),this.options.explorer&&this.toolbar.find(n=>n.sidebar!==void 0)&&this.showSidebar(),window.onhashchange=n=>{const a=document.getElementById(window.location.hash.substring(1));a!=null&&a.scrollIntoView({block:"center",behaviour:"smooth"})},setTimeout(()=>this.buffer(),100)}initToolbarArray(t){let n=[];return t.forEach((a,s)=>{a.forEach(i=>{i.group=s,On(i.type,i.tag),n.push(i)})}),n}setState(t){let n=!1;t.type!=="detached"&&(this.range===void 0||this.range===!1||this.range.custom)&&(n=!0,t.element.disabled=!0,t.element.classList.remove("active")),n==!1&&"setState"in t&&t.setState(this,t)}setStateForButtonType(t=""){this.toolbar.forEach(n=>{if(t==""||n.type==t){this.setState(n);return}})}initialiseButtons(){this.shortcuts=[],this.updateBuffer=!1,this.toolbar.forEach(t=>{t.element=this.toolbarNode.querySelector(`#${t.tag}`),t.tag==="UNDO"&&this.options.bufferSize>0&&(this.updateBuffer=t.update,t.init(this,t)),"init"in t&&t.tag!=="UNDO"&&t.tag!=="REDO"&&t.init(this,t),this.setState(t),"shortcut"in t&&(t.shortcut[0],t.shortcut[1],this.shortcuts.push({shortcut:t.shortcut[0],trigger:t.shortcut[1],button:t})),this.buttonClicked=!1,t.element.addEventListener("click",n=>{this.buttonClicked||(this.buttonClicked=!0,this.updateRange(),!this.modal.active()&&((t.type==="detached"||this.range!==!1)&&t.click(this,t),n.preventDefault(),this.buttonClicked=!1))})})}handleMenuClick(){this.menuItems.classList.toggle("show"),this.menuItems.classList.contains("show")&&this.range!==!1&&(this.range=Vn(this.range),this.setToolbarStates())}showSidebar(){if(this.mainNode.querySelector(".editor-sidebar")!=null){this.updateSidebar();return}let t=[];this.toolbar.forEach(s=>{s.sidebar&&t.push(s.sidebar(this))}),this.sidebarNode=document.createElement("DIV"),this.sidebarNode.classList.add("editor-sidebar"),this.sidebarNode.classList.add("dont-break-out"),this.sidebarNode.innerHTML=Qn(t);const a=this.sidebarNode.querySelector(".tab-menu").querySelectorAll("a");a.forEach(s=>s.addEventListener("click",i=>this.handleTabMenuClicks(i,a))),this.sidebarNode.querySelector("button.close").addEventListener("click",()=>this.hideSidebar()),this.mainNode.appendChild(this.sidebarNode)}hideSidebar(){this.sidebarNode.remove(),this.options.explorer=!1}updateSidebar(){if(this.mainNode.querySelector(".editor-sidebar")==null)return;let t=[];this.toolbar.forEach(n=>{n.sidebar&&t.push(n.sidebar(this))}),t.forEach((n,a)=>{const s=this.sidebarNode.querySelector(`[data-tab-id="tab-${a}"]`);n.content==""&&(n.content=`You have no ${n.label} in your document.`),s.innerHTML=n.content})}handleTabMenuClicks(t,n){t.preventDefault(),t.stopPropagation();const a=t.currentTarget,s=a.dataset.tabTarget;for(;s==null;)a=a.parentNode,s=a.dataset.tabTarget;n.forEach(l=>l.classList.remove("active")),this.sidebarNode.querySelectorAll(".tab-item").forEach(l=>l.classList.remove("show")),a.classList.add("active"),this.sidebarNode.querySelector(`[data-tab-id="${s}"]`).classList.add("show")}listenForMouseUpEvents(){document.addEventListener("mouseup",t=>{const n=document.activeElement,a=t.target;if(!this.modal.active())if(n==this.editorNode)this.handleMouseUp();else if(a==this.menuIcon)this.handleMenuClick();else{if(this.nodeInToolbar(a))return;this.resetRange()}})}resetRange(){this.range=!1,this.toolbar.forEach(t=>{this.setState(t)})}nodeInEditor(t){for(;t.nodeType==3||t.tagName!="BODY"||t.contentEditable!=!1;){if(t==this.editorNode)return!0;if(t.parentNode==null)return!1;t=t.parentNode}return!1}nodeInToolbar(t){for(;t.nodeType==3||t.tagName!="BODY";){if(t==this.toolbarNode)return!0;if(t.parentNode==null)return!1;t=t.parentNode}return!1}setToolbarStates(){if(this.range===!1){this.toolbar.forEach(t=>{t.element.classList.remove("active")});return}this.toolbar.forEach(t=>{this.setState(t)})}handleMouseUp(){this.updateRange(),this.range!==!1&&(this.editorNode.innerText==""&&this.insertParagraph(),this.highlightCustomNode(this.range.custom)),this.setToolbarStates()}insertParagraph(){let t=document.createElement("P");t.innerText=`
`,t=this.editorNode.appendChild(t),H(t,0),this.updateRange(),this.setToolbarStates(),this.buffer()}listenForKeydownEvents(){this.lastKey="",this.editorNode.addEventListener("keydown",t=>{let n=!1;if(this.modal.active()&&(t.preventDefault(),n=!0),!n&&t.key=="Enter"&&(this.handleEnter()&&t.preventDefault(),n=!0),!n&&(t.key=="Backspace"||t.key=="Delete"||t.ctrlKey&&t.key=="d")&&(this.handleDelete(t.key)&&t.preventDefault(),n=!0),n||this.shortcuts.forEach(a=>{this.lastKey===a.shortcut&&t.key===a.trigger&&(t.preventDefault(),t.stopPropagation(),a.button.click(this,a.button),n=!0)}),!n&&this.bufferUpdate!==!1&&(t.ctrlKey||t.metaKey)&&t.key=="z"){t.preventDefault();let a;t.shiftKey?a=this.toolbar.find(s=>s.tag=="REDO"):a=this.toolbar.find(s=>s.tag=="UNDO"),a.element.click(),n=!0}this.lastKey=t.key})}handleEnter(){if(this.updateRange(),this.range===!1)return;const t=this.range.endContainer.textContent.trim().length==this.range.endOffset;let n=!1;if(this.range.custom||t){const s=this.range.blockParent.innerHTML=="<br>",i=this.range.blockParent.tagName=="LI",l=s||!i?"P":this.range.blockParent.tagName;let o=document.createElement(l);o.innerText=`
`,o=ut(o,this.range.blockParent),H(o,0),n=!0,setTimeout(()=>{this.updateRange(),this.setStateForButtonType("block")},10)}const a=this.range.blockParent;return a.childNodes.forEach(s=>{s.contentEditable=="false"&&setTimeout(()=>{a.appendChild(s)},10)}),this.range.custom&&this.highlightCustomNode(!1),n}handleDelete(t){if(t=="d"&&(t="Delete"),this.range){const n=new h({type:"overlay",severity:"info",title:"Information",html:`
                    <p>You are attempting to delete one or more active elements, such as comments or links.</p>
                    <p>To delete active elements you need to edit them individually and choose Delete.</p>
                    `,escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if(t=="Backspace"&&this.range.startOffset==0){const a=this.range.blockParent.previousElementSibling;a.childNodes.forEach(s=>{s.contentEditable=="false"&&setTimeout(()=>{a.appendChild(s)},1)})}else if(t=="Delete"&&this.range.endContainer.textContent.trim().length==this.range.endOffset){const a=this.range.endContainer.nextElementSibling;if(a&&a.getAttribute("contenteditable")=="false")return n.show(),!0}}else{const a=document.getSelection();if(Ve(this.editorNode,a))return n.show(),!0}}return setTimeout(()=>this.updateRange(),10),!1}listenForKeyupEvents(){this.handleKeyup=Gn(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",t=>{["Shift","Meta","Ctrl"].includes(t.key)==!1&&this.modal.active()==!1&&this.handleKeyup(t.key,this)})}handleKeyupDelayed(...t){let n=t[0];const a=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"],s=t[1];s.updateRange(),a.includes(n)&&s.setToolbarStates(),s.buffer()}updateEventHandlers(){this.toolbar.forEach(t=>{"addEventHandlers"in t&&t.addEventHandlers(this)})}testModals(t){t=="overlay"?new h({type:"overlay",title:"Example feedback modal",html:`
                    <p>This is an example of an overlay modal.</p>
                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>
                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>`,severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show():t=="drawer"?new h({type:"drawer",title:"Example of an edit modal",html:`
                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>
                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>
                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>`,buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:()=>alert("delete")},confirm:{label:"Confirm",callback:()=>alert("confirm")}}}).show():t=="positioned"&&this.editorNode.addEventListener("click",()=>{this.updateRange();const n=new h({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:`
                        <div style="width:400px;padding:1rem;">
                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>
                            <p>The contents can be added as required.</p>
                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>
                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>
                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>
                        </div>`});n.show(),n.setPosition(this.range,this.editorNode)})}download(){this.modal.active()||(this.modal=new h({type:"drawer",title:"Save file",html:Jn(this.filename),escape:!0,buttons:{cancel:{label:"Cancel",callback:()=>this.modal.hide()},confirm:{label:"Save",callback:()=>this.save()}}}),this.modal.show())}save(){let t=document.querySelector("form.save #filename").value.trim().toLowerCase();if(t==""){document.querySelector("form.save .feedback").innerHTML="You must provide a filename. Click <strong>Cancel</strong> or press the <strong>Escape</strong> key to close this dialogue without saving.";return}t+=".arte";let n=this.getCleanData();const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),a.remove()}handleFileUpload(t){const n=t.files[0];if(!n||n.name.slice(-4).toLowerCase()!="arte")return;this.filename=n.name.slice(0,-5);const s=new FileReader;s.onload=i=>{const l=i.target.result;this.initEditor(l)},s.readAsText(n),t.remove()}upload(){let t=document.getElementById("arte-upload");t==null&&(t=document.createElement("input"),t.id="arte-upload",t.type="file",t.style.display="none",t.accept=".arte",t.addEventListener("change",()=>this.handleFileUpload(t),!1),document.body.appendChild(t)),t.click()}clear(){this.modal.active()||(this.modal=new h({type:"overlay",severity:"warning",title:"Start new document?",html:"<p>Are you sure you want to clear the editor and start a new document? Any changes will be lost.</p>",escape:!0,buttons:{cancel:{label:"Cancel",callback:()=>this.modal.hide()},confirm:{label:"Yes",callback:()=>{this.editorNode.innerHTML="",this.filename="arte-download",this.modal.hide(),setTimeout(()=>this.buffer(),100)}}}}),this.modal.show())}getCleanData(t=!1){let n=this.editorNode.cloneNode(!0);const a=this.toolbar.filter(s=>s.clean!=null);return wt(n,a),t?Fn(n):n.innerHTML}updateEditor(t){this.editorNode.innerHTML=t}updateRange(){this.modal.active()||(this.range=Kn(this.editorNode),this.options.debug&&Zn(this.debugTarget,this.range))}highlightCustomNode(t){this.editorNode.querySelectorAll("[contenteditable=false]").forEach(a=>{a.classList.remove("custom-selected")}),t&&t.classList.add("custom-selected")}buffer(){this.updateBuffer!==!1&&this.updateBuffer(this),this.updateSidebar(!1)}}class u{constructor(t,n,a,s,i,l){this.type=t,this.tag=n,this.label=a,this.input="button",this.icon=s,this.click=i,this.element=null,l!=null&&Object.keys(l).forEach(o=>{this[o]=l[o]})}}class ta{constructor(t){this.size=t,this.index=-1,this.buffer=[]}}let L=[];const na=function(e){e.buffer&&We(e.id);const t=L[e.id];t.index>0&&(t.index--,t.ignore=!0,console.warn(t.buffer[t.index]),e.editorNode.innerHTML=t.buffer[t.index]),M(e,be),M(e,ge),e.updateEventHandlers()},aa=function(e){e.buffer&&We(e.id);const t=L[e.id];t.index+1<t.buffer.length&&(t.index++,t.ignore=!0,e.editorNode.innerHTML=t.buffer[t.index]),M(e,be),M(e,ge),e.updateEventHandlers()},M=function(e,t){const n=L[e.id];t.tag=="UNDO"?t.element.disabled=n.buffer.length<=1||n.index<=0:t.element.disabled=n.index>=n.buffer.length-1},sa=function(e){e.buffer&&e.options.bufferSize>0&&(L[e.id]=new ta(e.options.bufferSize))},ia=function(e){if(L[e.id]===void 0)return;const t=L[e.id];if(!(t.buffer.length>0&&e.editorNode.innerHTML==t.buffer[t.buffer.length-1])){if(t.buffer.length>t.size&&t.buffer.shift(),t.index+1<t.buffer.length){const n=t.buffer.length-(t.index+1);for(let a=0;a<n;a++)t.buffer.pop()}t.buffer.push(e.editorNode.innerHTML),t.index=t.buffer.length-1,M(e,be),M(e,ge)}},oa=function(e){L[e]!==void 0&&(L[e].buffering=!0)},We=function(e){L[e]!==void 0&&(L[e].buffering=!1)},la=function(e){return L[e]!==void 0?L[e].buffering:!1},ra={init:sa,setState:M,update:ia,buffering:la,restart:oa,pause:We},ca={setState:M},be=new u("detached","UNDO","Undo",dn,na,ra),ge=new u("detached","REDO","Redo",un,aa,ca);let _e,T;function oe(e){return Ve(T.editorNode,e)?(new h({type:"overlay",severity:"info",title:"Information",html:`<p>Cut, copy and paste (of or over) selections with active elements, such as comments or links, is not supported.</p>
                   <p>Please modify your selection and try again.</p>`,escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0):!1}function ft(e){const t=document.getSelection();oe(t)&&e.preventDefault(),e.type=="cut"&&setTimeout(()=>T.buffer(),100)}function da(){const e=document.getSelection();oe(e)==!1&&(console.log("selection",e.toString()),navigator.clipboard.writeText(e.toString()),e.deleteFromDocument(),setTimeout(()=>T.buffer(),100))}function ua(){const e=document.getSelection();oe(e)==!1&&(console.log("selection",e.toString()),navigator.clipboard.writeText(e.toString()))}async function fa(){const e=document.getSelection();if(oe(e)==!1){const t=await navigator.clipboard.readText();console.log("pasted text is ",t);let n=document.createTextNode(t);n=Ye(T,n),setTimeout(()=>T.buffer(),100)}}function ha(e){const t=document.getSelection();if(oe(t)==!1){const n=(e.clipboardData||window.clipboardData).getData("text/html");if(_e&&n.includes("urn:schemas-microsoft-com:office")){console.log("Found word data");const a=(e.clipboardData||window.clipboardData).getData("text/plain");console.log(`text
`,a),e.preventDefault();let s=document.createTextNode(a);s=Ye(T,s)}setTimeout(()=>T.buffer(),100)}}const pa=function(e,t){T=e,navigator.clipboard&&(_e=!0,T.editorNode.addEventListener("cut",ft),T.editorNode.addEventListener("copy",ft),T.editorNode.addEventListener("paste",ha))},je=function(e,t){if(_e!==!1)switch(t.tag){case"CUT":da();break;case"COPY":ua();break;case"PASTE":fa();break}},Xe=async function(e,t){switch(console.log("set state for button",t.tag),t.tag){case"PASTE":if(document.activeElement==e.editorNode){const n=await navigator.clipboard.readText();t.element.disabled=n==""}else t.element.disabled=!0;break;case"CUT":case"COPY":e.range==!1||e.range.collapsed?t.element.disabled=!0:t.element.disabled=!1}if(t.element.disabled==!1){const n=document.getSelection();t.element.disabled=Ve(T.editorNode,n)}},ma=new u("detached","CUT","Cut (text only - use Ctr-V or Cmd-V to include formatting)",Tn,je,{init:pa,setState:Xe}),ba=new u("detached","COPY","Copy (text only - use Ctr-V or Cmd-V to include formatting)",Ln,je,{setState:Xe}),ga=new u("detached","PASTE","Paste (text only - use Ctr-V or Cmd-V to include formatting)",kn,je,{setState:Xe});let ue,te,f="";const Nt=function(e,t){ue=e.startContainer,te=e.endContainer,t&&(ue=se(ue),te=se(te)),f="pre"},Et=function(e){e==ue?(f="first",e==te&&(f="both")):e==te?f="last":f=="first"?f="during":f=="both"||f=="last"?f="post-first":f=="post-first"&&(f="post")},St=function(){return f=="pre"},Tt=function(){return f=="first"||f=="both"},ya=function(){return f=="both"},va=function(){return f=="last"},wa=function(){return f=="during"||f=="first"||f=="last"||f=="both"},Lt=function(){return f=="post-first"||f=="post"};let B,k=[],Y=!1,O;function Ca(e,t,n){const a=[...t.oldFormats,e.tagName];let s=[];return St()||Lt()?(s=[...a],{newFormats:s,oldFormats:a}):n.type==="block"?(s=[n.newFormat],{newFormats:s,oldFormats:a}):Tt()?(e.tagName=="LI"?e.parentNode.firstElementChild==e?(s.pop(),s.push(n.newFormat),s.push("LI")):(s=t.oldFormats.slice(),s.push(n.newFormat),s.push("LI")):(s.push(n.newFormat),s.push("LI")),{newFormats:s,oldFormats:a}):(s=k.slice(),{newFormats:s,oldFormats:a})}function $a(e){let t="";return e.childNodes.forEach(n=>{if(n.nodeType===3){let a=n.textContent;a.includes(`
`)&&(a=a.trim()),t+=a}else(vt(n)||R(n)||n.tagName==="BR")&&(t+=n.outerHTML)}),t}function Na(e,t){let n,a=O,s=$a(e),i=[];wa()?i=t.newFormats:i=t.oldFormats;let l=i.slice(-1)[0];if(e.nodeType,!(e.nodeType!==1||s==""&&e.innerHTML.includes("<"))){if(k.length==0)i.forEach(o=>{n=document.createElement(o),a=a.appendChild(n)});else if(i.length>k.length){if(An(k,i)){for(let o=0;o<k.length;o++)a=a.lastElementChild;for(let o=k.length;o<i.length;o++)n=document.createElement(i[o]),a=a.appendChild(n)}}else xn(i,k)&&(Y&&Y!=O&&(a=Y.parentNode),n=document.createElement(l),a=a.appendChild(n));if(a==O){let o=0;i.forEach((r,C)=>{r==k[C]&&(C==i.length-1&&r=="LI"||(a=a.lastElementChild,o++))});for(let r=o;r<i.length;r++)n=document.createElement(i[r]),a=a.appendChild(n)}Y=a,k=i.slice(),s!=""&&(a.innerHTML=s)}}function Ie(e,t,n){let a={oldFormats:[],newFormats:[]};e!=B&&(Et(e),a=Ca(e,t,n),Na(e,a)),e.childNodes.forEach(s=>{(P(s)||U(s))&&Ie(s,a,n)})}const Ea=function(e){e.action="apply",(e.tag=="CLEAR"||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,e.type=="block"&&e.action=="remove"&&(e.newFormat="P")},K=function(e,t){const n=e.range;B=e.editorNode,k=[],Y=!1,Ea(t);const a=Ae(n.rootNode,B),s=Ae(n.startContainer,B),i=Ae(n.endContainer,B);if(!(a===!1||s===!1||i===!1)){if(n.rootNode=a,Un(n),Nt(n,!0),s==i)O=document.createElement("DIV"),Ie(s,{oldFormats:[],newFormats:[]},t),s==B?s.innerHTML=O.innerHTML:s.outerHTML=O.innerHTML;else{let l=!1,o=!1;O=document.createElement("DIV"),n.rootNode.childNodes.forEach(r=>{r.nodeType===1&&(r==s&&(l=!0),l&&o==!1&&(t.type==="block"&&(k=[],Y=!1,O=document.createElement("DIV")),Ie(r,{oldFormats:[],newFormats:[]},t),t.type==="block"?r.outerHTML=O.innerHTML:r.setAttribute("data-remove",!0)),r==i&&(o=!0,t.type==="list"&&(r.outerHTML=O.innerHTML),B.querySelectorAll("[data-remove=true]").forEach(A=>A.remove())))})}$t(e.editorNode),e.updateRange(),e.setStateForButtonType("block"),e.buffer(),e.updateEventHandlers()}},ye=function(e,t){if(t.tag=="CLEAR")t.element.disabled=!1,t.element.classList.remove("active");else{let n=se(e.range.startContainer,e.editorNode);if(n===!1)return;t.element.disabled=n.tagName==="DIV"||R(n)||n.tagName==t.tag,t.type==="list"&&n.tagName==="LI"&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}},Sa=function(e){const t=e.editorNode.querySelectorAll("H1,H2,H3");let n="";return t.forEach(a=>{const s=a.tagName;a.id=x(),n+=`<${s}><a href="#${a.id}" title="Click to view heading in context">${a.innerHTML}</a></${s}>`}),{icon:En,label:"headings",content:`${n}`}};function Qe(e){return e.id&&e.removeAttribute("id"),e}const ve={setState:ye},Ta=new u("block","H1","Heading 1",Jt,K,{clean:Qe,sidebar:Sa,setState:ye}),La=new u("block","H2","Heading 2",en,K,{clean:Qe,setState:ye}),ka=new u("block","H3","Heading 3",tn,K,{clean:Qe,setState:ye}),xa=new u("block","P","Paragraph",nn,K,ve),Aa=new u("block","BLOCKQUOTE","Blockquote",an,K,ve),Oa=new u("list","OL","Ordered list",sn,K,ve),Da=new u("list","UL","Unordered list",on,K,ve);function Ha(e,t){let n="",a="",s="";return ya()?(a=e.textContent.substring(0,t.startOffset),n=W+e.textContent.substring(t.startOffset,t.endOffset)+ie,s=e.textContent.substring(t.endOffset)):Tt()?(a=e.textContent.substring(0,t.startOffset),n=W+e.textContent.substring(t.startOffset)):va()?(n=e.textContent.substring(0,t.endOffset)+ie,s=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:a,text:n,postText:s}}function qa(e,t){let n=-1;return e.forEach((a,s)=>{a==t&&(n=s)}),n}function de(e,t,n){if(e.length==0)return t;let a=[],s=[];for(let o=0;o<e.length;o++){const r=e[o].split(":");a.push(r[0].trim()),s.push(r[1].trim())}for(let o=0;o<a.length;o++)for(let r=0;r<a.length;r++)a[o]==a[r]&&o>r&&(a[r]="");let i="";for(let o=0;o<a.length;o++)a[o]!=""&&(i+=`${a[o]}:${s[o]};`);let l=`<span style="${i}">${t}`;return n&&(l+="</span>"),l}function Ra(e,t,n,a){Et(e);const{preText:s,text:i,postText:l}=Ha(e,a);let o="";if(St()||Lt())o+=de(t,i,!0);else{const r=`${n.newStyle}:${n.newValue}`,C=qa(t,r);let A=!0;if(s&&(t.length==0?o+=s:(A=!0,n.action=="apply"&&(C>-1||l!="")&&(A=!1),o+=de(t,s,A))),i)if(n.action=="apply")if(C>-1&&A==!1)o+=i;else{let xe=[];A?xe=[...t,r]:xe=[r],o+=de(xe,i,!0)}else(n.action=="remove"||n.action=="clear")&&(o+=i);l&&(t.length==0?o+=l:A?o+=de(t,l,!0):(o+=l,t.forEach(()=>o+="</span>")))}return o}function Ia(e,t,n,a){if(e.tagName==="SPAN"){const i=e.getAttribute("style");i!=null&&i!=""&&i.split(";").forEach(o=>{if(o!=""){const r=o.split(":");t.includes(r[0].trim())==!1&&(t=[...t,o])}})}let s="";return e.childNodes.forEach(i=>{s+=kt(i,t,n,a)}),s}const we=function(e,t){t.tag=="CLEAR"&&t.element.classList.remove("active"),t.element.disabled=e.range.collapsed||e.range.rootNode==e.rootNode||U(e.range.rootNode),xt(t),In(e.range.startContainer).includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")},kt=function(e,t,n,a){return e.nodeType===3?Ra(e,t,n,a):R(e)?e.outerHTML:Ia(e,t,n,a)},xt=function(e){const t=e.style.split(":");e.newStyle=t[0],e.newValue=t[1]!==void 0?t[1]:"",e.action="apply",e.element.classList.contains("active")&&e.style!="CLEAR"?e.action="remove":e.style=="CLEAR"&&(e.action="clear")},le=function(e,t){const n=e.range;if(P(n.rootNode)==!1){const s=se(n.rootNode);if(s===!1)return;n.rootNode=s}xt(t),Nt(n,!1);const a=kt(n.rootNode,[],t,n);Hn(n.rootNode,n.rootNode.tagName,a),$t(e.editorNode),e.updateRange(),t.setState(e,t),e.buffer(),e.updateEventHandlers()};let V={setState:we,style:"font-weight:bold"};const Ma=new u("style","B","Bold",ln,le,V);V={setState:we,style:"font-style:italic"};const Pa=new u("style","I","Italic",rn,le,V);V={setState:we,style:"text-decoration:underline"};const Ba=new u("style","U","Underline",cn,le,V);V={setState:we,style:"CLEAR"};const Fa=new u("style","CLEAR","Clear",ht,le,V);let q,At=[],D,ne,ae,w=0,F=null;function Ot(e){let t="";return At.forEach(n=>{const a=n.toLowerCase();(e!=""?a.includes(e):!0)&&(t+=`<li>${n}</li>`)}),t}function fe(e=!0){w>=0&&D.length>0&&(D.forEach(t=>t.classList.remove("selected")),D[w].classList.add("selected"),e&&D[w].scrollIntoView({block:"end",inline:"nearest"}))}function Ua(){return`<div class="mentions">
                <input type="text"/>
                <ul>${Ot("")}</ul>
            </div>`}function Ka(e){const t=e.key,n=e.shiftKey;let a=!1;if(e.preventDefault(),e.stopPropagation(),D.length==0?w=-1:t=="ArrowDown"||t=="ArrowRight"||t=="Tab"&&n==!1?(e.preventDefault(),w<D.length-1?w++:w=0,a=!0,fe()):(t=="ArrowUp"||t=="ArrowLeft"||t=="Tab"&&n)&&(e.preventDefault(),w==0?w=D.length-1:w--,a=!0,fe()),a==!1)if(t!="Enter")ne.innerHTML=Ot(ae.value.toLowerCase()),D=ne.querySelectorAll("li"),w=0,fe();else{const s=w!=-1?D[w].textContent:ae.value;Ze(s)}}function Va(e){Ze(e.target.textContent)}function Ze(e){let t=q.range.startContainer.textContent,n=q.range.startOffset,a=t.substring(0,n),s=t.substring(n);s.charAt(0)==="@"&&(s=s.slice(1,s.length)),e!=""&&(t.charCodeAt(n-1)!==32&&(e=" "+e),n<t.length&&t.charCodeAt(n)!==32&&(s!=""&&(s=s+" "),e=e+" ")),q.range.startContainer.textContent=a+e+s,n+=e.length,q.range=H(q.range.startContainer,n),F.hide(),q.buffer()}const Ya=function(){Ze("")};function za(e,t){e.range!==!1&&(q=e,F=new h({type:"positioned",escape:Ya,html:Ua()}),F.show(),F.setPosition(q.range,q.editorNode),F.container.addEventListener("keyup",Ka),ne=F.container.querySelector("ul"),ne.addEventListener("click",Va),D=ne.querySelectorAll("li"),w=0,fe(!1),ae=F.container.querySelector("input"),ae.value="",ae.focus())}const Ga=function(e,t){t.element.disabled=e.range.collapsed==!1||e.range.custom!==!1},Wa=function(e){At=e.sort()},_a={setState:Ga,shortcut:["@","@"]},ja=new u("custom","MENTION","Mention",fn,za,_a),_="ARTE-LINK";let m,re,p,Me,y=null,Ce=null;function Xa(){Ce.hide(),y.hide()}function Qa(){Me?Ce=pe(Xa):y.hide()}function Za(){p.remove(),m.range=!1,Je(m,re),m.buffer()}function Ja(){Ce.hide(),y.hide(),Za()}function es(){Ce=me("link",Ja)}function Dt(e){y&&y.active()||(p=e,Ht("",!0))}function Ht(e,t){let n="Create link",a={cancel:{label:"Cancel",callback:Qa},confirm:{label:"Save",callback:ts}};t?(n="Edit link",a.delete={label:"Delete",callback:es}):(p=document.createElement(_),p.id=x(),p.setAttribute("contenteditable","false"),p.dataset.href="",p.dataset.label=e,p.dataset.display=0),y=new h({type:"drawer",title:n,html:as(t),buttons:a}),y.show(),Me=!1,y.panel.querySelectorAll("form input").forEach(l=>l.addEventListener("change",()=>Me=!0));const i=y.panel.querySelector("form #href");i.focus(),i.setSelectionRange(i.value.length,i.value.length)}function ts(){p.parentNode==null&&(p=Ye(m,p)),p.dataset.href=y.panel.querySelector("form #href").value.trim(),p.dataset.label=y.panel.querySelector("form #label").value.trim(),p.dataset.display=parseInt(y.panel.querySelector("form #display").value),y.hide(),qt(p),m.range=H(p,0),Je(m,re),m.buffer()}function ns(e){switch(parseInt(e.dataset.display)){case 0:if(e.dataset.label!="")return e.dataset.label;break;case 1:return e.dataset.href;case 2:if(e.dataset.label!=""&&e.dataset.label!=e.dataset.href)return`${e.dataset.label} (${e.dataset.href})`}return e.dataset.href}function qt(e){e.id==!1&&(e.id=x()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerHTML="";const t=document.createElement("a");t.href=e.dataset.href,t.innerText=ns(e),e.appendChild(t),t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),Dt(e)})}function as(e){let t="",n=p.dataset.display?p.dataset.display:0;return e&&(t=`(<a href="${p.dataset.href}" class="link" target="_blank" title="Open link in new tab or window">${mn} Open</a>)`),`
        <form class="arte-link">
            <div class="form-input">
                <label for="href">URL ${t}</label>
                <input id="href" type="text" class="form-control" placeholder="URL" required value="${p.dataset.href}">
            </div>
            <div class="form-input">
                <label for="label">Label (optional)</label>
                <input id="label" type="text" class="form-control" placeholder="Label" value="${p.dataset.label}">
            </div>
            <div class="form-input">
                <label for="label">Display option</label>
                <select class="form-control" id="display">
                    <option value="0" ${n==0?"selected":""}>Label only</option>
                    <option value="1" ${n==1?"selected":""}>Link only</option>
                    <option value="2" ${n==2?"selected":""}>Label and link</option>
                </select>
            </div>
        </form>`}const ss=function(e,t){m=e,re=t,m.editorNode.querySelectorAll(_).forEach(a=>qt(a))},is=function(e,t){if(y&&y.active()||(m=e,re=t,m.range===!1))return;let n="";m.range.collapsed==!1&&m.range.startContainer==m.range.endContainer&&(n=m.range.endContainer.textContent.substring(m.range.startOffset,m.range.endOffset)),Ht(n,!1)},os=function(e){m=e,re=Rt,m.editorNode.querySelectorAll(_).forEach(n=>n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),Dt(n)}))},ls=function(e){return e.removeAttribute("contenteditable"),e.removeAttribute("title"),e.innerHTML="",e},Je=function(e,t){e.range===!1||e.range.rootNode==e.editorNode||U(e.range.rootNode)?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,e.range.blockParent.querySelector(_)!=null?t.element.classList.add("active"):t.element.classList.remove("active"))},rs=function(e){const t=e.editorNode.querySelectorAll(_);let n="";return t.forEach(a=>{n+=`
            <article>
                <a href="#${a.id}" title="Click to view link in context">
                    ${a.dataset.label} (${a.dataset.href})
                </a>
            </article>`}),{icon:pt,label:"links",content:`${n}`}},cs={init:ss,setState:Je,addEventHandlers:os,clean:ls,sidebar:rs},Rt=new u("custom",_,"Link",pt,is,cs),j="ARTE-IMAGE";let $,ce,b,Pe,v=null,$e=null;function ds(){$e.hide(),v.hide()}function us(){Pe?$e=pe(ds):v.hide()}function fs(){b.remove(),$.range=!1,et($,ce),$.buffer()}function hs(){$e.hide(),v.hide(),fs()}function ps(){$e=me("image",hs)}function It(e){v&&v.active()||(b=e,Mt(!0))}function Mt(e){let t="Insert image",n={cancel:{label:"Cancel",callback:us},confirm:{label:"Save",callback:()=>ms(e)}};e?(t="Edit image",n.delete={label:"Delete",callback:ps}):(b=document.createElement(j),b.id=x(),b.setAttribute("contenteditable","false"),b.dataset.src="",b.dataset.alt="",b.dataset.caption=""),v=new h({type:"drawer",title:t,html:bs(),buttons:n,escape:!0}),v.show(),Pe=!1,v.panel.querySelectorAll("form input").forEach(i=>i.addEventListener("change",()=>Pe=!0));const s=v.panel.querySelector("form #src");s.focus(),s.setSelectionRange(s.value.length,s.value.length)}function ms(e=!1){b.dataset.src=v.panel.querySelector("form #src").value.trim(),b.dataset.caption=v.panel.querySelector("form #caption").value.trim(),b.dataset.alt=v.panel.querySelector("form #alt").value.trim(),e==!1&&$.range.blockParent.appendChild(b),v.hide(),Pt(b),$.range=H(b,0),et($,ce),$.buffer()}function Pt(e){e.id==!1&&(e.id=x()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerHTML="";const t=document.createElement("img");if(t.src=e.dataset.src,t.alt=e.dataset.alt,e.appendChild(t),e.dataset.caption!=""){const n=document.createElement("span");n.classList.add("caption"),n.innerText=e.dataset.caption,e.appendChild(n)}e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),It(e)})}function bs(e){return`
        <form class="arte-image">
            <p class="advice">Please enter a URL and optional caption for an image file:
            <div class="form-input">
                <label for="src">URL</label>
                <input id="src" type="text" class="form-control" placeholder="Source URL" required value="${b.dataset.src}">
            </div>
            <div class="form-input">
                <label for="caption">Caption</label>
                <input id="caption" type="text" class="form-control" placeholder="Caption for image" value="${b.dataset.caption}">
            </div>
            <div class="form-input">
                <label for="alt">Alt text</label>
                <input id="alt" type="text" class="form-control" placeholder="Alt text for image" value="${b.dataset.alt}">
            </div>
        </form>`}const gs=function(e,t){$=e,ce=t,$.editorNode.querySelectorAll(j).forEach(a=>Pt(a))},ys=function(e,t){v&&v.active()||($=e,ce=t,$.range!==!1&&Mt(!1))},vs=function(e){$=e,ce=Bt,$.editorNode.querySelectorAll(j).forEach(n=>n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),It(n)}))},ws=function(e){return console.warn("clean image",e),e.removeAttribute("contenteditable"),e.removeAttribute("title"),e.innerHTML="",e},et=function(e,t){e.range===!1||e.range.rootNode==e.editorNode||U(e.range.rootNode)?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,e.range.blockParent.querySelector(j)!=null?t.element.classList.add("active"):t.element.classList.remove("active"))},Cs=function(e){const t=e.editorNode.querySelectorAll(j);let n="";return t.forEach(a=>{const s=a.querySelector("img");n+=`
            <a href="#${a.id}">
                <img src="${s.src}" alt="${s.alt}" title="Click to view image in document"/>
            </a>`}),{icon:mt,label:"images",content:`${n}`}},$s={init:gs,setState:et,addEventHandlers:vs,clean:ws,sidebar:Cs},Bt=new u("custom",j,"Image",mt,ys,$s),Be=["black","white","violet","indigo","blue","green","yellow","orange","red"];let z=null;function Ns(){let e="";for(let t=0;t<Be.length;t++)e+=`<span class="colour" data-index="${t}" style="background-color:${Be[t]}">&nbsp;</span>`;return`
        <form id="colour-menu">
            <div class="colours">
                ${e}
            </div>
        </form>`}function Es(e,t){let n="Select highlight colour";t.tag=="ARTE-COLOR"&&(n="Select text colour"),z=new h({type:"drawer",title:n,html:Ns(),escape:!0,buttons:{cancel:{label:"Cancel"}}}),z.show(),z.panel.querySelectorAll("span.colour").forEach(s=>s.addEventListener("click",i=>{const l=Be[i.target.dataset.index],o={setState:tt,style:`${t.style}:${l}`,element:t.element};z.hide(),le(e,o)}))}const Ft=function(e,t){if(!(z&&z.active())){if(e.range===!1||e.range.collapsed){new h({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show();return}Es(e,t)}},tt=function(e,t){t.element.disabled=e.range===!1||e.range.collapsed||e.range.rootNode==e.editorNode||U(e.range.rootNode);let n="",a=[];const s=e.range.startContainer.parentNode.getAttribute("style");s!=null&&(a=s.split(";"),a.forEach(i=>{if(i!==""){const l=i.split(":");l[0].trim()===t.style&&(n=l[1].trim(),t.element.querySelector("span.bar").setAttribute("style",`background-color:${n};`))}})),n==""&&t.element.querySelector("span.bar").removeAttribute("style")},Ut=function(e,t){const n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")};let nt={init:Ut,setState:tt,style:"color"};const Ss=new u("inline","ARTE-COLOR","Text colour",hn,Ft,nt);nt={init:Ut,setState:tt,style:"background-color"};const Ts=new u("inline","ARTE-BACKGROUND-COLOR","Highlight colour",pn,Ft,nt),X="ARTE-ACTION";let E,Q,c,Fe,g=null,Ne=null;function at(e){g&&g.active()||(c=e,Kt(!0))}function Ls(){Ne.hide(),g.hide()}function ks(){Ne.hide(),g.hide(),Hs()}function xs(){Fe?Ne=pe(Ls):g.hide()}function As(){Ne=me("action",ks)}function Kt(e){let t="Add action",n={cancel:{label:"Cancel",callback:xs},confirm:{label:"Save",callback:Os}};e?(t="Edit action",n.delete={label:"Delete",callback:As}):(c=document.createElement(X),c.id=x(),c.setAttribute("contenteditable","false"),c.dataset.status="0",c.dataset.todo="",c.dataset.owners="",c.dataset.due="",c.dataset.created="",c.dataset.updated="",c.dataset.notes=""),g=new h({type:"drawer",title:t,html:Ps(),buttons:n}),g.show(),Fe=!1,g.panel.querySelectorAll("form input, form textarea, form select").forEach(i=>i.addEventListener("change",()=>Fe=!0));const s=g.panel.querySelector("#todo");s.focus(),s.setSelectionRange(s.value.length,s.value.length)}function Os(){c.dataset.todo=g.panel.querySelector("#todo").value.trim(),c.dataset.owners=g.panel.querySelector("#owners").value.trim(),c.dataset.due=g.panel.querySelector("#due").value.trim(),c.dataset.status=parseInt(g.panel.querySelector("#status").value.trim()),c.dataset.notes=g.panel.querySelector("#notes").value.trim();const t=new Date().toLocaleString().slice(0,-3);c.dataset.created==""&&(c.dataset.created=t,Ds()),c.dataset.updated=t,g.hide(),Vt(c),E.range=H(c,0),Ee(E,Q),E.buffer()}function Ds(){c=E.range.startContainer.parentNode.appendChild(c)}function Hs(){c.remove(),E.range=!1,Ee(E,Q),E.buffer()}function qs(e){return e.removeAttribute("contenteditable"),e.innerHTML="",e}function Vt(e){e.id,e.id==!1&&(e.id=x()),e.setAttribute("contenteditable",!1),e.innerHTML=Ms(e),e.querySelector("button").addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),at(e)}),e.addEventListener("click",()=>{Ee(E,Q)})}function Rs(e){E=e,Q=Yt,E.editorNode.querySelectorAll(X+" button").forEach(n=>n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();const s=n.parentNode;at(s)}))}function Is(e){switch(parseInt(e)){case 0:return"status-open";case 1:return"status-closed-incomplete";case 2:return"status-closed-complete"}return"status-unknown"}function Ms(e){const t=Is(e.dataset.status),n=e.dataset.due==""?"":`
        <label>Due:</label>
        <span class="due">${e.dataset.due}</span>`;return`
        <button type="button" title="Edit this action">
            <label class="${t}">${Ke}</label>
            <span class="todo">${e.dataset.todo}</span>
            <label>Owners:</label>
            <span class="owners">${e.dataset.owners}</span>
            ${n}
        </button>`}function Ps(){return`
        <form class="comment">
            <div class="form-input">
                <label for="todo">What needs to be done</label>
                <textarea id="todo" class="form-control" required>${c.dataset.todo}</textarea>
            </div>
            <div class="form-input">
                <label for="owners">Owners</label>
                <input type="text" id="owners" class="form-control" value="${c.dataset.owners}" required />
            </div>
            <div class="form-input">
                <label for="due">Due by</label>
                <input type="text" id="due" class="form-control" value="${c.dataset.due}"/>
            </div>
            <div class="form-input">
                <label for="status">Status</label>
                <select id="status" class="form-control">
                    <option value="0" ${c.dataset.status==0?"selected":""}>Open</option>
                    <option value="1" ${c.dataset.status==1?"selected":""}>Closed - Incomplete</option>
                    <option value="2" ${c.dataset.status==2?"selected":""}>Closed - Complete</option>
                </select>
            </div>
            <div class="form-input">
                <label for="notes">Notes</label>
                <textarea id="notes" class="form-control">${c.dataset.notes}</textarea>
            </div>
        </form>`}const Bs=function(e,t){E=e,Q=t,e.editorNode.querySelectorAll(t.tag).forEach(a=>Vt(a))},Ee=function(e,t){e.range===!1||e.range.rootNode==e.editorNode||P(e.range.rootNode)==!1?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,e.range.blockParent.querySelector(X)!=null?t.element.classList.add("active"):t.element.classList.remove("active"))},Fs=function(e,t){if(g&&g.active())return;E=e,Q=t;const n=E.range.blockParent.querySelector(X);n!=null?at(n):Kt(!1)},Us=function(e){const t=e.editorNode.querySelectorAll(X);let n="";return t.forEach(a=>{const s=a.querySelector(".todo").innerHTML.trim(),i=a.querySelector(".owners").innerHTML.trim(),l=a.querySelector(".due");let o="";l!=null&&(o+=`,<br/>Due: ${l.innerText.trim()}`),n+=`
            <article class="action">
                <a href="#${a.id}">${s}</a>
                <p>Owned by: ${i}${o}</p>
            </article>`}),{icon:Ke,label:"actions",content:`${n}`}},Ks={setState:Ee,init:Bs,addEventHandlers:Rs,clean:qs,sidebar:Us},Yt=new u("custom",X,"Action",Ke,Fs,Ks),Z="ARTE-COMMENT";let S,J,d,Ue,N=null,Se=null;function st(e){N&&N.active()||(d=e,zt(!0))}function Vs(){Se.hide(),N.hide()}function Ys(){Se.hide(),N.hide(),Xs()}function zs(){Ue?Se=pe(Vs):N.hide()}function Gs(){Se=me("comment",Ys)}function Ws(e){d.dataset.resolved=="false"?(d.dataset.resolved="true",resolve.innerHTML=yt+" Unresolve"):d.dataset.resolved="false",e.target.innerHTML=Wt()}function zt(e){let t="Add comment",n={cancel:{label:"Cancel",callback:zs},confirm:{label:"Save",callback:_s}};e?(t="Edit comment",n.delete={label:"Delete",callback:Gs}):(d=document.createElement(Z),d.id=x(),d.setAttribute("contenteditable","false"),d.dataset.comment="",d.dataset.created="",d.dataset.updated="",d.dataset.resolved="false"),N=new h({type:"drawer",title:t,html:Js(),buttons:n}),N.show(),Ue=!1;const a=N.panel.querySelector("form textarea#comment");a.addEventListener("change",()=>Ue=!0);const s=N.panel.querySelector("form button#resolve");s!=null&&s.addEventListener("click",Ws),a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function _s(){d.dataset.comment=N.panel.querySelector("form #comment").value.trim();const t=new Date().toLocaleString().slice(0,-3);console.log("local timestamp",t),d.dataset.created==""&&(d.dataset.created=t,js()),d.dataset.updated=t,N.hide(),Gt(d),S.range=H(d,0),Te(S,J),S.buffer()}function js(){d=S.range.startContainer.parentNode.appendChild(d)}function Xs(){d.remove(),S.range=!1,Te(S,J),S.buffer()}function Qs(e){return e.removeAttribute("contenteditable"),e.innerHTML="",e}function Gt(e){e.id,e.id==!1&&(e.id=x()),e.innerHTML="",e.setAttribute("contenteditable",!1);const t=document.createElement("button");t.type="button",t.title="Edit this comment",t.innerHTML=gt,t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),st(e)}),e.appendChild(t),e.addEventListener("click",()=>{Te(S,J)})}function Zs(e){S=e,J=_t,S.editorNode.querySelectorAll(Z+" button").forEach(n=>n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();const s=n.parentNode;st(s)}))}function Wt(){return d.dataset.resolved=="true"?yt+" Unresolve":wn+" Resolve"}function Js(){let e="";d.dataset.created!=""&&(e=`<span><label>Created</label> ${d.dataset.created}</span>`),d.dataset.updated!=""&&(e+=`<span><label>Updated</label> ${d.dataset.updated}</span>`);let t="";return e!=""&&(e=`<div class="timestamps">${e}</div>`,t=`<button type="button" id="resolve">${Wt()}</button>`),`
        <form class="comment">
            <div class="form-input">
                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>${d.dataset.comment}</textarea>
            </div>
            ${e}
            ${t}
        </form>`}const ei=function(e,t){S=e,J=t,e.editorNode.querySelectorAll(t.tag).forEach(a=>Gt(a))},Te=function(e,t){e.range===!1||e.range.rootNode==e.editorNode||P(e.range.rootNode)==!1?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,e.range.blockParent.querySelector(Z)!=null?t.element.classList.add("active"):t.element.classList.remove("active"))},ti=function(e,t){if(N&&N.active())return;S=e,J=t;const n=S.range.blockParent.querySelector(Z);n!=null?st(n):zt(!1)},ni=function(e){const t=e.editorNode.querySelectorAll(Z);let n="";return t.forEach(a=>{const s=a.dataset.resolved=="true"?"comment-resolved":"comment-unresolved";n+=`
            <article>
                <a href="#${a.id}" title="Click to view comment in context">
                    <span class="comment-bubble ${s}">${gt}</span> ${a.dataset.comment}
                </a>
                <p class="sub-title">Added: ${a.dataset.created}</p>
            </article>`}),{icon:bt,label:"comments",content:`${n}`}},ai={setState:Te,init:ei,addEventHandlers:Zs,clean:Qs,sidebar:ni},_t=new u("custom",Z,"Custom",bt,ti,ai),si="SETTINGS";let G=null;function jt(e){localStorage.setItem("headingNumbers",e.options.headingNumbers),e.options.headingNumbers?e.editorNode.classList.add("heading-numbers"):e.editorNode.classList.remove("heading-numbers")}function Xt(e){localStorage.setItem("theme",e),document.documentElement.className=e}function ii(e){localStorage.setItem("explorer",e.options.explorer),e.options.explorer?e.showSidebar():e.hideSidebar()}function oi(){G.hide()}function li(e){G=new h({type:"drawer",escape:!0,title:"Options",html:ri(e.options),buttons:{cancel:{label:"Close",callback:oi}}}),G.show(),G.panel.querySelectorAll("form input").forEach(n=>n.addEventListener("change",a=>{a.target.name=="headingNumbers"?(e.options.headingNumbers=a.target.id=="on",jt(e)):a.target.name=="theme"?(e.options.theme=a.target.id,Xt(e.options.theme)):a.target.name=="explorer"&&(e.options.explorer=a.target.id=="show-explorer",ii(e))}))}function ri(e){return`
        <form>
            <div class="form-input options">
                <label>Heading numbers</label>
                <label>
                    <input name="headingNumbers" id="on" type="radio" class="form-control first" ${e.headingNumbers?"checked":""}/> On
                </label>
                <label>
                    <input name="headingNumbers" id="off" type="radio" class="form-control" ${e.headingNumbers?"":"checked"}/> Off
                </label>
            </div>
            <div class="form-input options">
                <label>Theme</label>
                <label>
                    <input name="theme" id="theme-light" type="radio" class="form-control first" ${e.theme=="theme-light"?"checked":""}/> Light
                </label>
                <label>
                    <input name="theme" id="theme-dark" type="radio" class="form-control" ${e.theme=="theme-dark"?"checked":""}/> Dark
                </label>
            </div>
            <div class="form-input options">
                <label>Explorer</label>
                <label>
                    <input name="explorer" id="show-explorer" type="radio" class="form-control first" ${e.explorer?"checked":""}/> Show
                </label>
                <label>
                    <input name="explorer" id="hide-explorer" type="radio" class="form-control" ${e.explorer==!1?"checked":""}/> Hide
                </label>
            </div>
        </form>`}const ci=function(e,t){t.element.disabled=!1},di=function(e,t){G&&G.active()||li(e)},ui=function(e,t){const n=localStorage.getItem("theme");n&&(e.options.theme=n),Xt(e.options.theme);const a=localStorage.getItem("headingNumbers");localStorage.getItem("headingNumbers")&&(e.options.headingNumbers=a),jt(e)},fi={setState:ci,init:ui},hi=new u("detached",si,"Preferences",vn,di,fi),pi=document.getElementById("editor"),mi=[[Ta,La,ka,xa,Aa],[Oa,Da],[Ma,Pa,Ba,Ss,Ts,Fa],[be,ge],[ma,ba,ga],[ja,Rt,Bt,_t,Yt],[hi]];Wa(["David","William","Jenny","Sally","Sarah","Susan","Brian"]);const bi={headingNumbers:!0,theme:"theme-light",bufferSize:10,explorer:!0,debug:!0,defaultContent:"sample.arte"},Le=new ea(pi,"",mi,bi),ke=document.getElementById("index-buttons"),it=document.createElement("button");it.innerHTML=`${ht} New`;it.addEventListener("click",()=>Le.clear());ke.appendChild(it);const ot=document.createElement("button");ot.innerHTML=`${Nn} Open`;ot.addEventListener("click",()=>Le.upload());ke.appendChild(ot);const lt=document.createElement("button");lt.innerHTML=`${Cn} Preview`;lt.addEventListener("click",()=>{let e=Le.preview();new h({type:"full-screen",title:"Cleaned XML to be saved",html:`<textarea style="height:100%;width:100%;padding:2rem;" readonly>${e}</textarea>`,buttons:{cancel:{label:"Close"}},escape:!0}).show()});ke.appendChild(lt);const rt=document.createElement("button");rt.innerHTML=`${$n} Save`;rt.addEventListener("click",()=>Le.download());ke.appendChild(rt);
