!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ARTE",[],t):"object"==typeof exports?exports.ARTE=t():e.ARTE=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Blocks:()=>o,Buffer:()=>n,Colours:()=>l,Comments:()=>c,Custom:()=>s,Editor:()=>B,Links:()=>i,Mentions:()=>r,Modal:()=>U,Styles:()=>a});var n={};e.r(n),e.d(n,{REDO:()=>R,UNDO:()=>P,ignore:()=>M,update:()=>D});var o={};e.r(o),e.d(o,{BQ:()=>se,H1:()=>ae,H2:()=>re,H3:()=>ie,OL:()=>ce,P:()=>le,UL:()=>de});var a={};e.r(a),e.d(a,{B:()=>ye,CLEAR:()=>we,I:()=>ve,U:()=>Ce,click:()=>me});var r={};e.r(r),e.d(r,{BUTTON:()=>Me,setup:()=>De});var i={};e.r(i),e.d(i,{BUTTON:()=>Ze});var l={};e.r(l),e.d(l,{BACKGROUND:()=>mt,FOREGROUND:()=>bt});var s={};e.r(s),e.d(s,{BUTTON:()=>Dt});var c={};e.r(c),e.d(c,{BUTTON:()=>Xt});let d={block:["DIV","P","LI"],list:["LI"],custom:[]};const u=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},p=function(e){return null!=e.tagName&&"SPAN"===e.tagName},f=function(e){return void 0!==e.tagName&&("OL"===e.tagName||"UL"===e.tagName)},h=function(e){return null!=e.tagName&&d.block.includes(e.tagName)},b=function(e){const t=e.blockParent.firstElementChild;return!(null==t||!m(t))&&t},m=function(e){return null!=e.tagName&&d.custom.includes(e.tagName)},g=function(e){for(;0==h(e);)e=e.parentNode;return e},y=function(e,t){let n=e;for(;e!=t;)n=e,e=e.parentNode;return n},v=function(e,t){if(3!==e.nodeType)if(1===e.nodeType)if(!1!==h(e)||!1!==f(e)||!1!==p(e)||!1!==m(e))if(t.length>0&&m(e)){const n=t.find((t=>t.tag.toUpperCase()===e.tagName));if(n&&"clean"in n){const t=n.clean(e);e.parentNode.replaceChild(t,e)}}else e.childNodes.forEach((e=>{v(e,t)}));else e.remove();else e.remove();else e.textContent.includes("\n")&&(e.textContent=e.textContent.trim())},C="§§",w="±±";let E=null,k=0,N=null,L=0;function S(e){return e.blockParent=g(e.commonAncestorContainer),e.rootNode=e.commonAncestorContainer,3===e.commonAncestorContainer.nodeType&&(e.rootNode=e.commonAncestorContainer.parentNode),e}const x=function(){if(null===document.querySelector(".show")){let e=window.getSelection();if(1==e.rangeCount){let t=e.getRangeAt(0);return t=S(t),t}}return!1},T=function(e,t){let n=document.createRange();const o=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),o.removeAllRanges(),o.addRange(n),n=S(n),n};function A(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType){if(A(o,t))return!0}else if(3===o.nodeType){const e=o.textContent.indexOf(t);if(-1!=e)return o.textContent=o.textContent.replace(t,""),t==C?(E=o,k=e):(N=o,L=e),!0}}return!1}const $=function(e){if(A(e,C)&&function(e){return A(e,w)}(e)){const e=document.createRange(),t=window.getSelection();return e.setStart(E,k),E==N&&k==L?e.collapse(!0):e.setEnd(N,L),t.removeAllRanges(),t.addRange(e),e}return!1},q=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)};const O=class{constructor(e,t,n,o,a,r){this.type=e,this.tag=t,this.label=n,this.input="button",this.icon=o,this.click=a,this.element=null,null!=r&&Object.keys(r).forEach((e=>{this[e]=r[e]}))}},H=function(e,t){"UNDO"==t.tag?t.element.disabled=e.buffer.length<=1||e.bufferIndex<=0:t.element.disabled=e.bufferIndex>=e.buffer.length-1},D=function(e){if(0!=e.options.bufferSize){if(e.buffer.length>e.options.bufferSize&&e.buffer.shift(),e.bufferIndex+1<e.buffer.length){const t=e.buffer.length-(e.bufferIndex+1);for(let n=0;n<t;n++)e.buffer.pop()}e.buffer.push(e.editorNode.innerHTML),e.bufferIndex=e.buffer.length-1,H(e,P),H(e,R)}},M=function(e){let t=e.bufferIgnore;return e.bufferIgnore=!1,t},I={setState:H},P=new O("buffer","UNDO","Undo",'<i class="bi bi-reply"></i>',(function(e){e.bufferIndex>0&&(e.bufferIndex--,e.bufferIgnore=!0,e.editorNode.innerHTML=e.buffer[e.bufferIndex]),H(e,P),H(e,R),e.options.debug,e.updateEventHandlers()}),I),R=new O("buffer","REDO","Redo",'<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',(function(e){e.bufferIndex+1<e.buffer.length&&(e.bufferIndex++,e.bufferIgnore=!0,e.editorNode.innerHTML=e.buffer[e.bufferIndex]),H(e,P),H(e,R),e.options.debug,e.updateEventHandlers()}),I),F=["cancel","delete","confirm"];const U=class{constructor(e){this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1;for(let t in e)this[t]=e[t]}setPosition(e,t){let n;if(this.container=this.panel.querySelector(".modal-panel-container"),3!==e.startContainer.nodeType)if(e.startContainer.childNodes.length>0){n=e.startContainer.childNodes[0].getBoundingClientRect()}else n={x:t.offsetLeft,y:t.offsetTop};else n=e.getBoundingClientRect();n.x+this.container.outerWidth>window.innerWidth&&(n.x=window.innerWidth-this.container.outerWidth-20),n.y+this.container.outerHeight>window.innerHeight&&(n.y=window.innerHeight-this.container.outerHeight-40),this.container.style.top=`${n.y}px`,this.container.style.left=`${n.x}px`}template(){let e=[];null!=this.backgroundColour&&e.push(`background-color:${this.backgroundColour}`),null!=this.borderRadius&&e.push(`border-radius:${this.borderRadius}`);let t=`<div class="modal-panel-container" ${0==e.length?"":`style="${e.join(";")}"`}>`,n="";switch(this.severity){case"info":n='<i class="info bi bi-info-circle-fill"></i>';break;case"warning":n='<i class="warning bi bi-cone-striped"></i>';break;case"danger":n='<i class="danger bi bi-exclamation-circle-fill"></i>'}if((this.title||n)&&(t+=`\n                <header class="modal-panel-header">\n                    <h3 class="modal-panel-title">${n}${this.title}</h3>\n                </header>`),this.html&&(t+=`<div class="modal-panel-body">${this.html}</div>`),this.buttons){let e="",n=0;F.forEach((t=>{this.buttons[t]&&(n++,e+=`<button type="button" class="${t}">${this.buttons[t].label}</button>`)}));t+=`<div class="modal-panel-buttons ${1==n?"centred":""}">${e}</div>`}return t+="</div>",t}hide(){this.panel.classList.remove("show"),setTimeout((()=>{this.panel.remove(),this.panel=null}),500)}active(){return!!document.querySelector(".modal-panel")}addEventListeners(){this.buttons&&F.forEach((e=>{if(this.buttons[e]){const t=this.buttons[e],n=this.panel.querySelector(`button.${e}`);n&&n.addEventListener("click",(()=>{t.callback?t.callback():this.hide()}))}})),this.escape&&(document.addEventListener("keydown",(e=>{"Escape"==e.key&&(e.stopPropagation(),this.hide())})),this.panel.addEventListener("click",(e=>{e.target==this.panel&&(e.stopPropagation(),this.hide())})))}show(){this.panel=document.createElement("DIV"),this.panel.id=q(),this.panel.classList.add("modal-panel"),this.panel.classList.add(`modal-panel-${this.type}`),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout((()=>{this.panel.classList.add("show")}),10)}};const B=class{constructor(e,t="",n,o){if(this.options=this.initOptions(o),this.toolbar=this.initToolbar(n),e.innerHTML=function(e,t){const n=function(e){let t="",n=[];return e.forEach(((o,a)=>{t+=function(e){const{type:t,tag:n,label:o,icon:a}=e;return`\n        <button id="${n}" type="button" class="btn btn-light ${t}" title="${o}">\n            ${a}\n        </button>`}(o);const r=a==e.length-1?"":e[a+1].group;if(o.group!=r){const e=`${o.group} buttons`;n.push(function(e,t){return`<div class="editor-toolbar-group block" role="group" title="${e}">${t}</div>`}(e,t)),t=""}})),n.join('<span class="editor-toolbar-group-separator">|</span>')}(e);let o="";return t.headingNumbers&&(o+="heading-numbers"),`\n        <div class="editor-container">\n            <div class="editor-toolbar">\n                ${n}\n            </div>\n            <div class="editor-body ${o}" contenteditable="true">\n                ...\n            </div>\n        </div>`}(this.toolbar,this.options),this.editorNode=e.querySelector(".editor-body"),this.toolbarNode=e.querySelector(".editor-toolbar"),this.debugTarget=!1,this.options.debug){const e=document.createElement("div");this.debugTarget=u(e,this.editorNode)}this.listenForMouseUpEvents(),this.listenForPasteEvents(),this.listenForKeydownEvents(),this.options.bufferSize>0&&(this.bufferIndex=0,this.buffer=[this.editorNode.innerHTML],this.listenForKeyupEvents()),this.save=this.getCleanData,this.update=this.updateEditor;new MutationObserver((()=>this.handleMutation())).observe(this.editorNode,{attributes:!1,childList:!0,subtree:!0}),this.modal=new U,this.initEditor(t)}handleMutation(){!1===this.bufferIgnoreMutation(this)&&(this.options.debug,this.bufferUpdate(this),this.updateEventHandlers())}initBuffering(){this.bufferIndex=-1,this.buffer=[],this.bufferIgnore=!1,this.bufferUpdate=D,this.bufferIgnoreMutation=M,this.options.debug}initOptions(e){return e?(e.headingNumbers=null==e.headingNumbers||e.headingNumbers,e.bufferSize=null==e.bufferSize?10:Math.max(parseInt(e.bufferSize),10),e.debug=null!=e.debug&&e.debug):e={headingNumbers:true,bufferSize:10,debug:false},e}async initEditor(e=""){if(this.options.defaultContent&&""!=this.options.defaultContent){const t=await fetch(this.options.defaultContent);200==t.status&&(e=await t.text())}this.initBuffering(),this.editorNode.innerHTML=e,this.range=!1,this.initialiseButtons()}initToolbar(e){let t=[];return e.forEach(((e,n)=>{e.forEach((e=>{var o,a;e.group=n,o=e.type,a=e.tag,null!=d[o]&&0==d[o].includes(a)&&"CLEAR"!=a&&d[o].push(a),t.push(e)}))})),t}setState(e){"setState"in e?e.setState(this,e):(!1===this.range?e.element.disabled=!0:e.element.disabled=!1,e.element.classList.remove("active"))}setStates(e=""){this.toolbar.forEach((t=>{""!=e&&t.type!=e||this.setState(t)}))}initialiseButtons(){this.shortcuts=[],this.toolbar.forEach((e=>{if(e.element=this.toolbarNode.querySelector(`#${e.tag}`),"init"in e&&e.init(this,e),this.setState(e),"shortcut"in e){e.shortcut[0],e.shortcut[1];this.shortcuts.push({shortcut:e.shortcut[0],trigger:e.shortcut[1],button:e})}e.element.addEventListener("click",(t=>{this.modal.active()||(!1!==this.range||"buffer"===e.type?e.click(this,e):t.preventDefault())}))}))}listenForMouseUpEvents(){document.addEventListener("mouseup",(e=>{if(!this.modal.active())if(this.nodeInEditor(e.target))this.handleMouseUp();else{if(this.nodeInToolbar(e.target))return;this.handleEditorBlur()}}))}handleEditorBlur(e){this.toolbar.forEach((e=>{this.range=!1,this.setState(e)}))}nodeInEditor(e){for(;3==e.nodeType||"HTML"!=e.tagName;){if(e==this.editorNode)return!0;e=e.parentNode}return!1}nodeInToolbar(e){for(;3==e.nodeType||"HTML"!=e.tagName;){if(e==this.toolbarNode)return!0;e=e.parentNode}return!1}setToolbarStates(){!1!==this.range?this.toolbar.forEach((e=>{this.setState(e)})):this.toolbar.forEach((e=>{e.element.classList.remove("active")}))}handleMouseUp(){if(this.updateRange(),!1!==this.range){this.bufferIgnore=!1,this.range.blockParent==this.editorNode&&""==this.editorNode.innerText&&this.insertParagraph();const e=b(this.range);this.highlightCustomNode(e)}this.setToolbarStates()}insertParagraph(){let e=document.createElement("P");e.innerText="\n",e=this.editorNode.appendChild(e),T(e,0)}listenForKeydownEvents(){this.lastKey="",this.editorNode.addEventListener("keydown",(e=>{let t=!1;if(this.options.debug,document.querySelectorAll(".show").length>0&&(e.preventDefault(),t=!0),t||"Enter"!=e.key||(this.handleEnter()&&e.preventDefault(),t=!0),!t&&("Backspace"==e.key||"Delete"==e.key||e.ctrlKey&&"d"==e.key)&&(this.handleDelete(e.key)&&e.preventDefault(),t=!0),t||this.shortcuts.forEach((n=>{this.lastKey===n.shortcut&&e.key===n.trigger&&(e.preventDefault(),e.stopPropagation(),n.button.click(this,n.button),t=!0)})),!t&&this.bufferSize>0&&(e.ctrlKey||e.metaKey)&&"z"==e.key){let n;e.preventDefault(),n=e.shiftKey?this.toolbar.find((e=>"REDO"==e.tag)):this.toolbar.find((e=>"UNDO"==e.tag)),this.buffer.click(n),this.updateEventHandlers(),t=!0}this.lastKey=e.key}))}handleEnter(){if(this.updateRange(),!1===this.range)return;const e=b(this.range),t=this.range.endContainer.textContent.trim().length==this.range.endOffset;let n=!1;if(e||t){let e=document.createElement(this.range.blockParent.tagName);e.innerText="\n",e=u(e,this.range.blockParent),T(e,0),n=!0}return e&&this.highlightCustomNode(!1),setTimeout((()=>this.updateRange()),10),n}handleDelete(e){if("d"==e&&(e="Delete"),this.updateRange(),this.range){const t=new U({type:"overlay",severity:"info",title:"Information",html:"<p>To delete a custom element you need to edit it by clicking it and choosing Delete.</p>",escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if("Backspace"==e&&0==this.range.startOffset){const e=this.range.blockParent.previousElementSibling;if(e&&e.querySelector('[contenteditable="false"]'))return t.show(),!0}else if("Delete"==e&&this.range.endContainer.textContent.trim().length==this.range.endOffset){const e=this.range.endContainer.nextElementSibling;if(e&&"false"==e.getAttribute("contenteditable"))return t.show(),!0}}else{let e=g(this.range.startContainer);const n=g(this.range.endContainer);for(;e!==n;){if(e.innerHTML.includes('contenteditable="false"'))return t.show(),!0;e=e.nextElementSibling}}}return setTimeout((()=>this.updateRange()),10),!1}listenForKeyupEvents(){this.handleKeyup=function(e,t){let n;return function(...o){n&&clearTimeout(n),n=setTimeout((()=>{e(...o)}),t)}}(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",(e=>{0==["Shift"].includes(e.key)&&(this.bufferIgnore=!0,this.handleKeyup(e.key,this))}))}handleKeyupDelayed(...e){let t=e[0];const n=e[1];["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"].includes(t)?(n.range=x(),n.setToolbarStates()):0==document.querySelectorAll(".show").length&&n.bufferUpdate(n)}updateEventHandlers(){this.toolbar.forEach((e=>{"addEventHandlers"in e&&e.addEventHandlers(this)}))}listenForPasteEvents(){["cut","copy","paste"].forEach((e=>this.editorNode.addEventListener(e,(e=>{this.handleCutCopyPaste()&&e.preventDefault()}))))}handleCutCopyPaste(){if(this.updateRange(),0==this.range||this.range.collapsed)return!1;let e=g(this.range.startContainer);const t=g(this.range.endContainer);let n=!1;for(;!n;){if(e.innerHTML.includes('contenteditable="false"')){return new U({type:"overlay",severity:"info",title:"Information",html:"<p>Cut, copy and paste (of or over) selections with custom block elements is not supported.</p>\n                           <p>Please modify your selection and try again.</p>",escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0}e=e.nextElementSibling,e===t&&(n=!0)}return!1}testModals(e){if("overlay"==e){new U({type:"overlay",title:"Example feedback modal",html:'\n                    <p>This is an example of an overlay modal.</p>\n                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>\n                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>',severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show()}else if("drawer"==e){new U({type:"drawer",title:"Example of an edit modal",html:'\n                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>\n                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>\n                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>',buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:()=>alert("delete")},confirm:{label:"Confirm",callback:()=>alert("confirm")}}}).show()}else"positioned"==e&&this.editorNode.addEventListener("click",(()=>{this.updateRange();const e=new U({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:'\n                        <div style="width:400px;padding:1rem;">\n                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>\n                            <p>The contents can be added as required.</p>\n                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>\n                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>\n                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>\n                        </div>'});e.show(),e.setPosition(this.range,this.editorNode)}))}getCleanData(){let e=this.editorNode.cloneNode(!0);const t=this.toolbar.filter((e=>"custom"===e.type));return v(e,t),e.innerHTML=e.innerHTML.replace(/[\n ]*?</gm,"<"),e.innerHTML}updateEditor(e){this.editorNode.innerHTML=e}updateRange(){var e,t;this.range=x(),this.options.debug&&(e=this.debugTarget,t=this.range,0!=e&&(e.innerHTML=!1===t?"No range selected":`\n            <h5>Selection info:</h5>\n            <div class="debug">\n                <div class="col">\n                    <label>Block parent</label><span>${t.blockParent.tagName}</span>\n                    <label>commonAncestorC</label><span>${t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent}</span>\n                    <label>rootNode</label><span>${t.rootNode.tagName}</span>\n                    <label>collapsed</label><span>${t.collapsed}</span>\n                </div>\n                <div class="col">\n                    <label>startC</label><span>${t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent}</span>\n                    <label>startOffset</label><span>${t.startOffset}</span>\n                    <label>endC</label><span>${t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent}</span>\n                    <label>endOffset</label><span>${t.endOffset}</span>\n                </div>\n            </div>`))}highlightCustomNode(e){this.editorNode.querySelectorAll("[contenteditable=false]").forEach((e=>e.classList.remove("selected"))),e&&e.classList.add("selected")}};let K,j,V="";const z=function(e,t){K=e.startContainer,j=e.endContainer,t&&(K=g(K),j=g(j)),V="pre"},Y=function(e){e==K?(V="first",e==j&&(V="both")):e==j?V="last":"first"==V?V="during":"both"==V||"last"==V?V="post-first":"post-first"==V&&(V="post")},G=function(){return"pre"==V},W=function(){return"first"==V||"both"==V},_=function(){return"post-first"==V||"post"==V};let Q,J,X=[],Z=!1;function ee(e,t){let n,o=J,a=function(e){let t="";return e.childNodes.forEach((e=>{if(3===e.nodeType){let n=e.textContent;n.includes("\n")&&(n=n.trim()),t+=n}else(p(e)||m(e)||"BR"===e.tagName)&&(t+=e.outerHTML)})),t}(e),r=[];r="during"==V||"first"==V||"last"==V||"both"==V?t.newFormats:t.oldFormats;let i=r.slice(-1)[0];e.nodeType;if(!(1!==e.nodeType||""==a&&e.innerHTML.includes("<"))){if(0==X.length)r.forEach((e=>{n=document.createElement(e),o=o.appendChild(n)}));else if(r.length>X.length){if(function(e,t){return e.every(((e,n)=>t[n]==e))}(X,r)){for(let e=0;e<X.length;e++)o=o.lastElementChild;for(let e=X.length;e<r.length;e++)n=document.createElement(r[e]),o=o.appendChild(n)}}else(function(e,t){return(0==e.length||0==t.length||e.length==t.length)&&e.every(((e,n)=>t[n]==e))})(r,X)&&(Z&&Z!=J&&(o=Z.parentNode),n=document.createElement(i),o=o.appendChild(n));if(o==J){let e=0;r.forEach(((t,n)=>{t==X[n]&&0==(n==r.length-1&&"LI"==t)&&(o=o.lastElementChild,e++)}));for(let t=e;t<r.length;t++)n=document.createElement(r[t]),o=o.appendChild(n)}Z=o,X=r.slice(),""!=a&&(o.innerHTML=a)}}function te(e,t,n){let o={oldFormats:[],newFormats:[]};e!=Q&&(Y(e),o=function(e,t,n){const o=[...t.oldFormats,e.tagName];let a=[];if(G()||_())return a=[...o],{newFormats:a,oldFormats:o};if("block"===n.type)return a=[n.newFormat],{newFormats:a,oldFormats:o};if(W())return"LI"==e.tagName?e.parentNode.firstElementChild==e?(a.pop(),a.push(n.newFormat),a.push("LI")):(a=t.oldFormats.slice(),a.push(n.newFormat),a.push("LI")):(a.push(n.newFormat),a.push("LI")),{newFormats:a,oldFormats:o};return a=X.slice(),{newFormats:a,oldFormats:o}}(e,t,n),ee(e,o)),e.childNodes.forEach((e=>{(h(e)||f(e))&&te(e,o,n)}))}const ne=function(e,t){const n=e.range;Q=e.editorNode,X=[],Z=!1,function(e){e.action="apply",("CLEAR"==e.tag||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,"block"==e.type&&"remove"==e.action&&(e.newFormat="P")}(t),n.rootNode=y(n.rootNode,Q);const o=y(n.startContainer,Q),a=y(n.endContainer,Q);if(function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+C+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+w+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+C+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+w+e.endContainer.textContent.substring(e.endOffset))}(n),z(n,!0),o==a)J=document.createElement("DIV"),te(o,{oldFormats:[],newFormats:[]},t),o==Q?o.innerHTML=J.innerHTML:o.outerHTML=J.innerHTML;else{let e=!1,r=!1;J=document.createElement("DIV"),n.rootNode.childNodes.forEach((n=>{if(1===n.nodeType&&(n==o&&(e=!0),e&&0==r&&("block"===t.type&&(X=[],Z=!1,J=document.createElement("DIV")),te(n,{oldFormats:[],newFormats:[]},t),"block"===t.type?n.outerHTML=J.innerHTML:n.setAttribute("data-remove",!0)),n==a)){r=!0,"list"===t.type&&(n.outerHTML=J.innerHTML),Q.querySelectorAll("[data-remove=true]").forEach((e=>e.remove()))}}))}$(e.editorNode),e.updateRange(),e.setStates("block")},oe={setState:function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{let n=g(e.range.startContainer,e.editorNode);t.element.disabled="DIV"===n.tagName||m(n),"list"===t.type&&"LI"===n.tagName&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}}},ae=new O("block","H1","Heading 1",'<i class="bi bi-type-h1"></i>',ne,oe),re=new O("block","H2","Heading 2",'<i class="bi bi-type-h2"></i>',ne,oe),ie=new O("block","H3","Heading 3",'<i class="bi bi-type-h3"></i>',ne,oe),le=new O("block","P","Paragraph",'<i class="bi bi-paragraph"></i>',ne,oe),se=new O("block","BLOCKQUOTE","Blockquote",'<i class="bi bi-blockquote-left"></i>',ne,oe),ce=new O("list","OL","Ordered list",'<i class="bi bi-list-ol"></i>',ne,oe),de=new O("list","UL","Unordered list",'<i class="bi bi-list-ul"></i>',ne,oe);function ue(e,t){let n="",o="",a="";return"both"==V?(o=e.textContent.substring(0,t.startOffset),n=C+e.textContent.substring(t.startOffset,t.endOffset)+w,a=e.textContent.substring(t.endOffset)):W()?(o=e.textContent.substring(0,t.startOffset),n=C+e.textContent.substring(t.startOffset)):"last"==V?(n=e.textContent.substring(0,t.endOffset)+w,a=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:o,text:n,postText:a}}function pe(e,t,n){if(0==e.length)return t;let o=`<span style="${e.join(";")}">${t}`;return n&&(o+="</span>"),o}const fe=function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{t.element.disabled="DIV"===e.range.rootNode.tagName||f(e.range.rootNode)||m(e.range.rootNode),be(t);(function(e){let t="";for(;0==h(e);){if(1===e.nodeType){const n=e.getAttribute("style");null!=n&&""!=n&&(t+=";"+n)}e=e.parentNode}return t})(e.range.startContainer).includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")}},he=function(e,t,n,o){return 3===e.nodeType?function(e,t,n,o){Y(e);const{preText:a,text:r,postText:i}=ue(e,o);let l="";if(G()||_())l+=pe(t,r,!0);else{const e=`${n.newStyle}:${n.newValue}`,o=function(e,t){let n=-1;return e.forEach(((e,o)=>{e==t&&(n=o)})),n}(t,e);let s=!0;if(a&&(0==t.length?l+=a:(s=!0,"apply"==n.action&&(o>-1||""!=i)&&(s=!1),l+=pe(t,a,s))),r)if("apply"==n.action)if(o>-1&&0==s)l+=r;else{let n=[];n=s?[...t,e]:[e],l+=pe(n,r,!0)}else"remove"!=n.action&&"clear"!=n.action||(l+=r);i&&(0==t.length?l+=i:s?l+=pe(t,i,!0):(l+=i,t.forEach((()=>l+="</span>"))))}return l}(e,t,n,o):m(e)?e.outerHTML:function(e,t,n,o){if("SPAN"===e.tagName){const n=e.getAttribute("style");null!=n&&""!=n&&n.split(";").forEach((e=>{if(""!=e){const n=e.split(":");0==t.includes(n[0].trim())&&(t=[...t,e])}}))}let a="";return e.childNodes.forEach((e=>{a+=he(e,t,n,o)})),a}(e,t,n,o)},be=function(e){const t=e.style.split(":");e.newStyle=t[0],e.newValue=void 0!==t[1]?t[1]:"",e.action="apply",e.element.classList.contains("active")&&"CLEAR"!=e.style?e.action="remove":"CLEAR"==e.style&&(e.action="clear")},me=function(e,t){const n=e.range;0==h(n.rootNode)&&(n.rootNode=g(n.rootNode)),be(t),z(n,!1);const o=he(n.rootNode,[],t,n);!function(e,t,n){const o=document.createElement(t);o.innerHTML=n;const a=e.parentNode.insertBefore(o,e);e.parentNode.removeChild(e)}(n.rootNode,n.rootNode.tagName,o);$(e.editorNode),e.updateRange(),t.setState(e,t)};let ge={setState:fe,style:"font-weight:bold",removeStyle:"font-weight:normal"};const ye=new O("style","B","Bold",'<i class="bi bi-type-bold"></i>',me,ge);ge={setState:fe,style:"font-style:italic",removeStyle:"font-style:normal"};const ve=new O("style","I","Italic",'<i class="bi bi-type-italic"></i>',me,ge);ge={setState:fe,style:"text-decoration:underline",removeStyle:"text-decoration:none"};const Ce=new O("style","U","Underline",'<i class="bi bi-type-underline"></i>',me,ge);ge={setState:fe,style:"CLEAR"};const we=new O("style","CLEAR","Clear",'<i class="bi bi-eraser"></i>',me,ge);let Ee,ke,Ne,Le,Se=[],xe=0,Te=null;function Ae(e){let t="";return Se.forEach((n=>{const o=n.toLowerCase();(""==e||o.includes(e))&&(t+=`<li>${n}</li>`)})),t}function $e(e=!0){xe>=0&&ke.length>0&&(ke.forEach((e=>e.classList.remove("selected"))),ke[xe].classList.add("selected"),e&&ke[xe].scrollIntoView({block:"end",inline:"nearest"}))}function qe(e){const t=e.key,n=e.shiftKey;if(0==ke.length?xe=-1:"ArrowDown"==t||"ArrowRight"==t||"Tab"==t&&0==n?(e.preventDefault(),xe<ke.length-1?xe++:xe=0,$e()):"ArrowUp"==t||"ArrowLeft"==t||"Tab"==t&&n?(e.preventDefault(),0==xe?xe=ke.length-1:xe--,$e()):"Enter"!=t&&(Ne.innerHTML=Ae(Le.value.toLowerCase()),ke=Ne.querySelectorAll("li"),xe=0,$e()),"Enter"==t){He(-1!=xe?ke[xe].textContent:Le.value)}}function Oe(e){He(e.target.textContent)}function He(e){let t=Ee.range.startContainer.textContent,n=Ee.range.startOffset,o=t.substring(0,n),a=t.substring(n);"@"===a.charAt(0)&&(a=a.slice(1,a.length)),32!==t.charCodeAt(n-1)&&(e=" "+e),n<t.length&&32!==t.charCodeAt(n)&&(""!=a&&(a+=" "),e+=" "),Ee.range.startContainer.textContent=o+e+a,n+=e.length,Ee.range=T(Ee.range.startContainer,n),Te.hide(),Ee.bufferUpdate(Ee)}const De=function(e){Se=e.sort()},Me=new O("custom","mention","Mention",'<i class="bi bi-person"></i>',(function(e,t){!1!==e.range&&(Ee=e,Te=new U({type:"positioned",escape:!0,html:`<div class="mentions">\n                <input type="text"/>\n                <ul>${Ae("")}</ul>\n            </div>`}),Te.show(),Te.setPosition(Ee.range,Ee.editorNode),Te.container.addEventListener("keyup",qe),Ne=Te.container.querySelector("ul"),Ne.addEventListener("click",Oe),ke=Ne.querySelectorAll("li"),xe=0,$e(!1),Le=Te.container.querySelector("input"),Le.value="",Le.focus())}),{setState:function(e,t){!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer?t.element.disabled=!0:t.element.disabled=!1},shortcut:["@","@"]}),Ie="A";let Pe,Re,Fe,Ue,Be=null,Ke=null;function je(){Ke.hide(),Be.hide()}function Ve(){Ue?(Ke=new U({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:je}}}),Ke.show()):Be.hide()}function ze(){Ke.hide(),Be.hide(),Fe.remove(),Pe.range=!1,Xe(Pe,Re)}function Ye(){Ke=new U({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this link?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:ze}}}),Ke.show()}function Ge(e){Be&&Be.active()||(Fe=e,We("",!0))}function We(e,t){let n="Create link",o={cancel:{label:"Cancel",callback:Ve},confirm:{label:"Save",callback:_e}};t?(n="Edit link",o.delete={label:"Delete",callback:Ye}):(Fe=document.createElement(Ie),Fe.id=q(),Fe.setAttribute("contenteditable","false"),Fe.href="",Fe.dataset.label=e,Fe.dataset.display=0),Be=new U({type:"drawer",title:n,html:Je(t),buttons:o}),Be.show(),Ue=!1;Be.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>Ue=!0))));const a=Be.panel.querySelector("form #href");a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function _e(){Fe.href=Be.panel.querySelector("form #href").value.trim(),Fe.dataset.label=Be.panel.querySelector("form #label").value.trim(),Fe.dataset.display=parseInt(Be.panel.querySelector("form #display").value),null==Fe.parentNode&&function(e){const t=e.range.startContainer.parentNode;let n,o=e.range.startContainer.textContent.substring(0,e.range.startOffset);e.range.collapsed?(n=e.range.startContainer.textContent.substring(e.range.startOffset)," "!=o.charAt(o.length+1)&&(o+=" ")," "!=n.charAt(0)&&(n=" "+n)):n=e.range.startContainer.textContent.substring(e.range.endOffset);o&&t.insertBefore(document.createTextNode(o),e.range.startContainer);Fe=t.insertBefore(Fe,e.range.startContainer),n&&t.insertBefore(document.createTextNode(n),e.range.startContainer);e.range.startContainer.remove()}(Pe),Be.hide(),Qe(Fe),Pe.range=T(Fe,0),Xe(Pe,Re)}function Qe(e){0==e.id&&(e.id=q()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerText=function(e){switch(parseInt(e.dataset.display)){case 0:if(e.dataset.label)return e.dataset.label;break;case 1:return e.href;case 2:if(e.dataset.label&&e.dataset.label!=e.href)return`${e.dataset.label} (${e.href})`}return e.href}(e),e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Ge(e)}))}function Je(e){let t="",n="http://",o=Fe.dataset.label,a=Fe.dataset.display?Fe.dataset.display:0;return e&&(n=Fe.href,t=`<a href="${n}" class="panel-link" target="_blank" title="Open link in new tab or window"><i class="bi bi-link-45deg"></i></a>`),`\n        <form>\n            <div class="form-input">\n                <label for="href">URL</label>\n                <input id="href" type="url" class="form-control ${t?"with-button":""}" placeholder="URL" required value="${n}">\n                ${t}\n            </div>\n            <div class="form-input">\n                <label for="label">Label (optional)</label>\n                <input id="label" type="text" class="form-control" placeholder="Label" value="${o}">\n            </div>\n            <div class="form-input">\n                <label for="label">Display option</label>\n                <select class="form-control" id="display">\n                    <option value="0" ${0==a?"selected":""}>Label only</option>\n                    <option value="1" ${1==a?"selected":""}>Link only</option>\n                    <option value="2" ${2==a?"selected":""}>Label and link</option>\n                </select>\n            </div>\n        </form>`}const Xe=function(e,t){if(!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer)t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(Ie)?t.element.classList.add("active"):t.element.classList.remove("active")}},Ze=new O("custom",Ie,"Link",'<i class="bi bi-link"></i>',(function(e,t){if(Be&&Be.active())return;if(Pe=e,Re=t,!1===Pe.range)return;let n="";0==Pe.range.collapsed&&Pe.range.startContainer==Pe.range.endContainer&&(n=Pe.range.endContainer.textContent.substring(Pe.range.startOffset,Pe.range.endOffset)),We(n,!1)}),{init:function(e,t){Pe=e,Re=t;Pe.editorNode.querySelectorAll(Ie).forEach((e=>Qe(e)))},setState:Xe,addEventHandlers:function(e){Pe=e,Re=Ze;Pe.editorNode.querySelectorAll(Ie).forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Ge(e)}))))},clean:function(e){return e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.innerText=" ",e}}),et=100/30,tt=100/30;let nt,ot,at,rt,it,lt=null;function st(e,t){if(lt.panel.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),null==e){lt.panel.querySelectorAll(".colours .hues span").forEach(((e,t)=>{const n=12*t;e.style.backgroundColor=`hsl(${n},100%,50%)`,n==nt&&e.classList.add("active")}));lt.panel.querySelectorAll(".colours .saturations span").forEach(((e,t)=>{const n=t*et;e.style.backgroundColor=`hsl(${nt},${n}%,50%)`,n==ot&&e.classList.add("active")}));lt.panel.querySelectorAll(".colours .lightnesses span").forEach(((e,t)=>{const n=t*tt;e.style.backgroundColor=`hsl(${nt},50%,${n}%)`,n==at&&e.classList.add("active")}))}else e.classList.add("active"),nt=0,ot=100,at="black"==t?0:100;lt.panel.querySelector("form .result span").style.backgroundColor=`hsl(${nt},${ot}%,${at}%)`}function ct(){let e="",t="",n="";for(let o=0;o<30;o++)e+=`<span class="colour" data-colour="hue" data-index="${o}">&nbsp;</span>`,t+=`<span class="colour" data-colour="saturation" data-index="${o}">&nbsp;</span>`,n+=`<span class="colour" data-colour="lightness" data-index="${o}">&nbsp;</span>`;return`\n        <form id="colour-menu">\n\n            <div class="colours">\n                <div class="hues">\n                    <label>Hue</label>\n                    <div>${e}</div>\n                </div>\n                <div class="saturations">\n                    <label>Saturation</label>\n                    <div>${t}</div>\n                </div>\n                <div class="lightnesses">\n                    <label>Lightness</label>\n                    <div>${n}</div>\n                </div>\n            </div>\n\n            <div class="result">\n                <label>Result</label>\n                <span class="final">&nbsp;</span>\n                <label>Black and white</label>\n                <span class="black-and-white" data-colour="black">&nbsp;</span>\n                <span class="black-and-white" data-colour="white">&nbsp;</span>\n            </div>\n            \n        </form>`}function dt(){const e=`hsl(${nt}, ${ot}%, ${at}%)`,t={setState:pt,style:`${it.style}:${e}`,removeStyle:it.removeStyle,element:it.element};lt.hide(),me(rt,t)}const ut=function(e,t){if(!lt||!lt.active())if(rt=e,it=t,!1===rt.range||rt.range.collapsed){new U({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show()}else!function(){nt=0,ot=29*et,at=50;let e="Select highlight colour";"FGC"==it.tag&&(e="Select text colour"),lt=new U({type:"drawer",title:e,html:ct(),escape:!0,buttons:{cancel:{label:"Cancel"},confirm:{label:"Set",callback:dt}}}),lt.show(),st(),lt.panel.querySelectorAll("span.colour").forEach((e=>e.addEventListener("click",(e=>{const t=e.target,n=t.dataset.colour,o=t.dataset.index;switch(n){case"hue":nt=12*o;break;case"saturation":ot=o*et;break;case"lightness":at=o*tt}st()})))),lt.panel.querySelectorAll("span.black-and-white").forEach((e=>e.addEventListener("click",(e=>{const t=e.target.dataset.colour;st(e.target,t)}))))}()},pt=function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{t.element.disabled="DIV"===e.range.rootNode.tagName||f(e.range.rootNode)||m(e.range.rootNode);let n="",o=[];const a=e.range.startContainer.parentNode.getAttribute("style");null!=a&&(o=a.split(";"),o.forEach((e=>{if(""!==e){const o=e.split(":");o[0].trim()===t.style&&(n=o[1].trim(),t.element.querySelector("span.bar").setAttribute("style",`background-color:${n};`))}}))),""==n&&t.element.querySelector("span.bar").removeAttribute("style")}},ft=function(e,t){const n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")};let ht={init:ft,setState:pt,style:"color",removeStyle:"color:black;"};const bt=new O("inline","FGC","Text colour",'<i class="bi bi-type"></i>',ut,ht);ht={init:ft,setState:pt,style:"background-color",removeStyle:"background-color:white;"};const mt=new O("inline","BGC","Highlight colour",'<i class="bi bi-paint-bucket"></i>',ut,ht),gt="CUSTOM";let yt,vt,Ct,wt,Et=null,kt=null;function Nt(e){Et&&Et.active()||(Ct=e,At(!0))}function Lt(){kt.hide(),Et.hide()}function St(){kt.hide(),Et.hide(),Ct.remove(),yt.range=!1,Ht(yt,vt)}function xt(){wt?(kt=new U({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Lt}}}),kt.show()):Et.hide()}function Tt(){kt=new U({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:St}}}),kt.show()}function At(e){let t="Create custom element",n={cancel:{label:"Cancel",callback:xt},confirm:{label:"Save",callback:$t}};e?(t="Edit custom element",n.delete={label:"Delete",callback:Tt}):(Ct=document.createElement(gt),Ct.id=q(),Ct.setAttribute("contenteditable","false"),Ct.innerHTML=Ot({property1:" ",property2:" ",property3:" "}));const o={property1:Ct.querySelector(".property1").innerText,property2:Ct.querySelector(".property2").innerText,property3:Ct.querySelector(".property3").innerText};var a;Et=new U({type:"drawer",title:t,html:(a=o,`\n        <form>\n            <div class="form-input">\n                <label for="property1">Property 1</label>\n                <input id="property1" type="text" class="form-control" placeholder="Property 1" required value="${a.property1}">\n            </div>\n            <div class="form-input">\n                <label for="property2">Property 2</label>\n                <input id="property2" type="text" class="form-control" placeholder="Property 2" required value="${a.property2}">\n            </div>\n            <div class="form-input">\n                <label for="property3">Property 3</label>\n                <input id="property3" type="text" class="form-control" placeholder="Property 3" required value="${a.property3}">\n            </div>\n        </form>`),buttons:n}),Et.show(),wt=!1;Et.panel.querySelectorAll("form input").forEach((e=>e.addEventListener("change",(()=>wt=!0))));const r=Et.panel.querySelector("form input#property1");r.focus(),r.setSelectionRange(r.value.length,r.value.length)}function $t(){Ct.querySelector(".property1").innerText=Et.panel.querySelector("form #property1").value.trim(),Ct.querySelector(".property2").innerText=Et.panel.querySelector("form #property2").value.trim(),Ct.querySelector(".property3").innerText=Et.panel.querySelector("form #property3").value.trim(),null==Ct.parentNode&&(Ct=yt.range.startContainer.parentNode.appendChild(Ct)),Et.hide(),qt(Ct),yt.range=T(Ct,0),Ht(yt,vt)}function qt(e){e.id;0==e.id&&(e.id=q());const t={property1:e.querySelector(".property1").innerText,property2:e.querySelector(".property2").innerText,property3:e.querySelector(".property3").innerText};e.innerHTML=Ot(t),e.setAttribute("contenteditable",!1);const n=document.createElement("button");n.type="button",n.classList.add("edit"),n.innerText="Edit",n.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Nt(e)})),e.appendChild(n),e.addEventListener("click",(()=>{Ht(yt,vt)}))}function Ot(e){return`\n        <span class="title">I am a custom object with 3 properties:</span>\n        <span class="label">Property 1:</span><span class="prop property1">${e.property1}</span>\n        <span class="label">Property 2:</span><span class="prop property2">${e.property2}</span>\n        <span class="label">Property 3:</span><span class="prop property3">${e.property3}</span>\n        <span class="advice">Click the top right-hand button to edit. Select anywhere in the element and then the Enter key to add a new line after this custom element.</span>\n    `}const Ht=function(e,t){if(!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer)t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(gt)?t.element.classList.add("active"):t.element.classList.remove("active")}},Dt=new O("custom",gt,"Custom",'<i class="bi bi-plug"></i>',(function(e,t){if(Et&&Et.active())return;yt=e,vt=t;const n=yt.range.blockParent.querySelector(gt);null!=n?Nt(n):At(!1)}),{setState:Ht,init:function(e,t){yt=e,vt=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>qt(e)))},addEventHandlers:function(e){yt=e,vt=Dt,yt.editorNode.querySelectorAll("CUSTOM button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();Nt(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector(".title").remove(),e.querySelector(".advice").remove(),e.querySelector(".label").remove(),e.querySelector("button").remove(),e}}),Mt="COMMENT";let It,Pt,Rt,Ft,Ut=null,Bt=null;function Kt(e){Ut&&Ut.active()||(Rt=e,Gt(!0))}function jt(){Bt.hide(),Ut.hide()}function Vt(){Bt.hide(),Ut.hide(),Rt.remove(),It.range=!1,Jt(It,Pt)}function zt(){Ft?(Bt=new U({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:jt}}}),Bt.show()):Ut.hide()}function Yt(){Bt=new U({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Vt}}}),Bt.show()}function Gt(e){let t="Add comment",n={cancel:{label:"Cancel",callback:zt},confirm:{label:"Save",callback:Wt}};e?(t="Edit comment",n.delete={label:"Delete",callback:Yt}):(Rt=document.createElement(Mt),Rt.id=q(),Rt.setAttribute("contenteditable","false"),Rt.dataset.comment=" "),Ut=new U({type:"drawer",title:t,html:Qt(Rt.dataset.comment),buttons:n}),Ut.show(),Ft=!1;Ut.panel.querySelector("form textarea").addEventListener("change",(()=>Ft=!0));const o=Ut.panel.querySelector("form textarea#comment");o.focus(),o.setSelectionRange(o.value.length,o.value.length)}function Wt(){Rt.dataset.comment=Ut.panel.querySelector("form #comment").value.trim(),null==Rt.parentNode&&(Rt=It.range.startContainer.parentNode.appendChild(Rt)),Ut.hide(),_t(Rt),It.range=T(Rt,0),Jt(It,Pt)}function _t(e){e.id;0==e.id&&(e.id=q()),e.innerHTML="",e.setAttribute("contenteditable",!1);const t=document.createElement("button");t.type="button",t.classList.add("edit"),t.innerHTML='<i class="bi bi-chat-dots-fill"></i>',t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),Kt(e)})),e.appendChild(t),e.addEventListener("click",(()=>{Jt(It,Pt)}))}function Qt(e){return`\n        <form>\n            <div class="form-input">\n                <label for="comment">Comment</label>\n                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>${e}</textarea>\n            </div>\n        </form>`}const Jt=function(e,t){if(!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer)t.element.disabled=!0,t.element.classList.remove("active");else{t.element.disabled=!1;null!=e.range.blockParent.querySelector(Mt)?t.element.classList.add("active"):t.element.classList.remove("active")}},Xt=new O("custom",Mt,"Custom",'<i class="bi bi-chat-dots"></i>',(function(e,t){if(Ut&&Ut.active())return;It=e,Pt=t;const n=It.range.blockParent.querySelector(Mt);null!=n?Kt(n):Gt(!1)}),{setState:Jt,init:function(e,t){It=e,Pt=t;e.editorNode.querySelectorAll(t.tag).forEach((e=>_t(e)))},addEventHandlers:function(e){It=e,Pt=Xt,It.editorNode.querySelectorAll("COMMENT button").forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();Kt(e.parentNode)}))))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector("button").remove(),e}});return t})()}));