!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ARTE",[],t):"object"==typeof exports?exports.ARTE=t():e.ARTE=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Blocks:()=>r,Buffer:()=>n,Colours:()=>l,Comments:()=>c,Custom:()=>s,Editor:()=>G,Links:()=>i,Mentions:()=>o,Modal:()=>K,Styles:()=>a});var n={};e.r(n),e.d(n,{REDO:()=>F,UNDO:()=>U,ignore:()=>P,update:()=>M});var r={};e.r(r),e.d(r,{BQ:()=>be,H1:()=>de,H2:()=>fe,H3:()=>pe,OL:()=>ve,P:()=>he,UL:()=>me});var a={};e.r(a),e.d(a,{B:()=>Oe,CLEAR:()=>De,I:()=>Ie,U:()=>He,click:()=>Ae});var o={};e.r(o),e.d(o,{BUTTON:()=>_e,setup:()=>We});var i={};e.r(i),e.d(i,{BUTTON:()=>pt});var l={};e.r(l),e.d(l,{BACKGROUND:()=>At,FOREGROUND:()=>Tt});var s={};e.r(s),e.d(s,{BUTTON:()=>Wt});var c={};e.r(c),e.d(c,{BUTTON:()=>sn});var u=function(e,t){var n=function(e){var t="",n=[];return e.forEach((function(r,a){t+=function(e){var t=e.type,n=e.tag,r=e.label,a=e.icon;return'\n        <button id="'.concat(n,'" type="button" class="btn btn-light ').concat(t,'" title="').concat(r,'">\n            ').concat(a,"\n        </button>")}(r);var o=a==e.length-1?"":e[a+1].group;if(r.group!=o){var i="".concat(r.group," buttons");n.push(function(e,t){return'<div class="editor-toolbar-group block" role="group" title="'.concat(e,'">').concat(t,"</div>")}(i,t)),t=""}})),n.join('<span class="editor-toolbar-group-separator">|</span>')}(e),r="";return t.headingNumbers&&(r+="heading-numbers"),'\n        <div class="editor-container">\n            <div class="editor-toolbar">\n                '.concat(n,'\n            </div>\n            <div class="editor-body ').concat(r,'" contenteditable="true">\n                ...\n            </div>\n        </div>')},d={block:["DIV","P","LI"],list:["LI"],custom:[]},f=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},p=function(e){return null!=e.tagName&&"SPAN"===e.tagName},h=function(e){return void 0!==e.tagName&&("OL"===e.tagName||"UL"===e.tagName)},b=function(e){return null!=e.tagName&&d.block.includes(e.tagName)},v=function(e){var t=e.blockParent.firstElementChild;return!(null==t||!m(t))&&t},m=function(e){return null!=e.tagName&&d.custom.includes(e.tagName)},g=function(e){for(;0==b(e);)e=e.parentNode;return e},y=function(e,t){for(var n=e;e!=t;)n=e,e=e.parentNode;return n},C=function e(t,n){if(3!==t.nodeType)if(1===t.nodeType)if(!1!==b(t)||!1!==h(t)||!1!==p(t)||!1!==m(t))if(n.length>0&&m(t)){var r=n.find((function(e){return e.tag.toUpperCase()===t.tagName}));if(r&&"clean"in r){var a=r.clean(t);t.parentNode.replaceChild(a,t)}}else t.childNodes.forEach((function(t){e(t,n)}));else t.remove();else t.remove();else t.textContent.includes("\n")&&(t.textContent=t.textContent.trim())},k="§§",w="±±",E=null,S=0,N=null,L=0;function x(e){return e.blockParent=g(e.commonAncestorContainer),e.rootNode=e.commonAncestorContainer,3===e.commonAncestorContainer.nodeType&&(e.rootNode=e.commonAncestorContainer.parentNode),e}var T=function(){if(null===document.querySelector(".show")){var e=window.getSelection();if(1==e.rangeCount){var t=e.getRangeAt(0);return t=x(t)}}return!1},A=function(e,t){var n=document.createRange(),r=window.getSelection();return t>e.textContent.length&&(t=0),n.setStart(e,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n),n=x(n)};function q(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType){if(q(r,t))return!0}else if(3===r.nodeType){var a=r.textContent.indexOf(t);if(-1!=a)return r.textContent=r.textContent.replace(t,""),t==k?(E=r,S=a):(N=r,L=a),!0}}return!1}var O=function(e){if(q(e,k)&&function(e){return q(e,w)}(e)){var t=document.createRange(),n=window.getSelection();return t.setStart(E,S),E==N&&S==L?t.collapse(!0):t.setEnd(N,L),n.removeAllRanges(),n.addRange(t),t}return!1},I=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)};const H=function e(t,n,r,a,o,i){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.tag=n,this.label=r,this.input="button",this.icon=a,this.click=o,this.element=null,null!=i&&Object.keys(i).forEach((function(e){l[e]=i[e]}))};var D=function(e,t){"UNDO"==t.tag?t.element.disabled=e.buffer.length<=1||e.bufferIndex<=0:t.element.disabled=e.bufferIndex>=e.buffer.length-1},M=function(e){if(0!=e.options.bufferSize){if(e.buffer.length>e.options.bufferSize&&e.buffer.shift(),e.bufferIndex+1<e.buffer.length)for(var t=e.buffer.length-(e.bufferIndex+1),n=0;n<t;n++)e.buffer.pop();e.buffer.push(e.editorNode.innerHTML),e.bufferIndex=e.buffer.length-1,D(e,U),D(e,F)}},P=function(e){var t=e.bufferIgnore;return e.bufferIgnore=!1,t},R={setState:D},U=new H("buffer","UNDO","Undo",'<i class="bi bi-reply"></i>',(function(e){e.bufferIndex>0&&(e.bufferIndex--,e.bufferIgnore=!0,e.editorNode.innerHTML=e.buffer[e.bufferIndex]),D(e,U),D(e,F),e.options.debug,e.updateEventHandlers()}),R),F=new H("buffer","REDO","Redo",'<span style="display:inline-block;-webkit-transform: scale(-1, 1);transform: scale(-1, 1);"><i class="bi bi-reply"></i></span>',(function(e){e.bufferIndex+1<e.buffer.length&&(e.bufferIndex++,e.bufferIgnore=!0,e.editorNode.innerHTML=e.buffer[e.bufferIndex]),D(e,U),D(e,F),e.options.debug,e.updateEventHandlers()}),R);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=["cancel","delete","confirm"];const K=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="overlay",this.panel=null,this.container=null,this.title="",this.html="",this.severity="",this.buttons=!1,this.escape=!1,t)this[n]=t[n]}var t,n,r;return t=e,(n=[{key:"setPosition",value:function(e,t){var n;this.container=this.panel.querySelector(".modal-panel-container"),(n=3!==e.startContainer.nodeType?e.startContainer.childNodes.length>0?e.startContainer.childNodes[0].getBoundingClientRect():{x:t.offsetLeft,y:t.offsetTop}:e.getBoundingClientRect()).x+this.container.outerWidth>window.innerWidth&&(n.x=window.innerWidth-this.container.outerWidth-20),n.y+this.container.outerHeight>window.innerHeight&&(n.y=window.innerHeight-this.container.outerHeight-40),this.container.style.top="".concat(n.y,"px"),this.container.style.left="".concat(n.x,"px")}},{key:"template",value:function(){var e=this,t=[];null!=this.backgroundColour&&t.push("background-color:".concat(this.backgroundColour)),null!=this.borderRadius&&t.push("border-radius:".concat(this.borderRadius));var n=0==t.length?"":'style="'.concat(t.join(";"),'"'),r='<div class="modal-panel-container" '.concat(n,">"),a="";switch(this.severity){case"info":a='<i class="info bi bi-info-circle-fill"></i>';break;case"warning":a='<i class="warning bi bi-cone-striped"></i>';break;case"danger":a='<i class="danger bi bi-exclamation-circle-fill"></i>'}if((this.title||a)&&(r+='\n                <header class="modal-panel-header">\n                    <h3 class="modal-panel-title">'.concat(a).concat(this.title,"</h3>\n                </header>")),this.html&&(r+='<div class="modal-panel-body">'.concat(this.html,"</div>")),this.buttons){var o="",i=0;j.forEach((function(t){e.buttons[t]&&(i++,o+='<button type="button" class="'.concat(t,'">').concat(e.buttons[t].label,"</button>"))})),r+='<div class="modal-panel-buttons '.concat(1==i?"centred":"",'">').concat(o,"</div>")}return r+="</div>"}},{key:"hide",value:function(){var e=this;this.panel.classList.remove("show"),setTimeout((function(){e.panel.remove(),e.panel=null}),500)}},{key:"active",value:function(){return!!document.querySelector(".modal-panel")}},{key:"addEventListeners",value:function(){var e=this;this.buttons&&j.forEach((function(t){if(e.buttons[t]){var n=e.buttons[t],r=e.panel.querySelector("button.".concat(t));r&&r.addEventListener("click",(function(){n.callback?n.callback():e.hide()}))}})),this.escape&&(document.addEventListener("keydown",(function(t){"Escape"==t.key&&(t.stopPropagation(),e.hide())})),this.panel.addEventListener("click",(function(t){t.target==e.panel&&(t.stopPropagation(),e.hide())})))}},{key:"show",value:function(){var e=this;this.panel=document.createElement("DIV"),this.panel.id=I(),this.panel.classList.add("modal-panel"),this.panel.classList.add("modal-panel-".concat(this.type)),this.panel.classList.add(this.escape?"escape":"no-escape"),this.panel.innerHTML=this.template(),document.querySelector("body").appendChild(this.panel),this.addEventListeners(),setTimeout((function(){e.panel.classList.add("show")}),10)}}])&&B(t.prototype,n),r&&B(t,r),e}();function V(e,t,n,r,a,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,a)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const G=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;if(z(this,e),this.options=this.initOptions(o),this.toolbar=this.initToolbar(a),t.innerHTML=u(this.toolbar,this.options),this.editorNode=t.querySelector(".editor-body"),this.toolbarNode=t.querySelector(".editor-toolbar"),this.debugTarget=!1,this.options.debug){var i=document.createElement("div");this.debugTarget=f(i,this.editorNode)}this.listenForMouseUpEvents(),this.listenForPasteEvents(),this.listenForKeydownEvents(),this.options.bufferSize>0&&(this.bufferIndex=0,this.buffer=[this.editorNode.innerHTML],this.listenForKeyupEvents()),this.save=this.getCleanData,this.update=this.updateEditor;var l={attributes:!1,childList:!0,subtree:!0},s=new MutationObserver((function(){return n.handleMutation()}));s.observe(this.editorNode,l),this.modal=new K,this.initEditor(r)}var t,n,r,a,o;return t=e,(n=[{key:"handleMutation",value:function(){!1===this.bufferIgnoreMutation(this)&&(this.options.debug,this.bufferUpdate(this),this.updateEventHandlers())}},{key:"initBuffering",value:function(){this.bufferIndex=-1,this.buffer=[],this.bufferIgnore=!1,this.bufferUpdate=M,this.bufferIgnoreMutation=P,this.options.debug}},{key:"initOptions",value:function(e){return e?(e.headingNumbers=null==e.headingNumbers||e.headingNumbers,e.bufferSize=null==e.bufferSize?10:Math.max(parseInt(e.bufferSize),10),e.debug=null!=e.debug&&e.debug):e={headingNumbers:!0,bufferSize:10,debug:!1},e}},{key:"initEditor",value:(a=regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:"",!this.options.defaultContent||""==this.options.defaultContent){e.next=9;break}return e.next=4,fetch(this.options.defaultContent);case 4:if(200!=(n=e.sent).status){e.next=9;break}return e.next=8,n.text();case 8:t=e.sent;case 9:this.initBuffering(),this.editorNode.innerHTML=t,this.range=!1,this.initialiseButtons();case 13:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=a.apply(e,t);function i(e){V(o,n,r,i,l,"next",e)}function l(e){V(o,n,r,i,l,"throw",e)}i(void 0)}))},function(){return o.apply(this,arguments)})},{key:"initToolbar",value:function(e){var t=[];return e.forEach((function(e,n){e.forEach((function(e){var r,a;e.group=n,r=e.type,a=e.tag,null!=d[r]&&0==d[r].includes(a)&&"CLEAR"!=a&&d[r].push(a),t.push(e)}))})),t}},{key:"setState",value:function(e){"setState"in e?e.setState(this,e):(!1===this.range?e.element.disabled=!0:e.element.disabled=!1,e.element.classList.remove("active"))}},{key:"setStates",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.toolbar.forEach((function(n){""!=t&&n.type!=t||e.setState(n)}))}},{key:"initialiseButtons",value:function(){var e=this;this.shortcuts=[],this.toolbar.forEach((function(t){t.element=e.toolbarNode.querySelector("#".concat(t.tag)),"init"in t&&t.init(e,t),e.setState(t),"shortcut"in t&&(t.shortcut[0],t.shortcut[1],e.shortcuts.push({shortcut:t.shortcut[0],trigger:t.shortcut[1],button:t})),t.element.addEventListener("click",(function(n){e.modal.active()||(!1!==e.range||"buffer"===t.type?t.click(e,t):n.preventDefault())}))}))}},{key:"listenForMouseUpEvents",value:function(){var e=this;document.addEventListener("mouseup",(function(t){if(!e.modal.active())if(e.nodeInEditor(t.target))e.handleMouseUp();else{if(e.nodeInToolbar(t.target))return;e.handleEditorBlur()}}))}},{key:"handleEditorBlur",value:function(e){var t=this;this.toolbar.forEach((function(e){t.range=!1,t.setState(e)}))}},{key:"nodeInEditor",value:function(e){for(;3==e.nodeType||"HTML"!=e.tagName;){if(e==this.editorNode)return!0;e=e.parentNode}return!1}},{key:"nodeInToolbar",value:function(e){for(;3==e.nodeType||"HTML"!=e.tagName;){if(e==this.toolbarNode)return!0;e=e.parentNode}return!1}},{key:"setToolbarStates",value:function(){var e=this;!1!==this.range?this.toolbar.forEach((function(t){e.setState(t)})):this.toolbar.forEach((function(e){e.element.classList.remove("active")}))}},{key:"handleMouseUp",value:function(){if(this.updateRange(),!1!==this.range){this.bufferIgnore=!1,this.range.blockParent==this.editorNode&&""==this.editorNode.innerText&&this.insertParagraph();var e=v(this.range);this.highlightCustomNode(e)}this.setToolbarStates()}},{key:"insertParagraph",value:function(){var e=document.createElement("P");e.innerText="\n",e=this.editorNode.appendChild(e),A(e,0)}},{key:"listenForKeydownEvents",value:function(){var e=this;this.lastKey="",this.editorNode.addEventListener("keydown",(function(t){var n,r=!1;e.options.debug,document.querySelectorAll(".show").length>0&&(t.preventDefault(),r=!0),r||"Enter"!=t.key||(e.handleEnter()&&t.preventDefault(),r=!0),!r&&("Backspace"==t.key||"Delete"==t.key||t.ctrlKey&&"d"==t.key)&&(e.handleDelete(t.key)&&t.preventDefault(),r=!0),r||e.shortcuts.forEach((function(n){e.lastKey===n.shortcut&&t.key===n.trigger&&(t.preventDefault(),t.stopPropagation(),n.button.click(e,n.button),r=!0)})),!r&&e.bufferSize>0&&(t.ctrlKey||t.metaKey)&&"z"==t.key&&(t.preventDefault(),n=t.shiftKey?e.toolbar.find((function(e){return"REDO"==e.tag})):e.toolbar.find((function(e){return"UNDO"==e.tag})),e.buffer.click(n),e.updateEventHandlers(),r=!0),e.lastKey=t.key}))}},{key:"handleEnter",value:function(){var e=this;if(this.updateRange(),!1!==this.range){var t=v(this.range),n=this.range.endContainer.textContent.trim().length==this.range.endOffset,r=!1;if(t||n){var a=document.createElement(this.range.blockParent.tagName);a.innerText="\n",a=f(a,this.range.blockParent),A(a,0),r=!0}return t&&this.highlightCustomNode(!1),setTimeout((function(){return e.updateRange()}),10),r}}},{key:"handleDelete",value:function(e){var t=this;if("d"==e&&(e="Delete"),this.updateRange(),this.range){var n=new K({type:"overlay",severity:"info",title:"Information",html:"<p>To delete a custom element you need to edit it by clicking it and choosing Delete.</p>",escape:!0,buttons:{cancel:{label:"Close"}}});if(this.range.collapsed){if("Backspace"==e&&0==this.range.startOffset){var r=this.range.blockParent.previousElementSibling;if(r&&r.querySelector('[contenteditable="false"]'))return n.show(),!0}else if("Delete"==e&&this.range.endContainer.textContent.trim().length==this.range.endOffset){var a=this.range.endContainer.nextElementSibling;if(a&&"false"==a.getAttribute("contenteditable"))return n.show(),!0}}else for(var o=g(this.range.startContainer),i=g(this.range.endContainer);o!==i;){if(o.innerHTML.includes('contenteditable="false"'))return n.show(),!0;o=o.nextElementSibling}}return setTimeout((function(){return t.updateRange()}),10),!1}},{key:"listenForKeyupEvents",value:function(){var e=this;this.handleKeyup=function(e,t){var n;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];n&&clearTimeout(n),n=setTimeout((function(){e.apply(void 0,a)}),t)}}(this.handleKeyupDelayed,500),this.editorNode.addEventListener("keyup",(function(t){0==["Shift"].includes(t.key)&&(e.bufferIgnore=!0,e.handleKeyup(t.key,e))}))}},{key:"handleKeyupDelayed",value:function(){var e=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","End","Home"],t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1];e.includes(t)?(n.range=T(),n.setToolbarStates()):0==document.querySelectorAll(".show").length&&n.bufferUpdate(n)}},{key:"updateEventHandlers",value:function(){var e=this;this.toolbar.forEach((function(t){"addEventHandlers"in t&&t.addEventHandlers(e)}))}},{key:"listenForPasteEvents",value:function(){var e=this;["cut","copy","paste"].forEach((function(t){return e.editorNode.addEventListener(t,(function(t){e.handleCutCopyPaste()&&t.preventDefault()}))}))}},{key:"handleCutCopyPaste",value:function(){if(this.updateRange(),0==this.range||this.range.collapsed)return!1;for(var e=g(this.range.startContainer),t=g(this.range.endContainer),n=!1;!n;){if(e.innerHTML.includes('contenteditable="false"'))return new K({type:"overlay",severity:"info",title:"Information",html:"<p>Cut, copy and paste (of or over) selections with custom block elements is not supported.</p>\n                           <p>Please modify your selection and try again.</p>",escape:!0,buttons:{cancel:{label:"Close"}}}).show(),!0;(e=e.nextElementSibling)===t&&(n=!0)}return!1}},{key:"testModals",value:function(e){var t=this;"overlay"==e?new K({type:"overlay",title:"Example feedback modal",html:'\n                    <p>This is an example of an overlay modal.</p>\n                    <p>It can be dismissed by selecting the "escape" option and/or by adding a "cancel" button.</p>\n                    <p>It also demonstrates the display of a graphic icon which is configured by setting the severity option.</p>',severity:"warning",escape:!0,buttons:{cancel:{label:"OK"}}}).show():"drawer"==e?new K({type:"drawer",title:"Example of an edit modal",html:'\n                    <p>This modal type provides a placeholder for custom content, such as a form with values that can be edited.</p>\n                    <p>It is typically used by specifying a number of standard buttons, such as "cancel", "delete" or "confirm".</p>\n                    <p>Each button may have an associated callback function assigned. If none is assigned the default action is to close the modal.</p>',buttons:{cancel:{label:"Cancel"},delete:{label:"Delete",callback:function(){return alert("delete")}},confirm:{label:"Confirm",callback:function(){return alert("confirm")}}}}).show():"positioned"==e&&this.editorNode.addEventListener("click",(function(){t.updateRange();var e=new K({type:"positioned",escape:!0,backgroundColour:"palegreen",borderRadius:"10px",html:'\n                        <div style="width:400px;padding:1rem;">\n                            <p>This is an example of a positional modal which is positioned with its top-left-hand corner adjacent to the mouse selection point.</p>\n                            <p>The contents can be added as required.</p>\n                            <p>Like all other modals it could be defined with standard buttons but typically would be used for in-place popups like "@mentions".</p>\n                            <p>Optionally you can specify whether it can be dismissed with the Escape key as is required here since no "cancel" button is provided.</p>\n                            <p>You can also set a background colour and border radius to override the defaults as done here.</p>\n                        </div>'});e.show(),e.setPosition(t.range,t.editorNode)}))}},{key:"getCleanData",value:function(){var e=this.editorNode.cloneNode(!0),t=this.toolbar.filter((function(e){return"custom"===e.type}));return C(e,t),e.innerHTML=e.innerHTML.replace(/[\n ]*?</gm,"<"),e.innerHTML}},{key:"updateEditor",value:function(e){this.editorNode.innerHTML=e}},{key:"updateRange",value:function(){var e,t;this.range=T(),this.options.debug&&(e=this.debugTarget,t=this.range,0!=e&&(e.innerHTML=!1===t?"No range selected":'\n            <h5>Selection info:</h5>\n            <div class="debug">\n                <div class="col">\n                    <label>Block parent</label><span>'.concat(t.blockParent.tagName,"</span>\n                    <label>commonAncestorC</label><span>").concat(t.commonAncestorContainer.tagName?t.commonAncestorContainer.tagName:t.commonAncestorContainer.textContent,"</span>\n                    <label>rootNode</label><span>").concat(t.rootNode.tagName,"</span>\n                    <label>collapsed</label><span>").concat(t.collapsed,'</span>\n                </div>\n                <div class="col">\n                    <label>startC</label><span>').concat(t.startContainer.tagName?t.startContainer.tagName:t.startContainer.textContent,"</span>\n                    <label>startOffset</label><span>").concat(t.startOffset,"</span>\n                    <label>endC</label><span>").concat(t.endContainer.tagName?t.endContainer.tagName:t.endContainer.textContent,"</span>\n                    <label>endOffset</label><span>").concat(t.endOffset,"</span>\n                </div>\n            </div>")))}},{key:"highlightCustomNode",value:function(e){this.editorNode.querySelectorAll("[contenteditable=false]").forEach((function(e){return e.classList.remove("selected")})),e&&e.classList.add("selected")}}])&&Y(t.prototype,n),r&&Y(t,r),e}();var W,_,Q,$="",J=function(e,t){W=e.startContainer,_=e.endContainer,t&&(W=g(W),_=g(_)),$="pre"},X=function(e){e==W?($="first",e==_&&($="both")):e==_?$="last":"first"==$?$="during":"both"==$||"last"==$?$="post-first":"post-first"==$&&($="post")},Z=function(){return"pre"==$},ee=function(){return"first"==$||"both"==$},te=function(){return"post-first"==$||"post"==$};function ne(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ae,oe=[],ie=!1;function le(e,t){var n,r=ae,a=function(e){var t="";return e.childNodes.forEach((function(e){if(3===e.nodeType){var n=e.textContent;n.includes("\n")&&(n=n.trim()),t+=n}else(p(e)||m(e)||"BR"===e.tagName)&&(t+=e.outerHTML)})),t}(e),o=[],i=(o="during"==$||"first"==$||"last"==$||"both"==$?t.newFormats:t.oldFormats).slice(-1)[0];e.nodeType;if(!(1!==e.nodeType||""==a&&e.innerHTML.includes("<"))){if(0==oe.length)o.forEach((function(e){n=document.createElement(e),r=r.appendChild(n)}));else if(o.length>oe.length){if(function(e,t){return e.every((function(e,n){return t[n]==e}))}(oe,o)){for(var l=0;l<oe.length;l++)r=r.lastElementChild;for(var s=oe.length;s<o.length;s++)n=document.createElement(o[s]),r=r.appendChild(n)}}else(function(e,t){return(0==e.length||0==t.length||e.length==t.length)&&e.every((function(e,n){return t[n]==e}))})(o,oe)&&(ie&&ie!=ae&&(r=ie.parentNode),n=document.createElement(i),r=r.appendChild(n));if(r==ae){var c=0;o.forEach((function(e,t){e==oe[t]&&0==(t==o.length-1&&"LI"==e)&&(r=r.lastElementChild,c++)}));for(var u=c;u<o.length;u++)n=document.createElement(o[u]),r=r.appendChild(n)}ie=r,oe=o.slice(),""!=a&&(r.innerHTML=a)}}function se(e,t,n){var r={oldFormats:[],newFormats:[]};e!=Q&&(X(e),le(e,r=function(e,t,n){var r=[].concat(ne(t.oldFormats),[e.tagName]),a=[];if(Z()||te())return{newFormats:a=ne(r),oldFormats:r};if("block"===n.type)return{newFormats:a=[n.newFormat],oldFormats:r};if(ee())return"LI"==e.tagName?e.parentNode.firstElementChild==e?(a.pop(),a.push(n.newFormat),a.push("LI")):((a=t.oldFormats.slice()).push(n.newFormat),a.push("LI")):(a.push(n.newFormat),a.push("LI")),{newFormats:a,oldFormats:r};return{newFormats:a=oe.slice(),oldFormats:r}}(e,t,n))),e.childNodes.forEach((function(e){(b(e)||h(e))&&se(e,r,n)}))}var ce=function(e,t){var n=e.range;Q=e.editorNode,oe=[],ie=!1,function(e){e.action="apply",("CLEAR"==e.tag||e.element.getAttribute("data-active"))&&(e.action="remove"),e.newFormat=e.tag,"block"==e.type&&"remove"==e.action&&(e.newFormat="P")}(t),n.rootNode=y(n.rootNode,Q);var r=y(n.startContainer,Q),a=y(n.endContainer,Q);if(function(e){e.startContainer==e.endContainer?e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+k+e.startContainer.textContent.substring(e.startOffset,e.endOffset)+w+e.startContainer.textContent.substring(e.endOffset):(e.startContainer.textContent=e.startContainer.textContent.substring(0,e.startOffset)+k+e.startContainer.textContent.substring(e.startOffset),e.endContainer.textContent=e.endContainer.textContent.substring(0,e.endOffset)+w+e.endContainer.textContent.substring(e.endOffset))}(n),J(n,!0),r==a)ae=document.createElement("DIV"),se(r,{oldFormats:[],newFormats:[]},t),r==Q?r.innerHTML=ae.innerHTML:r.outerHTML=ae.innerHTML;else{var o=!1,i=!1;ae=document.createElement("DIV"),n.rootNode.childNodes.forEach((function(e){1===e.nodeType&&(e==r&&(o=!0),o&&0==i&&("block"===t.type&&(oe=[],ie=!1,ae=document.createElement("DIV")),se(e,{oldFormats:[],newFormats:[]},t),"block"===t.type?e.outerHTML=ae.innerHTML:e.setAttribute("data-remove",!0)),e==a&&(i=!0,"list"===t.type&&(e.outerHTML=ae.innerHTML),Q.querySelectorAll("[data-remove=true]").forEach((function(e){return e.remove()}))))}))}O(e.editorNode),e.updateRange(),e.setStates("block")},ue={setState:function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{var n=g(e.range.startContainer,e.editorNode);t.element.disabled="DIV"===n.tagName||m(n),"list"===t.type&&"LI"===n.tagName&&(n=n.parentNode),n.tagName===t.tag?t.element.classList.add("active"):t.element.classList.remove("active")}}},de=new H("block","H1","Heading 1",'<i class="bi bi-type-h1"></i>',ce,ue),fe=new H("block","H2","Heading 2",'<i class="bi bi-type-h2"></i>',ce,ue),pe=new H("block","H3","Heading 3",'<i class="bi bi-type-h3"></i>',ce,ue),he=new H("block","P","Paragraph",'<i class="bi bi-paragraph"></i>',ce,ue),be=new H("block","BLOCKQUOTE","Blockquote",'<i class="bi bi-blockquote-left"></i>',ce,ue),ve=new H("list","OL","Ordered list",'<i class="bi bi-list-ol"></i>',ce,ue),me=new H("list","UL","Unordered list",'<i class="bi bi-list-ul"></i>',ce,ue);function ge(e){return function(e){if(Array.isArray(e))return ye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e,t){var n="",r="",a="";return"both"==$?(r=e.textContent.substring(0,t.startOffset),n=k+e.textContent.substring(t.startOffset,t.endOffset)+w,a=e.textContent.substring(t.endOffset)):ee()?(r=e.textContent.substring(0,t.startOffset),n=k+e.textContent.substring(t.startOffset)):"last"==$?(n=e.textContent.substring(0,t.endOffset)+w,a=e.textContent.substring(t.endOffset)):n=e.textContent,{preText:r,text:n,postText:a}}function ke(e,t,n){if(0==e.length)return t;var r='<span style="'.concat(e.join(";"),'">').concat(t);return n&&(r+="</span>"),r}var we,Ee,Se,Ne,Le=function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{t.element.disabled="DIV"===e.range.rootNode.tagName||h(e.range.rootNode)||m(e.range.rootNode),Te(t),function(e){for(var t="";0==b(e);){if(1===e.nodeType){var n=e.getAttribute("style");null!=n&&""!=n&&(t+=";"+n)}e=e.parentNode}return t}(e.range.startContainer).includes(t.style)?t.element.classList.add("active"):t.element.classList.remove("active")}},xe=function(e,t,n,r){return 3===e.nodeType?function(e,t,n,r){X(e);var a=Ce(e,r),o=a.preText,i=a.text,l=a.postText,s="";if(Z()||te())s+=ke(t,i,!0);else{var c="".concat(n.newStyle,":").concat(n.newValue),u=function(e,t){var n=-1;return e.forEach((function(e,r){e==t&&(n=r)})),n}(t,c),d=!0;if(o&&(0==t.length?s+=o:(d=!0,"apply"==n.action&&(u>-1||""!=l)&&(d=!1),s+=ke(t,o,d))),i)if("apply"==n.action)if(u>-1&&0==d)s+=i;else{var f=[];f=d?[].concat(ge(t),[c]):[c],s+=ke(f,i,!0)}else"remove"!=n.action&&"clear"!=n.action||(s+=i);l&&(0==t.length?s+=l:d?s+=ke(t,l,!0):(s+=l,t.forEach((function(){return s+="</span>"}))))}return s}(e,t,n,r):m(e)?e.outerHTML:function(e,t,n,r){if("SPAN"===e.tagName){var a=e.getAttribute("style");null!=a&&""!=a&&a.split(";").forEach((function(e){if(""!=e){var n=e.split(":");0==t.includes(n[0].trim())&&(t=[].concat(ge(t),[e]))}}))}var o="";return e.childNodes.forEach((function(e){o+=xe(e,t,n,r)})),o}(e,t,n,r)},Te=function(e){var t=e.style.split(":");e.newStyle=t[0],e.newValue=void 0!==t[1]?t[1]:"",e.action="apply",e.element.classList.contains("active")&&"CLEAR"!=e.style?e.action="remove":"CLEAR"==e.style&&(e.action="clear")},Ae=function(e,t){var n=e.range;0==b(n.rootNode)&&(n.rootNode=g(n.rootNode)),Te(t),J(n,!1);var r=xe(n.rootNode,[],t,n);!function(e,t,n){var r=document.createElement(t);r.innerHTML=n;var a=e.parentNode.insertBefore(r,e);e.parentNode.removeChild(e)}(n.rootNode,n.rootNode.tagName,r);O(e.editorNode),e.updateRange(),t.setState(e,t)},qe={setState:Le,style:"font-weight:bold",removeStyle:"font-weight:normal"},Oe=new H("style","B","Bold",'<i class="bi bi-type-bold"></i>',Ae,qe),Ie=new H("style","I","Italic",'<i class="bi bi-type-italic"></i>',Ae,qe={setState:Le,style:"font-style:italic",removeStyle:"font-style:normal"}),He=new H("style","U","Underline",'<i class="bi bi-type-underline"></i>',Ae,qe={setState:Le,style:"text-decoration:underline",removeStyle:"text-decoration:none"}),De=new H("style","CLEAR","Clear",'<i class="bi bi-eraser"></i>',Ae,qe={setState:Le,style:"CLEAR"}),Me=[],Pe=0,Re=null;function Ue(e){var t="";return Me.forEach((function(n){var r=n.toLowerCase();(""==e||r.includes(e))&&(t+="<li>".concat(n,"</li>"))})),t}function Fe(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Pe>=0&&Ee.length>0&&(Ee.forEach((function(e){return e.classList.remove("selected")})),Ee[Pe].classList.add("selected"),e&&Ee[Pe].scrollIntoView({block:"end",inline:"nearest"}))}function Be(e){var t=e.key,n=e.shiftKey;(0==Ee.length?Pe=-1:"ArrowDown"==t||"ArrowRight"==t||"Tab"==t&&0==n?(e.preventDefault(),Pe<Ee.length-1?Pe++:Pe=0,Fe()):"ArrowUp"==t||"ArrowLeft"==t||"Tab"==t&&n?(e.preventDefault(),0==Pe?Pe=Ee.length-1:Pe--,Fe()):"Enter"!=t&&(Se.innerHTML=Ue(Ne.value.toLowerCase()),Ee=Se.querySelectorAll("li"),Pe=0,Fe()),"Enter"==t)&&Ke(-1!=Pe?Ee[Pe].textContent:Ne.value)}function je(e){Ke(e.target.textContent)}function Ke(e){var t=we.range.startContainer.textContent,n=we.range.startOffset,r=t.substring(0,n),a=t.substring(n);"@"===a.charAt(0)&&(a=a.slice(1,a.length)),32!==t.charCodeAt(n-1)&&(e=" "+e),n<t.length&&32!==t.charCodeAt(n)&&(""!=a&&(a+=" "),e+=" "),we.range.startContainer.textContent=r+e+a,n+=e.length,we.range=A(we.range.startContainer,n),Re.hide(),we.bufferUpdate(we)}var Ve,ze,Ye,Ge,We=function(e){Me=e.sort()},_e=new H("custom","mention","Mention",'<i class="bi bi-person"></i>',(function(e,t){var n;!1!==e.range&&(we=e,(Re=new K({type:"positioned",escape:!0,html:(n=Ue(""),'<div class="mentions">\n                <input type="text"/>\n                <ul>'.concat(n,"</ul>\n            </div>"))})).show(),Re.setPosition(we.range,we.editorNode),Re.container.addEventListener("keyup",Be),(Se=Re.container.querySelector("ul")).addEventListener("click",je),Ee=Se.querySelectorAll("li"),Pe=0,Fe(!1),(Ne=Re.container.querySelector("input")).value="",Ne.focus())}),{setState:function(e,t){!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer?t.element.disabled=!0:t.element.disabled=!1},shortcut:["@","@"]}),Qe="A",$e=null,Je=null;function Xe(){Je.hide(),$e.hide()}function Ze(){Ge?(Je=new K({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Xe}}})).show():$e.hide()}function et(){Je.hide(),$e.hide(),Ye.remove(),Ve.range=!1,ft(Ve,ze)}function tt(){(Je=new K({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this link?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:et}}})).show()}function nt(e){$e&&$e.active()||(Ye=e,rt("",!0))}function rt(e,t){var n="Create link",r={cancel:{label:"Cancel",callback:Ze},confirm:{label:"Save",callback:at}};t?(n="Edit link",r.delete={label:"Delete",callback:tt}):((Ye=document.createElement(Qe)).id=I(),Ye.setAttribute("contenteditable","false"),Ye.href="",Ye.dataset.label=e,Ye.dataset.display=0),($e=new K({type:"drawer",title:n,html:it(t),buttons:r})).show(),Ge=!1,$e.panel.querySelectorAll("form input").forEach((function(e){return e.addEventListener("change",(function(){return Ge=!0}))}));var a=$e.panel.querySelector("form #href");a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function at(){Ye.href=$e.panel.querySelector("form #href").value.trim(),Ye.dataset.label=$e.panel.querySelector("form #label").value.trim(),Ye.dataset.display=parseInt($e.panel.querySelector("form #display").value),null==Ye.parentNode&&function(e){var t,n=e.range.startContainer.parentNode,r=e.range.startContainer.textContent.substring(0,e.range.startOffset);e.range.collapsed?(t=e.range.startContainer.textContent.substring(e.range.startOffset)," "!=r.charAt(r.length+1)&&(r+=" ")," "!=t.charAt(0)&&(t=" "+t)):t=e.range.startContainer.textContent.substring(e.range.endOffset);r&&n.insertBefore(document.createTextNode(r),e.range.startContainer);Ye=n.insertBefore(Ye,e.range.startContainer),t&&n.insertBefore(document.createTextNode(t),e.range.startContainer);e.range.startContainer.remove()}(Ve),$e.hide(),ot(Ye),Ve.range=A(Ye,0),ft(Ve,ze)}function ot(e){0==e.id&&(e.id=I()),e.setAttribute("contenteditable",!1),e.title="Click to edit",e.innerText=function(e){switch(parseInt(e.dataset.display)){case 0:if(e.dataset.label)return e.dataset.label;break;case 1:return e.href;case 2:if(e.dataset.label&&e.dataset.label!=e.href)return"".concat(e.dataset.label," (").concat(e.href,")")}return e.href}(e),e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),nt(e)}))}function it(e){var t="",n="http://",r=Ye.dataset.label,a=Ye.dataset.display?Ye.dataset.display:0;return e&&(n=Ye.href,t='<a href="'.concat(n,'" class="panel-link" target="_blank" title="Open link in new tab or window">').concat('<i class="bi bi-link-45deg"></i>',"</a>")),'\n        <form>\n            <div class="form-input">\n                <label for="href">URL</label>\n                <input id="href" type="url" class="form-control '.concat(t?"with-button":"",'" placeholder="URL" required value="').concat(n,'">\n                ').concat(t,'\n            </div>\n            <div class="form-input">\n                <label for="label">Label (optional)</label>\n                <input id="label" type="text" class="form-control" placeholder="Label" value="').concat(r,'">\n            </div>\n            <div class="form-input">\n                <label for="label">Display option</label>\n                <select class="form-control" id="display">\n                    <option value="0" ').concat(0==a?"selected":"",'>Label only</option>\n                    <option value="1" ').concat(1==a?"selected":"",'>Link only</option>\n                    <option value="2" ').concat(2==a?"selected":"",">Label and link</option>\n                </select>\n            </div>\n        </form>")}var lt,st,ct,ut,dt,ft=function(e,t){!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(Qe)?t.element.classList.add("active"):t.element.classList.remove("active"))},pt=new H("custom",Qe,"Link",'<i class="bi bi-link"></i>',(function(e,t){if(!($e&&$e.active()||(ze=t,!1===(Ve=e).range))){var n="";0==Ve.range.collapsed&&Ve.range.startContainer==Ve.range.endContainer&&(n=Ve.range.endContainer.textContent.substring(Ve.range.startOffset,Ve.range.endOffset)),rt(n,!1)}}),{init:function(e,t){ze=t,(Ve=e).editorNode.querySelectorAll(Qe).forEach((function(e){return ot(e)}))},setState:ft,addEventHandlers:function(e){ze=pt,(Ve=e).editorNode.querySelectorAll(Qe).forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),nt(e)}))}))},clean:function(e){return e.removeAttribute("id"),e.removeAttribute("contenteditable"),e.innerText=" ",e}}),ht=100/30,bt=100/30,vt=null;function mt(e,t){(vt.panel.querySelectorAll(".active").forEach((function(e){return e.classList.remove("active")})),null==e)?(vt.panel.querySelectorAll(".colours .hues span").forEach((function(e,t){var n=12*t;e.style.backgroundColor="hsl(".concat(n,",100%,50%)"),n==lt&&e.classList.add("active")})),vt.panel.querySelectorAll(".colours .saturations span").forEach((function(e,t){var n=t*ht;e.style.backgroundColor="hsl(".concat(lt,",").concat(n,"%,50%)"),n==st&&e.classList.add("active")})),vt.panel.querySelectorAll(".colours .lightnesses span").forEach((function(e,t){var n=t*bt;e.style.backgroundColor="hsl(".concat(lt,",50%,").concat(n,"%)"),n==ct&&e.classList.add("active")}))):(e.classList.add("active"),lt=0,st=100,ct="black"==t?0:100);vt.panel.querySelector("form .result span").style.backgroundColor="hsl(".concat(lt,",").concat(st,"%,").concat(ct,"%)")}function gt(){for(var e="",t="",n="",r=0;r<30;r++)e+='<span class="colour" data-colour="hue" data-index="'.concat(r,'">&nbsp;</span>'),t+='<span class="colour" data-colour="saturation" data-index="'.concat(r,'">&nbsp;</span>'),n+='<span class="colour" data-colour="lightness" data-index="'.concat(r,'">&nbsp;</span>');return'\n        <form id="colour-menu">\n\n            <div class="colours">\n                <div class="hues">\n                    <label>Hue</label>\n                    <div>'.concat(e,'</div>\n                </div>\n                <div class="saturations">\n                    <label>Saturation</label>\n                    <div>').concat(t,'</div>\n                </div>\n                <div class="lightnesses">\n                    <label>Lightness</label>\n                    <div>').concat(n,'</div>\n                </div>\n            </div>\n\n            <div class="result">\n                <label>Result</label>\n                <span class="final">&nbsp;</span>\n                <label>Black and white</label>\n                <span class="black-and-white" data-colour="black">&nbsp;</span>\n                <span class="black-and-white" data-colour="white">&nbsp;</span>\n            </div>\n            \n        </form>')}function yt(){var e="hsl(".concat(lt,", ").concat(st,"%, ").concat(ct,"%)"),t={setState:Nt,style:"".concat(dt.style,":").concat(e),removeStyle:dt.removeStyle,element:dt.element};vt.hide(),Ae(ut,t)}var Ct,kt,wt,Et,St=function(e,t){vt&&vt.active()||(dt=t,!1===(ut=e).range||ut.range.collapsed?new K({type:"overlay",severity:"info",html:"The colour selection buttons require at least one character to be selected.",buttons:{cancel:{label:"Close"}}}).show():function(){lt=0,st=29*ht,ct=50;var e="Select highlight colour";"FGC"==dt.tag&&(e="Select text colour"),(vt=new K({type:"drawer",title:e,html:gt(),escape:!0,buttons:{cancel:{label:"Cancel"},confirm:{label:"Set",callback:yt}}})).show(),mt(),vt.panel.querySelectorAll("span.colour").forEach((function(e){return e.addEventListener("click",(function(e){var t=e.target,n=t.dataset.colour,r=t.dataset.index;switch(n){case"hue":lt=12*r;break;case"saturation":st=r*ht;break;case"lightness":ct=r*bt}mt()}))})),vt.panel.querySelectorAll("span.black-and-white").forEach((function(e){return e.addEventListener("click",(function(e){var t=e.target.dataset.colour;mt(e.target,t)}))}))}())},Nt=function(e,t){if(!1===e.range)t.element.disabled=!0,t.element.classList.remove("active");else if("CLEAR"==t.tag)t.element.disabled=!1,t.element.classList.remove("active");else{t.element.disabled="DIV"===e.range.rootNode.tagName||h(e.range.rootNode)||m(e.range.rootNode);var n="",r=e.range.startContainer.parentNode.getAttribute("style");null!=r&&r.split(";").forEach((function(e){if(""!==e){var r=e.split(":");r[0].trim()===t.style&&(n=r[1].trim(),t.element.querySelector("span.bar").setAttribute("style","background-color:".concat(n,";")))}})),""==n&&t.element.querySelector("span.bar").removeAttribute("style")}},Lt=function(e,t){var n=document.createElement("span");n.classList.add("bar"),n.classList.add(t.tag),t.element.appendChild(n),t.element.classList.add("barred")},xt={init:Lt,setState:Nt,style:"color",removeStyle:"color:black;"},Tt=new H("inline","FGC","Text colour",'<i class="bi bi-type"></i>',St,xt),At=new H("inline","BGC","Highlight colour",'<i class="bi bi-paint-bucket"></i>',St,xt={init:Lt,setState:Nt,style:"background-color",removeStyle:"background-color:white;"}),qt="CUSTOM",Ot=null,It=null;function Ht(e){Ot&&Ot.active()||(wt=e,Ut(!0))}function Dt(){It.hide(),Ot.hide()}function Mt(){It.hide(),Ot.hide(),wt.remove(),Ct.range=!1,Gt(Ct,kt)}function Pt(){Et?(It=new K({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Dt}}})).show():Ot.hide()}function Rt(){(It=new K({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Mt}}})).show()}function Ut(e){var t="Create custom element",n={cancel:{label:"Cancel",callback:Pt},confirm:{label:"Save",callback:Ft}};e?(t="Edit custom element",n.delete={label:"Delete",callback:Rt}):((wt=document.createElement(qt)).id=I(),wt.setAttribute("contenteditable","false"),wt.innerHTML=jt({property1:" ",property2:" ",property3:" "}));var r,a={property1:wt.querySelector(".property1").innerText,property2:wt.querySelector(".property2").innerText,property3:wt.querySelector(".property3").innerText};(Ot=new K({type:"drawer",title:t,html:(r=a,'\n        <form>\n            <div class="form-input">\n                <label for="property1">Property 1</label>\n                <input id="property1" type="text" class="form-control" placeholder="Property 1" required value="'.concat(r.property1,'">\n            </div>\n            <div class="form-input">\n                <label for="property2">Property 2</label>\n                <input id="property2" type="text" class="form-control" placeholder="Property 2" required value="').concat(r.property2,'">\n            </div>\n            <div class="form-input">\n                <label for="property3">Property 3</label>\n                <input id="property3" type="text" class="form-control" placeholder="Property 3" required value="').concat(r.property3,'">\n            </div>\n        </form>')),buttons:n})).show(),Et=!1,Ot.panel.querySelectorAll("form input").forEach((function(e){return e.addEventListener("change",(function(){return Et=!0}))}));var o=Ot.panel.querySelector("form input#property1");o.focus(),o.setSelectionRange(o.value.length,o.value.length)}function Ft(){wt.querySelector(".property1").innerText=Ot.panel.querySelector("form #property1").value.trim(),wt.querySelector(".property2").innerText=Ot.panel.querySelector("form #property2").value.trim(),wt.querySelector(".property3").innerText=Ot.panel.querySelector("form #property3").value.trim(),null==wt.parentNode&&(wt=Ct.range.startContainer.parentNode.appendChild(wt)),Ot.hide(),Bt(wt),Ct.range=A(wt,0),Gt(Ct,kt)}function Bt(e){e.id;0==e.id&&(e.id=I());var t={property1:e.querySelector(".property1").innerText,property2:e.querySelector(".property2").innerText,property3:e.querySelector(".property3").innerText};e.innerHTML=jt(t),e.setAttribute("contenteditable",!1);var n=document.createElement("button");n.type="button",n.classList.add("edit"),n.innerText="Edit",n.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Ht(e)})),e.appendChild(n),e.addEventListener("click",(function(){Gt(Ct,kt)}))}function jt(e){return'\n        <span class="title">I am a custom object with 3 properties:</span>\n        <span class="label">Property 1:</span><span class="prop property1">'.concat(e.property1,'</span>\n        <span class="label">Property 2:</span><span class="prop property2">').concat(e.property2,'</span>\n        <span class="label">Property 3:</span><span class="prop property3">').concat(e.property3,'</span>\n        <span class="advice">Click the top right-hand button to edit. Select anywhere in the element and then the Enter key to add a new line after this custom element.</span>\n    ')}var Kt,Vt,zt,Yt,Gt=function(e,t){!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(qt)?t.element.classList.add("active"):t.element.classList.remove("active"))},Wt=new H("custom",qt,"Custom",'<i class="bi bi-plug"></i>',(function(e,t){if(!Ot||!Ot.active()){kt=t;var n=(Ct=e).range.blockParent.querySelector(qt);null!=n?Ht(n):Ut(!1)}}),{setState:Gt,init:function(e,t){Ct=e,kt=t,e.editorNode.querySelectorAll(t.tag).forEach((function(e){return Bt(e)}))},addEventHandlers:function(e){kt=Wt,(Ct=e).editorNode.querySelectorAll("CUSTOM button").forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Ht(e.parentNode)}))}))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector(".title").remove(),e.querySelector(".advice").remove(),e.querySelector(".label").remove(),e.querySelector("button").remove(),e}}),_t="COMMENT",Qt=null,$t=null;function Jt(e){Qt&&Qt.active()||(zt=e,nn(!0))}function Xt(){$t.hide(),Qt.hide()}function Zt(){$t.hide(),Qt.hide(),zt.remove(),Kt.range=!1,ln(Kt,Vt)}function en(){Yt?($t=new K({type:"confirm",severity:"warning",title:"Cancel changes",html:"Do you really want to lose these changes?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Xt}}})).show():Qt.hide()}function tn(){($t=new K({type:"confirm",severity:"danger",title:"Delete changes",html:"Do you really want to delete this item?",buttons:{cancel:{label:"No - keep editing"},confirm:{label:"Yes - delete link",callback:Zt}}})).show()}function nn(e){var t="Add comment",n={cancel:{label:"Cancel",callback:en},confirm:{label:"Save",callback:rn}};e?(t="Edit comment",n.delete={label:"Delete",callback:tn}):((zt=document.createElement(_t)).id=I(),zt.setAttribute("contenteditable","false"),zt.dataset.comment=" "),(Qt=new K({type:"drawer",title:t,html:on(zt.dataset.comment),buttons:n})).show(),Yt=!1,Qt.panel.querySelector("form textarea").addEventListener("change",(function(){return Yt=!0}));var r=Qt.panel.querySelector("form textarea#comment");r.focus(),r.setSelectionRange(r.value.length,r.value.length)}function rn(){zt.dataset.comment=Qt.panel.querySelector("form #comment").value.trim(),null==zt.parentNode&&(zt=Kt.range.startContainer.parentNode.appendChild(zt)),Qt.hide(),an(zt),Kt.range=A(zt,0),ln(Kt,Vt)}function an(e){e.id;0==e.id&&(e.id=I()),e.innerHTML="",e.setAttribute("contenteditable",!1);var t=document.createElement("button");t.type="button",t.classList.add("edit"),t.innerHTML='<i class="bi bi-chat-dots-fill"></i>',t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Jt(e)})),e.appendChild(t),e.addEventListener("click",(function(){ln(Kt,Vt)}))}function on(e){return'\n        <form>\n            <div class="form-input">\n                <label for="comment">Comment</label>\n                <textarea id="comment" class="form-control" placeholder="Enter your comment" required>'.concat(e,"</textarea>\n            </div>\n        </form>")}var ln=function(e,t){!1===e.range||0==e.range.collapsed&&e.range.startContainer!=e.range.endContainer?(t.element.disabled=!0,t.element.classList.remove("active")):(t.element.disabled=!1,null!=e.range.blockParent.querySelector(_t)?t.element.classList.add("active"):t.element.classList.remove("active"))},sn=new H("custom",_t,"Custom",'<i class="bi bi-chat-dots"></i>',(function(e,t){if(!Qt||!Qt.active()){Vt=t;var n=(Kt=e).range.blockParent.querySelector(_t);null!=n?Jt(n):nn(!1)}}),{setState:ln,init:function(e,t){Kt=e,Vt=t,e.editorNode.querySelectorAll(t.tag).forEach((function(e){return an(e)}))},addEventHandlers:function(e){Vt=sn,(Kt=e).editorNode.querySelectorAll("COMMENT button").forEach((function(e){return e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),Jt(e.parentNode)}))}))},clean:function(e){return e.removeAttribute("contenteditable"),e.querySelector("button").remove(),e}});return t})()}));